"use strict";(()=>{async function J(t,e={},n=3){let s=null;for(let o=0;o<=n;o++)try{let r=new AbortController,a=setTimeout(()=>r.abort(),6e4),i=await fetch(t,{...e,signal:r.signal});return clearTimeout(a),i}catch(r){if(s=r,r.name==="AbortError"||o===n)throw r;let a=Math.pow(2,o)*1e3;await new Promise(i=>setTimeout(i,a))}throw s}function ee(t,e){let n;return function(...o){let r=()=>{clearTimeout(n),t(...o)};clearTimeout(n),n=setTimeout(r,e)}}function l(t,e=document){return e.querySelector(t)}function b(t,e=document){return Array.from(e.querySelectorAll(t))}function g(t,e,n,s){t.addEventListener(e,n,s)}function H(t){let e=l("#loader");e&&(e.style.display=t?"flex":"none")}function rt(){let t=document.getElementById("app-obscure-overlay");return t||(t=document.createElement("div"),t.id="app-obscure-overlay",t.className="app-obscure-overlay hidden",document.body.appendChild(t)),t}function A(t,e={hide:!1}){let n=l("#menubar"),s=l("#main-content-outter"),o=document.documentElement,r=rt();t?(o.classList.add("password-mode"),r.classList.remove("hidden"),e.hide?(n?.classList.add("app-hidden"),s?.classList.add("app-hidden"),n?.classList.remove("app-masked"),s?.classList.remove("app-masked")):(n?.classList.add("app-masked"),s?.classList.add("app-masked"),n?.classList.remove("app-hidden"),s?.classList.remove("app-hidden"))):(o.classList.remove("password-mode"),r.classList.add("hidden"),n?.classList.remove("app-masked","app-hidden"),s?.classList.remove("app-masked","app-hidden"))}var te=t=>{l(t)?.style.setProperty("display","block")},k=t=>{l(t)?.style.setProperty("display","none")};var Ee={success:"\u2713",error:"\u2715",warning:"\u26A0",info:"\u2139"};function y(t,e="info",n=4e3){let s=document.getElementById("toast-container");if(!s){let a=l("#outer-toast"),i=l("#toast");a&&i&&(i.innerHTML=t,a.style.display="block",a.style.opacity="1",setTimeout(()=>a.style.display="none",n));return}let o=document.createElement("div");o.className=`toast ${e}`;let r=Ee[e]||Ee.info;o.innerHTML=`<div class="toast-content"><span class="toast-icon">${r}</span><span class="toast-message">${t}</span><button class="toast-close" onclick="this.parentElement.parentElement.remove()">&times;</button></div>`,s.appendChild(o),setTimeout(()=>o.parentElement&&o.remove(),n)}function B(t,e="info",n=5e3){let s=document.createElement("div");s.className=`notification notification-${e}`,s.innerHTML=t,document.body.appendChild(s),setTimeout(()=>s.classList.add("show"),10),setTimeout(()=>{s.classList.remove("show"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},300)},n)}var Le=({onOk:t,obscure:e=!0,hideUI:n=!1})=>{let s=l("#dialog-password"),o=l("#enterpassword");s.returnValue="cancel",o.value="",e&&A(!0,{hide:n}),s.showModal(),queueMicrotask(()=>o.focus());let r=s.querySelector("button[value='ok']"),a=async c=>{c?.preventDefault?.(),r.disabled=!0;try{if(await t(o.value))s.close("ok"),A(!1);else{y("Wrong password","error"),o.select(),o.focus();return}}finally{r.disabled=!1}};r.addEventListener("click",a,{once:!1});let i=()=>{r.removeEventListener("click",a),s.removeEventListener("close",i)};s.addEventListener("close",i)},Ce=({onOk:t})=>{let e=l("#dialog-delete-password"),n=l("#deletepassword");e.returnValue="cancel",n.value="",e.showModal(),queueMicrotask(()=>n.focus());let s=e.querySelector("button[value='ok']"),o=async a=>{a?.preventDefault?.(),s.disabled=!0;try{if(await t(n.value))e.close("ok");else{y("Wrong password","error"),n.select(),n.focus();return}}finally{s.disabled=!1}};s.addEventListener("click",o,{once:!1});let r=()=>{s.removeEventListener("click",o),e.removeEventListener("close",r)};e.addEventListener("close",r)},He=({title:t,onSave:e})=>{let n=l("#dialog-new-password"),s=l("#dialog-new-password-title"),o=l("#newpassword1"),r=l("#newpassword2");s.textContent=t||"Create password",k("#passwords-empty"),k("#passwords-dont-match"),n.returnValue="cancel",n.showModal(),setTimeout(()=>{o.value="",r.value="",o.focus()},0);let a=async()=>{if(!(n.returnValue==="ok")){n.removeEventListener("close",a);return}await e(o.value,r.value)?n.removeEventListener("close",a):setTimeout(()=>n.showModal(),0)};n.addEventListener("close",a)},S=(t,e)=>{let n=l(t);n.returnValue="cancel",n.showModal();let s=()=>{n.removeEventListener("close",s),e(n.returnValue==="ok")};n.addEventListener("close",s)};var Se="theme-preference",N=document.documentElement;function Me(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}function se(){try{return localStorage.getItem(Se)}catch{return null}}function at(t){try{localStorage.setItem(Se,t)}catch{}}function ne(t){N.classList.remove("theme-dark","theme-light"),t==="light"?N.classList.add("theme-light"):N.classList.add("theme-dark"),lt(t)}function it(){let t=se();return t==="dark"||t==="light"?t:N.classList.contains("theme-light")?"light":N.classList.contains("theme-dark")?"dark":Me()==="light"?"light":"dark"}function lt(t){let e=document.getElementById("theme-toggle");if(!e)return;let n=e.querySelector(".label"),s=e.querySelector(".icon"),o=t==="dark";e.setAttribute("aria-pressed",String(o)),n&&(n.textContent=o?"Dark":"Light"),s&&(s.textContent=o?"\u{1F319}":"\u{1F506}")}function ke(){let t=se()||"light";ne(t)}function Ie(){let t=document.getElementById("theme-toggle");if(t&&(t.addEventListener("click",()=>{let e=it()==="dark"?"light":"dark";ne(e),at(e)}),window.matchMedia)){let e=window.matchMedia("(prefers-color-scheme: light)"),n=()=>{se()||ne(Me())};e.addEventListener?e.addEventListener("change",n):"addListener"in e&&e.addListener(n)}}var oe=class{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.particles=[],this.time=0,this.animationId=null,this.curves=[{a:3,b:2,delta:Math.PI/2,speed:.008,size:.35},{a:5,b:4,delta:Math.PI/4,speed:.006,size:.25},{a:3,b:4,delta:Math.PI/3,speed:.004,size:.45}],this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.centerX=this.canvas.width/2,this.centerY=this.canvas.height/2}getPoint(e,n){let s=Math.min(this.centerX,this.centerY)*e.size,o=s*Math.sin(e.a*n+e.delta),r=s*Math.sin(e.b*n);return{x:this.centerX+o,y:this.centerY+r}}draw(){this.ctx.fillStyle="rgba(15, 17, 21, 0.03)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.curves.forEach((e,n)=>{let s=this.getPoint(e,this.time*e.speed),o=this.ctx.createRadialGradient(s.x,s.y,0,s.x,s.y,8);o.addColorStop(0,`rgba(122, 162, 255, ${.4-n*.1})`),o.addColorStop(1,"transparent"),this.ctx.beginPath(),this.ctx.arc(s.x,s.y,8,0,Math.PI*2),this.ctx.fillStyle=o,this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(s.x,s.y,2,0,Math.PI*2),this.ctx.fillStyle=`rgba(122, 162, 255, ${.6-n*.15})`,this.ctx.fill()}),this.time+=1}start(){let e=()=>{this.draw(),this.animationId=requestAnimationFrame(e)};e()}stop(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}};function ct(t){let e=document.createElement("div");e.className="orbital-system";for(let s=1;s<=4;s++){let o=document.createElement("div");o.className=`orbital-ring orbital-ring--${s}`,e.appendChild(o)}let n=["circle","triangle","square","diamond"];for(let s=1;s<=4;s++){let o=document.createElement("div");o.className=`orbiter orbiter--${s}`;let r=document.createElement("div");r.className=`orbiter__shape orbiter__shape--${n[s-1]}`,o.appendChild(r),e.appendChild(o)}return t.appendChild(e),e}function dt(t){let e=document.createElement("div");e.className="breathing-grid";for(let n=1;n<=3;n++){let s=document.createElement("div");s.className=`breathing-grid__layer breathing-grid__layer--${n}`;let o=document.createElement("div");o.className="breathing-grid__hexagon",s.appendChild(o),e.appendChild(s)}return t.appendChild(e),e}function ut(t,e=9){let n=document.createElement("div");n.className="pendulum-loader";for(let s=0;s<e;s++){let o=document.createElement("div");o.className="pendulum",n.appendChild(o)}return t.appendChild(n),n}function Pe(t,e=15){let n=[];for(let s=0;s<e;s++){let o=document.createElement("div");o.className="particle",o.style.left=`${Math.random()*100}%`,o.style.top=`${Math.random()*100}%`,o.style.animationDelay=`${Math.random()*20}s`,o.style.animationDuration=`${15+Math.random()*10}s`,t.appendChild(o),n.push(o)}return n}function pt(t){t.addEventListener("click",e=>{let n=t.getBoundingClientRect(),s=document.createElement("span");s.className="kinetic-ripple";let o=Math.max(n.width,n.height);s.style.width=s.style.height=`${o}px`,s.style.left=`${e.clientX-n.left-o/2}px`,s.style.top=`${e.clientY-n.top-o/2}px`,t.style.position="relative",t.style.overflow="hidden",t.appendChild(s),s.addEventListener("animationend",()=>s.remove())})}var De=null;function Ae(t=!1){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches)return null;let e=document.querySelector(".kinetic-bg");if(e||(e=document.createElement("div"),e.className="kinetic-bg",t&&e.classList.add("kinetic-bg--landing"),document.body.insertBefore(e,document.body.firstChild)),e.innerHTML="",t){ct(e),dt(e),Pe(e,12);let n=document.createElement("canvas");n.className="lissajous-canvas",e.appendChild(n),De=new oe(n),De.start()}else Pe(e,8);return e}function Be(){let t=document.querySelector(".loader");if(!t)return;let e=t.querySelector(".spinner");e&&(e.remove(),ut(t))}function Ne(){document.querySelectorAll("#menubar-buttons button, .landing button").forEach(e=>pt(e))}var $=new TextEncoder,$e=new TextDecoder;async function ae(t){let e=typeof t=="string"?$.encode(t):t,n=await crypto.subtle.digest("SHA-512",e);return G(n)}function G(t){let e=new Uint8Array(t),n="";for(let s=0;s<e.length;s++){let o=e[s];n+=o!==void 0?o.toString(16).padStart(2,"0"):""}return n}function I(t){let e=t.length/2,n=new Uint8Array(e);for(let s=0;s<e;s++)n[s]=parseInt(t.substr(s*2,2),16);return n.buffer}function V(t=12){let e=new Uint8Array(t);return crypto.getRandomValues(e),G(e.buffer)}var re=null;async function ie(){return re||(re=await ae("-- tab separator --")),re}function qe(t){let e=2166136261,n=16777619;for(let s=0;s<t.length;s++){let o=t.charCodeAt(s);e^=o,e=Math.imul(e,16777619),n+=o+(n<<1)+(n<<4)+(n<<7)+(n<<8)+(n<<24)}return(Math.abs(e)+Math.abs(n)).toString(16)}var Re=1,Oe=null,W=null;function de(){return Oe}function L(t,e){if(!t||!e)return;let n=t.value||"",s=n.split(`
`).length,o=Math.max(1,s+(n.endsWith(`
`)?1:0)),r="1";for(let i=2;i<=o;i++)r+=`
`+i;e.setAttribute("data-lines",r);let a=Math.round(t.scrollTop||0);e.style.setProperty("--gutter-scroll-y",String(-a)),e.style.setProperty("--gutter-before-transform",`translateY(${-a}px)`),e.style.removeProperty("top"),e.style.transform="translateZ(0)"}function le(t,e){return e<0?1:t.substring(0,e).split(`
`).length}function Ke(t){let e=window.getComputedStyle(t);return parseInt(e.lineHeight)||parseInt(e.fontSize)*1.2}function O(t,e){e.querySelectorAll(".active-line").forEach(d=>d.remove());let s=t.selectionStart,o=t.value,r=le(o,s),a=document.createElement("div");a.className="active-line";let i=Ke(t),c=(r-1)*i+parseInt(window.getComputedStyle(t).paddingTop);a.style.top=`${c}px`,a.style.height=`${i}px`,e.appendChild(a)}function K(t,e){e.querySelectorAll(".selected-line").forEach(u=>u.remove());let s=t.selectionStart,o=t.selectionEnd;if(s===o)return;let r=t.value,a=le(r,s),i=le(r,o),c=Ke(t),d=parseInt(window.getComputedStyle(t).paddingTop);for(let u=a;u<=i;u++){let h=document.createElement("div");h.className="selected-line";let f=(u-1)*c+d;h.style.top=`${f}px`,h.style.height=`${c}px`,e.appendChild(h)}}function E(t){let e=b(".tab-header"),n=b(".tab-panel"),s=t.dataset.tabId,o=s?l(`#${s}`):null;requestAnimationFrame(()=>{e.forEach(r=>r.classList.remove("active")),n.forEach(r=>r.classList.remove("active")),t.classList.add("active"),o&&o.classList.add("active"),setTimeout(()=>{T();let r=o?.querySelector("textarea.textarea-contents"),a=o?.querySelector(".line-gutter");if(r&&a){let i=Math.round(r.scrollTop||0);a.style.setProperty("--gutter-scroll-y",String(-i)),a.style.setProperty("--gutter-before-transform",`translateY(${-i}px)`),a.style.removeProperty("top"),a.style.transform="translateZ(0)",r.value&&r.value.length>5e4?setTimeout(()=>L(r,a),0):L(r,a)}},0)})}function q(t){let e;if(t===void 0&&W?e=W.value.substring(0,200):e=(t||"").substring(0,200),!e)return"Empty Tab";let n=0;for(;n<e.length;){let a=e[n];if(a!==" "&&a!==`
`&&a!=="	"&&a!=="\r"&&a!=="\v"&&a!=="\f")break;n++}if(n>=e.length)return"Empty Tab";let s=e.indexOf(`
`,n),o=s===-1?e.length:s,r=e.substring(n,o);return!r||r.length===0?"Empty Tab":(r.length>20&&(r=r.substr(0,18)+"..."),r)}function T(){Oe=l(".tab-header.active .tab-title");let t=l(".tab-panel.active");W=t?t.querySelector("textarea.textarea-contents"):null,W?.focus()}function F(t,e="",n=null,s=null){let o=l(".tab-headers-container"),r=`tab-${Re++}`,a=e,i=null;if(e&&e.startsWith("__CRYPTEXA_COLOR__:")){let M=e.indexOf(`
`);M!==-1&&(i=e.substring(0,M).replace("__CRYPTEXA_COLOR__:","").trim(),a=e.substring(M+1))}let c=document.createElement("li");c.className="tab-header",c.dataset.tabId=r,c.draggable=!0,i&&(c.dataset.tabColor=i,c.style.backgroundColor=i);let d=document.createElement("a");d.href=`#${r}`,d.className="tab-title",d.textContent="Empty Tab";let u=document.createElement("span");u.className="close",u.title="Remove Tab",u.textContent="\xD7",c.appendChild(d),c.appendChild(u),n&&n.nextSibling?o.insertBefore(c,n.nextSibling):o.appendChild(c);let h=document.createElement("div");h.id=r,h.className="tab-panel",h.innerHTML=`
    <div class="editor-wrap">
      <div class="line-gutter" aria-hidden="true"></div>
      <textarea rows="1" cols="1" class="textarea-contents" placeholder="your text goes here..."></textarea>
    </div>`,l("#tabs").appendChild(h);let f=h.querySelector("textarea.textarea-contents"),v=h.querySelector(".line-gutter"),Z=()=>{L(f,v)};a&&a.length>0?(f.value=a,d.textContent=q(a.substring(0,200))):d.textContent=q("");let U=0;f.addEventListener("input",()=>{U&&cancelAnimationFrame(U),U=requestAnimationFrame(()=>{U=0,Z()})});let we=0;f.addEventListener("scroll",()=>{let M=performance.now?performance.now():Date.now();if(f.value&&f.value.length>5e4&&M-we<16)return;we=M;let xe=Math.round(f.scrollTop||0);v.style.setProperty("--gutter-scroll-y",String(-xe)),v.style.removeProperty("top"),v.style.transform="translateZ(0)",v.style.setProperty("--gutter-before-transform",`translateY(${-xe}px)`)}),f.value&&f.value.length>5e4?setTimeout(Z,0):requestAnimationFrame(Z);let Q=h.querySelector(".editor-wrap");return Q&&setTimeout(()=>{O(f,Q),K(f,Q)},0),ce(),R(),E(c),!t&&s&&s(!0),c}function ce(){let t=b(".tab-header");t.forEach(e=>{let n=e.querySelector(".close");n&&(n.style.display=t.length>1?"":"none")}),T()}function Fe(t,e){return[...t.querySelectorAll(".tab-header:not([style*='opacity'])")].reduce((s,o)=>{let r=o.getBoundingClientRect(),a=e-r.left-r.width/2;return a<0&&a>s.offset?{offset:a,element:o}:s},{offset:Number.NEGATIVE_INFINITY}).element}function ht(t=null){let e=null,n=null,s=l(".tab-headers-container");s.addEventListener("dragstart",o=>{let r=o,a=r.target.closest(".tab-header");a&&(e=a,n=l(`#${a.dataset.tabId}`),r.dataTransfer&&(r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/html",a.outerHTML)),setTimeout(()=>{a.style.opacity="0.5"},0))}),s.addEventListener("dragend",o=>{let r=o.target.closest(".tab-header");r&&(r.style.opacity=""),e=null,n=null}),s.addEventListener("dragover",o=>{o.preventDefault();let r=o;r.dataTransfer&&(r.dataTransfer.dropEffect="move");let a=Fe(s,r.clientX),i=l(".tab-header[style*='opacity']");i&&(a==null?s.appendChild(i):s.insertBefore(i,a))}),s.addEventListener("drop",o=>{if(o.preventDefault(),!e||!n)return;let r=l("#tabs"),a=Fe(s,o.clientX);if(a==null)r.appendChild(n);else{let i=a.dataset.tabId,c=i?l(`#${i}`):null;c&&r.insertBefore(n,c)}t&&t(!0)})}function _e(t=null){let e=l(".tab-headers-container");if(!e)return;g(e,"click",s=>{let o=s,r=o.target.closest(".tab-header");if(o.target.closest(".close")&&r){o.preventDefault(),o.stopPropagation(),E(r);return}r&&E(r)}),g(e,"dblclick",s=>{let o=s,r=o.target.closest(".tab-header");if(o.target.closest(".close")&&r){let i=b(".tab-header");if(i.length<=1)return;let c=i.indexOf(r);S("#dialog-confirm-delete-tab",d=>{if(!d){T();return}let u=r.dataset.tabId;r.remove(),(u?l(`#${u}`):null)?.remove();let v=b(".tab-header")[Math.max(0,c-1)];v&&E(v),t&&t(!0),ce()});return}});let n=l("#add_tab");n&&g(n,"click",()=>{let s=l(".tab-header.active");F(!1,"",s,t)}),ht(t),ce(),R(),window.addEventListener("resize",R)}function R(){let t=l("#menubar"),e=l("#main-content-outter"),n=l(".tab-headers");if(!t||!e||!n)return;let s=t.getBoundingClientRect().height;e.style.top=`${s}px`;let o=window.innerHeight-s;e.style.height=`${o}px`;let r=b(".tab-panel"),a=n.getBoundingClientRect().height;r.forEach(i=>{i.style.height=`${Math.max(0,o-a)}px`}),b(".tab-panel").forEach(i=>{let c=i.querySelector("textarea.textarea-contents"),d=i.querySelector(".line-gutter");if(c&&d){let u=Math.round(c.scrollTop||0);d.style.setProperty("--gutter-scroll-y",String(-u)),d.style.setProperty("--gutter-before-transform",`translateY(${-u}px)`),d.style.removeProperty("top"),d.style.transform="translateZ(0)"}})}async function _(t,e){let n=await ie(),s=t?t.split(n):[""];b(".tab-header").forEach(r=>r.remove()),b(".tab-panel").forEach(r=>r.remove()),Re=0;for(let r=0;r<s.length;r++){let a=s[r]??"";a.startsWith("\u267B Reload this website to hide mobile app metadata! \u267B")?e.setMobileAppMetadataTabContent(a):F(!0,a,null,()=>e.updateIsTextModified(!0))}b(".tab-header").length===0&&F(!0,"",null,()=>e.updateIsTextModified(!0));let o=l(".tab-header");o&&E(o)}async function ze(t){let e=await ie(),n="",s=b(".tab-header");for(let r=0;r<s.length;r++){let a=s[r];if(!a)continue;let i=a.dataset.tabId,c=i?l(`#${i} textarea.textarea-contents`):null,d=a.dataset.tabColor;r>0&&(n+=e),d&&d!=="#ffffff"&&(n+=`__CRYPTEXA_COLOR__:${d}
`),n+=c?.value||""}let o=t.getMobileAppMetadataTabContent();return typeof o=="string"&&o.length>0&&(n+=e+o),n}var m={isOpen:!1,query:"",results:[],selectedIndex:-1},P=null,w=null,x=null;function mt(t){if(!t||t.length<2)return[];let e=[],n=b(".tab-header"),s=t.toLowerCase();for(let o of n){let r=o.dataset.tabId;if(!r)continue;let a=o.querySelector(".tab-title")?.textContent||"Untitled",i=l(`#${r} .textarea-contents`);if(!i)continue;let d=i.value.split(`
`);for(let u=0;u<d.length;u++){let h=d[u];if(!h)continue;let f=h.toLowerCase(),v=f.indexOf(s);for(;v!==-1;)e.push({tabId:r,tabTitle:a,lineNumber:u+1,lineContent:h,matchStart:v,matchEnd:v+t.length}),v=f.indexOf(s,v+1)}}return e}function ft(t){let e=z(t.lineContent.substring(0,t.matchStart)),n=z(t.lineContent.substring(t.matchStart,t.matchEnd)),s=z(t.lineContent.substring(t.matchEnd)),o=60,r=e,a=s;return e.length>o/2&&(r="..."+e.substring(e.length-o/2)),s.length>o/2&&(a=s.substring(0,o/2)+"..."),`${r}<mark>${n}</mark>${a}`}function z(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function j(){if(!x)return;if(m.results.length===0){m.query.length>=2?x.innerHTML=`
                <div class="search-no-results">
                    <span class="search-no-results-icon">\u{1F50D}</span>
                    <span>No matches found for "<strong>${z(m.query)}</strong>"</span>
                </div>
            `:m.query.length>0?x.innerHTML=`
                <div class="search-hint">Type at least 2 characters to search</div>
            `:x.innerHTML=`
                <div class="search-hint">Start typing to search across all tabs</div>
            `;return}let t=m.results.map((e,n)=>`
        <div class="search-result${n===m.selectedIndex?" selected":""}" 
             data-index="${n}"
             data-tab-id="${e.tabId}"
             data-line="${e.lineNumber}">
            <div class="search-result-header">
                <span class="search-result-tab">\u{1F4C4} ${z(e.tabTitle)}</span>
                <span class="search-result-line">Line ${e.lineNumber}</span>
            </div>
            <div class="search-result-content">${ft(e)}</div>
        </div>
    `).join("");x.innerHTML=`
        <div class="search-results-header">
            Found ${m.results.length} match${m.results.length===1?"":"es"}
        </div>
        ${t}
    `}function Ge(t){let e=l(`.tab-header[data-tab-id="${t.tabId}"]`);e&&(E(e),setTimeout(()=>{let n=l(`#${t.tabId} .textarea-contents`);if(!n)return;let s=n.value.split(`
`),o=0;for(let i=0;i<t.lineNumber-1;i++){let c=s[i]?.length??0;o+=c+1}o+=t.matchStart,n.focus(),n.setSelectionRange(o,o+(t.matchEnd-t.matchStart));let r=parseInt(getComputedStyle(n).lineHeight)||24,a=(t.lineNumber-5)*r;n.scrollTop=Math.max(0,a)},100)),pe()}function gt(t){if(t.key==="ArrowDown")t.preventDefault(),m.results.length>0&&(m.selectedIndex=Math.min(m.selectedIndex+1,m.results.length-1),j(),Ue());else if(t.key==="ArrowUp")t.preventDefault(),m.results.length>0&&(m.selectedIndex=Math.max(m.selectedIndex-1,0),j(),Ue());else if(t.key==="Enter"){t.preventDefault();let e=m.results[m.selectedIndex];m.selectedIndex>=0&&e&&Ge(e)}else t.key==="Escape"&&(t.preventDefault(),pe())}function Ue(){let t=x?.querySelector(".search-result.selected");t&&t.scrollIntoView({block:"nearest",behavior:"smooth"})}function bt(){w&&(m.query=w.value,m.results=mt(m.query),m.selectedIndex=m.results.length>0?0:-1,j())}function yt(t){let e=t.target.closest(".search-result");if(!e)return;let n=parseInt(e.getAttribute("data-index")||"-1",10),s=m.results[n];n>=0&&s&&Ge(s)}function ue(){P||Ve(),m={isOpen:!0,query:"",results:[],selectedIndex:-1},w&&(w.value=""),j(),P?.showModal(),setTimeout(()=>{w?.focus()},50)}function pe(){m.isOpen=!1,P?.close()}function Ve(){if(P=l("#search-dialog"),P){w=l("#search-input"),x=l("#search-results");return}let t=document.createElement("dialog");t.id="search-dialog",t.className="app-dialog search-dialog",t.innerHTML=`
        <form method="dialog">
            <div class="search-header">
                <div class="search-input-wrapper">
                    <span class="search-icon">\u{1F50D}</span>
                    <input type="text" 
                           id="search-input" 
                           class="search-input" 
                           placeholder="Search across all tabs..."
                           autocomplete="off"
                           spellcheck="false" />
                    <kbd class="search-kbd">Esc</kbd>
                </div>
            </div>
            <div id="search-results" class="search-results"></div>
            <div class="search-footer">
                <span>\u2191\u2193 Navigate</span>
                <span>\u21B5 Go to</span>
                <span>Esc Close</span>
            </div>
        </form>
    `,document.body.appendChild(t),P=t,w=l("#search-input"),x=l("#search-results"),w&&(g(w,"input",bt),g(w,"keydown",gt)),x&&g(x,"click",yt),g(t,"click",e=>{e.target===t&&pe()})}function We(){Ve(),g(document,"keydown",t=>{(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key.toLowerCase()==="f"&&(t.preventDefault(),ue())})}function he(t){if(!t||t.length===0)return{level:"weak",score:0,label:"Enter password",color:"var(--muted)",feedback:[]};let e=0,n=[];t.length>=16?e+=30:t.length>=12?e+=25:t.length>=8?e+=15:t.length>=6?e+=10:n.push("Use at least 8 characters");let s=/[a-z]/.test(t),o=/[A-Z]/.test(t),r=/\d/.test(t),a=/[!@#$%^&*()_+\-=[\]{}|;':",.<>?/`~\\]/.test(t),i=/\s/.test(t);s?e+=10:n.push("Add lowercase letters"),o?e+=10:n.push("Add uppercase letters"),r?e+=15:n.push("Add numbers"),a?e+=20:n.push("Add special characters (!@#$%...)"),i&&t.split(" ").length>=3&&(e+=5);let c=[/^12345/,/^password/i,/^qwerty/i,/^abc123/i,/(.)\1{3,}/,/^[a-z]+$/i,/^\d+$/];for(let f of c)f.test(t)&&(e=Math.max(0,e-20),n.includes("Avoid common patterns")||n.push("Avoid common patterns"));t.length>=20&&i&&(e=Math.min(100,e+10));let d,u,h;return e>=85?(d="very-strong",u="Very Strong",h="var(--accent)"):e>=70?(d="strong",u="Strong",h="#22c55e"):e>=50?(d="good",u="Good",h="#eab308"):e>=30?(d="fair",u="Fair",h="var(--warning)"):(d="weak",u="Weak",h="var(--danger)"),{level:d,score:Math.min(100,Math.max(0,e)),label:u,color:h,feedback:n.slice(0,3)}}function vt(){let t=document.createElement("div");return t.className="password-strength",t.innerHTML=`
        <div class="password-strength-bar">
            <div class="password-strength-fill"></div>
        </div>
        <div class="password-strength-info">
            <span class="password-strength-label"></span>
            <span class="password-strength-feedback"></span>
        </div>
    `,t}function me(t,e){let n=t.querySelector(".password-strength-fill"),s=t.querySelector(".password-strength-label"),o=t.querySelector(".password-strength-feedback");n&&(n.style.width=`${e.score}%`,n.style.backgroundColor=e.color,n.setAttribute("data-level",e.level)),s&&(s.textContent=e.label,s.style.color=e.color),o&&(o.textContent=e.feedback.join(" \u2022 "))}function je(t){let e=l(t);if(!e)return null;let n=e.parentElement?.querySelector(".password-strength");if(n)return n;let s=vt();return e.parentNode?.insertBefore(s,e.nextSibling),e.addEventListener("input",()=>{let o=he(e.value);me(s,o)}),me(s,he(e.value)),s}function Ye(){l("#newpassword1")&&je("#newpassword1");let e=new MutationObserver(s=>{for(let o of s)if(o.type==="attributes"&&o.attributeName==="open"){let r=o.target;if(r.id==="dialog-new-password"&&r.open&&l("#newpassword1")){r.querySelector(".password-strength")||je("#newpassword1");let c=r.querySelector(".password-strength");c&&me(c,he(""))}}}),n=l("#dialog-new-password");n&&e.observe(n,{attributes:!0})}var Tt=15e4;async function fe(t,e,n=Tt){let s=I(e),o=await crypto.subtle.importKey("raw",$.encode(t),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:n,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function Xe(t,e,n){let s=V(12),o=await fe(e,n),r=await crypto.subtle.encrypt({name:"AES-GCM",iv:I(s)},o,$.encode(t));return{ivHex:s,cipherHex:G(r)}}async function Ze(t,e,n,s){let o=await fe(n,s);try{let r=await crypto.subtle.decrypt({name:"AES-GCM",iv:I(t)},o,I(e));return $e.decode(r)}catch{return""}}var C=()=>{},Qe=async()=>"",ge=async()=>{};function Je(t){t.focusActiveTextarea&&(C=t.focusActiveTextarea),t.getContentFromTabs&&(Qe=t.getContentFromTabs),t.setContentOfTabs&&(ge=t.setContentOfTabs)}var Y=class{constructor(e,n=null){this.site=e,this.urlPassword=n,this.currentDBVersion=2,this.expectedDBVersion=2,this.siteHash=null,this.isTextModified=!1,this.initHashContent=null,this.content="",this.password="",this.initialIsNew=!0,this.mobileAppMetadataTabContent="",this.remote={isNew:!0,eContent:null,currentHashContent:null},this.onButtonEnablementChange=void 0,this.onStatusChange=void 0,this.onLastSavedUpdate=void 0,this.onFinishInitialization=void 0,this.onDecryptAndFinish=void 0}getIsNew(){return!!this.remote.isNew}getInitialIsNew(){return this.initialIsNew}getIsTextModified(){return this.isTextModified}getContent(){return this.content}getPassword(){return this.password}getMobileAppMetadataTabContent(){return this.mobileAppMetadataTabContent}setMobileAppMetadataTabContent(e){this.mobileAppMetadataTabContent=e||""}updateIsTextModified(e){this.isTextModified!==e&&(this.isTextModified=e,this.onButtonEnablementChange&&this.onButtonEnablementChange(this.isTextModified,this.getIsNew()))}async init(){this.siteHash=await ae(this.site),await this.reloadFromServer(),this.initialIsNew=this.getIsNew()}computeHashContentForDBVersion(e,n,s){return qe(`${e}::${n}`)+String(s)}setInitHashContent(){this.remote.currentHashContent?this.initHashContent=this.remote.currentHashContent:this.initHashContent=this.computeHashContentForDBVersion(this.content,this.password||"",this.currentDBVersion)}async _getDecryptedContent(e){if(!this.remote.eContent)return null;try{let n=this.remote.eContent.split(":");if(n.length!==3)return null;let s=n[0],o=n[1],r=n[2];if(!s||!o||!r)return null;let a=await Ze(o,r,e,s);return a&&this.siteHash&&a.endsWith(this.siteHash)?a:null}catch{return null}}async setLoginPasswordAndContentIfCorrect(e){let n=await this._getDecryptedContent(e);return n!==null&&this.siteHash?(this.content=n.slice(0,n.length-this.siteHash.length),this.password=e,!0):!1}async saveSite(e){let n=async s=>{this.content=await Qe(this);let o=this.computeHashContentForDBVersion(this.content,s,this.expectedDBVersion),r=V(16),{ivHex:a,cipherHex:i}=await Xe(String(this.content+this.siteHash),s,r),c=`${r}:${a}:${i}`;H(!0);try{let d=await J("/api/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({site:this.site,initHashContent:this.initHashContent||"",currentHashContent:o,encryptedContent:c})});if(!d.ok)throw new Error(`HTTP ${d.status}: ${d.statusText}`);let u=await d.json();u.status==="success"?(y("Saved!","success",1500),this.remote.isNew=!1,this.remote.eContent=c,this.remote.currentHashContent=u.currentHashContent||o,this.initHashContent=this.remote.currentHashContent,this.password=s,this.currentDBVersion=this.expectedDBVersion,this.isTextModified=!1,this.onStatusChange&&this.onStatusChange("ready","Ready"),this.onLastSavedUpdate&&this.onLastSavedUpdate(),this.onFinishInitialization&&this.onFinishInitialization(!0)):u.message?(u.message.includes("modified in the meantime")?y("Failed! Content was modified by another session. Use Ctrl+R to reload and see changes, then try saving again.","error",5e3):y("Failed! "+u.message,"error",2500),C()):(y("Save failed!","error",2500),C())}catch(d){console.error("Save operation failed:",d);let u="Save failed!",h=d;h.name==="AbortError"?u+=" <br/> <span style='font-size: 0.9em; font-weight: normal'>(request timeout)</span>":h.message.includes("HTTP")?u+=` <br/> <span style='font-size: 0.9em; font-weight: normal'>(${h.message})</span>`:u+=" <br/> <span style='font-size: 0.9em; font-weight: normal'>(connection issue)</span>",y(u,"error",2500),C()}finally{H(!1)}};e===!0?He({title:this.getIsNew()?"Create password":"Change password",onSave:async(s,o)=>s.length===0?(te("#passwords-empty"),k("#passwords-dont-match"),!1):s!==o?(te("#passwords-dont-match"),k("#passwords-empty"),!1):(await n(s),!0)}):await n(this.password)}async deleteSite(){let e=async()=>{H(!0);try{let n=await J("/api/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({site:this.site,initHashContent:this.initHashContent||""})});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);(await n.json()).status==="success"?(y("Site was deleted!","success",2e3),setTimeout(async()=>{this.password="",this.content="",this.remote={isNew:!0,eContent:null,currentHashContent:null},await ge("",this),this.initialIsNew=!0,this.onFinishInitialization&&this.onFinishInitialization()},2200)):y("Failed! Site was modified in the meantime. Reload first.","error",5e3)}catch(n){console.error("Delete operation failed:",n);let s="Deleting failed!",o=n;o.name==="AbortError"?s+=" <br/> <span style='font-size: 0.9em; font-weight: normal'>(request timeout)</span>":o.message.includes("HTTP")?s+=` <br/> <span style='font-size: 0.9em; font-weight: normal'>(${o.message})</span>`:s+=" <br/> <span style='font-size: 0.9em; font-weight: normal'>(connection issue)</span>",y(s,"error",2500),C()}finally{H(!1)}};S("#dialog-confirm-delete-site",async n=>{n?Ce({onOk:async s=>this.remote.eContent?await this._getDecryptedContent(s)!==null?(await e(),!0):!1:s===this.password?(await e(),!0):!1}):C()})}async reloadFromServer(){let e=`/api/json?site=${encodeURIComponent(this.site)}`,s=await(await fetch(e)).json();if(s.status!=="success")throw new Error("Server error");this.remote.isNew=!!s.isNew,this.remote.eContent=s.isNew?null:s.eContent||null,this.currentDBVersion=s.currentDBVersion||2,this.expectedDBVersion=s.expectedDBVersion||2,this.remote.currentHashContent=s.currentHashContent||null,this.initHashContent=this.remote.currentHashContent||null}async reloadSite(){let e=async()=>{H(!0);try{if(await this.reloadFromServer(),y("Reloaded!","success",500),this.isTextModified=!1,this.onStatusChange&&this.onStatusChange("ready","Ready"),this.remote.isNew||!this.remote.eContent){this.content="";let n=(window.location.pathname||"/").replace(/^\/+|\/+$/g,""),s=!!(n&&n!=="api"),o=!!new URL(window.location.href).searchParams.get("site");if(!s&&!o){await ge("",this),this.onFinishInitialization&&this.onFinishInitialization();return}this.onFinishInitialization&&this.onFinishInitialization()}else{if(this.urlPassword&&await this.setLoginPasswordAndContentIfCorrect(this.urlPassword)){this.onFinishInitialization&&this.onFinishInitialization();return}if(!await this.setLoginPasswordAndContentIfCorrect(this.password)){this.onDecryptAndFinish&&this.onDecryptAndFinish(!1);return}this.onDecryptAndFinish&&this.onDecryptAndFinish(!0)}}catch{y("Reloading failed! <br/> <span style='font-size: 0.9em; font-weight: normal'>(connection issue)</span>","error",2500),C()}finally{H(!1)}};this.isTextModified?S("#dialog-confirm-reload",async n=>{n?await e():C()}):await e()}};Je({focusActiveTextarea:T,getContentFromTabs:ze,setContentOfTabs:_});function Te(t){let n=new URL(window.location.href).searchParams.get(t);return n&&n.trim().length?n.trim():null}function wt(){let e=(window.location.pathname||"/").replace(/^\/+|\/+$/g,"");return e&&e!=="api"?e:Te("site")||"local-notes"}var be=wt(),ye=function(){let t=Te("password");if(t)return t;let e=window.location.search||"";return e.startsWith("?")&&e.length>1&&!e.includes("=")?decodeURIComponent(e.substring(1)):null}(),p=new Y(be,ye);window.state=p;var ve=!0,X=null;function xt(){document.addEventListener("keydown",t=>{let e=t.target;if(e.tagName==="INPUT"&&e.type!=="color")return;let n=t.ctrlKey||t.metaKey,s=t.shiftKey,o=t.altKey;if(n&&t.key==="s"){t.preventDefault(),document.getElementById("button-save")?.click();return}if(n&&o&&(t.key==="t"||t.key==="T")){t.preventDefault(),document.getElementById("add_tab")?.click();return}if(n&&t.key==="r"){t.preventDefault(),document.getElementById("button-reload")?.click();return}if(n&&s&&t.key==="P"){t.preventDefault(),document.getElementById("button-savenew")?.click();return}if(n&&s&&(t.key==="g"||t.key==="G")){t.preventDefault(),document.getElementById("theme-toggle")?.click();return}if(n&&t.key>="1"&&t.key<="9"){t.preventDefault();let r=parseInt(t.key)-1,a=document.querySelectorAll(".tab-header");a[r]&&a[r].querySelector(".tab-title")?.click();return}if(n&&t.key==="Tab"&&!s){t.preventDefault();let r=document.querySelectorAll(".tab-header"),i=(Array.from(r).findIndex(c=>c.classList.contains("active"))+1)%r.length;r[i]?.querySelector(".tab-title")?.click();return}if(n&&t.key==="Tab"&&s){t.preventDefault();let r=document.querySelectorAll(".tab-header"),a=Array.from(r).findIndex(c=>c.classList.contains("active")),i=a===0?r.length-1:a-1;r[i]?.querySelector(".tab-title")?.click();return}if(t.key==="F1"){t.preventDefault(),et();return}if(t.key==="Escape"){let r=document.querySelector("dialog[open]");r?r.close():T();return}})}function et(){let e=[{keys:"Ctrl+S",desc:"Save notes"},{keys:"Ctrl+Alt+T",desc:"New tab"},{keys:"Ctrl+R",desc:"Reload from server"},{keys:"Ctrl+Shift+F",desc:"Global search"},{keys:"Ctrl+1-9",desc:"Switch to tab by number"},{keys:"Ctrl+Tab",desc:"Next tab"},{keys:"Ctrl+Shift+Tab",desc:"Previous tab"},{keys:"Ctrl+Shift+P",desc:"Change password"},{keys:"Ctrl+Shift+G",desc:"Toggle theme"},{keys:"F1",desc:"Show this help"},{keys:"Escape",desc:"Close dialogs or focus editor"}].map(n=>`<strong>${n.keys}</strong>: ${n.desc}`).join("<br>");B(`<div style="text-align: left; line-height: 1.6;"><strong>\u{1F680} Keyboard Shortcuts</strong><br><br>${e}</div>`,"info",8e3)}window.addEventListener("error",t=>{console.error("Global error:",t.error),B("An unexpected error occurred. Please refresh the page.","error")});window.addEventListener("unhandledrejection",t=>{console.error("Unhandled promise rejection:",t.reason),B("A network or processing error occurred. Please try again.","error"),t.preventDefault()});"performance"in window&&window.addEventListener("load",()=>{setTimeout(()=>{let t=performance.getEntriesByType("navigation")[0];t&&console.log("Page load time:",Math.round(t.loadEventEnd-t.fetchStart),"ms")},0)});async function Et(){try{return(await fetch("/health",{method:"GET"})).ok}catch{return!1}}function Lt(){X=setInterval(async()=>{await Et()||B("Connection to server lost. Please check your internet connection.","warning")},5*60*1e3)}function Tn(){X&&(clearInterval(X),X=null)}function tt(t,e){let n=l("#button-save"),s=l("#button-savenew"),o=l("#button-reload"),r=l("#button-delete");!n||!s||!o||!r||(n.disabled=!t,p.getInitialIsNew()===!1&&t?window.onbeforeunload=()=>"If you don't 'Save', you'll lose your changes.":window.onbeforeunload=null,s.disabled=!!e,o.disabled=!1,r.disabled=!!e)}var nt=(t,e)=>{let n=l("#status-indicator"),s=l(".status-text");!n||!s||(n.classList.remove("saving","error","modified"),t&&t!=="ready"&&n.classList.add(t),s.textContent=e||"Ready")},Ct=()=>{let t=l("#last-saved");if(!t)return;let n=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});t.textContent=`Last saved: ${n}`,t.style.display="inline"},Ht=()=>{let t=l("#last-saved");t&&(t.style.display="none")};document.addEventListener("input",t=>{t.target instanceof HTMLTextAreaElement&&t.target.classList.contains("textarea-contents")&&(nt("modified","Modified"),Ht())});async function St(){if(!p.getIsNew()&&ye&&await p.setLoginPasswordAndContentIfCorrect(ye)){D();return}p.getIsNew()?(await _("",p),D()):st(!1)}async function D(t){p.setInitHashContent(),tt(p.getIsTextModified(),p.getIsNew()),T(),ve=!0,t!==!0&&_(p.getContent(),p),setTimeout(()=>{ve=!1},50);try{let e=l(".tab-panel.active"),n=e&&e.querySelector("textarea.textarea-contents");if(n){let s=n.value&&n.value.length>5e4;e&&(e.dataset.huge=s?"1":"")}}catch{}}function st(t){let e=()=>{Le({obscure:!0,hideUI:!0,onOk:async n=>n==null?(T(),!1):await p.setLoginPasswordAndContentIfCorrect(n)?(D(),!0):!1})};t===!0?p.setLoginPasswordAndContentIfCorrect(p.getPassword()).then(n=>{n?D():e()}):e()}function Mt(t){let e=`Cryptexa Encrypted Backup (${be})`,n=`<!DOCTYPE html><html><head><meta charset="utf-8"><title>${e}</title></head>
<body>
<h3>${e}</h3>
<p>Enter password to decrypt this backup locally (no network):</p>
<input type="password" id="pw" placeholder="Password"/>
<button id="dec">Decrypt</button>
<pre id="out" style="white-space:pre-wrap;margin-top:12px;"></pre>
<script>
const textEncoder = new TextEncoder(); const textDecoder = new TextDecoder();
function hexToBuf(hex){const len=hex.length/2;const out=new Uint8Array(len);for(let i=0;i<len;i++)out[i]=parseInt(hex.substr(i*2,2),16);return out.buffer;}
function bufToHex(buf){const arr=new Uint8Array(buf);let s="";for(let i=0;i<arr.length;i++)s+=arr[i].toString(16).padStart(2,"0");return s;}
async function pbkdf2KeyFromPassword(password, saltHex, iterations=150000){
  const salt=hexToBuf(saltHex);
  const baseKey=await crypto.subtle.importKey("raw", textEncoder.encode(password), {name:"PBKDF2"}, false, ["deriveKey"]);
  return await crypto.subtle.deriveKey({name:"PBKDF2",salt,iterations,hash:"SHA-256"}, baseKey, {name:"AES-GCM",length:256}, false, ["decrypt"]);
}
async function aesGcmDecryptHex(ivHex, cipherHex, password, saltHex){
  const key=await pbkdf2KeyFromPassword(password, saltHex);
  const plainBuf=await crypto.subtle.decrypt({name:"AES-GCM", iv:hexToBuf(ivHex)}, key, hexToBuf(cipherHex));
  return textDecoder.decode(plainBuf);
}
document.getElementById("dec").onclick=async()=>{
  const pw=document.getElementById("pw").value||"";
  const payload=${JSON.stringify(t)};
  const parts=payload.split(":");
  if(parts.length!==3){document.getElementById("out").textContent="Invalid payload";return;}
  const [saltHex,ivHex,cipherHex]=parts;
  try{
    const plain=await aesGcmDecryptHex(ivHex,cipherHex,pw,saltHex);
    document.getElementById("out").textContent=plain;
  }catch(e){
    document.getElementById("out").textContent="Decryption failed (wrong password?)";
  }
};
<\/script>
</body></html>`,s=new Blob([n],{type:"text/html"}),o=URL.createObjectURL(s),r=document.createElement("a");r.href=o,r.download=`cryptexa-backup-${be}.html`,document.body.appendChild(r),r.click(),URL.revokeObjectURL(o),r.remove()}function kt(){let t=0;if(document.addEventListener("input",e=>{if(!(e.target instanceof HTMLTextAreaElement)||!e.target.classList.contains("textarea-contents"))return;if(ve){e.preventDefault();return}p.updateIsTextModified(!0);let n=e.target,s=de();t&&cancelAnimationFrame(t),t=requestAnimationFrame(()=>{t=0;try{let i=n.selectionStart;!(n.value&&n.value.length>5e4)&&i<=201&&s&&(s.textContent=q(n.value.substring(0,200)))}catch{}let o=n.closest(".tab-panel"),r=o&&o.querySelector(".line-gutter"),a=o&&o.querySelector(".editor-wrap");if(r)if(n.value&&n.value.length>5e4){let c=Math.round(n.scrollTop||0);r.style.setProperty("--gutter-scroll-y",String(-c)),r.style.setProperty("--gutter-before-transform",`translateY(${-c}px)`),r.style.removeProperty("top"),r.style.transform="translateZ(0)",r._lnDebounce||(r._lnDebounce=ee(()=>L(n,r),120)),r._lnDebounce()}else L(n,r);a&&(O(n,a),K(n,a))})}),document.addEventListener("selectionchange",()=>{let e=document.activeElement;if(!(e instanceof HTMLTextAreaElement)||!e.classList.contains("textarea-contents"))return;let n=e.closest(".tab-panel"),s=n&&n.querySelector(".editor-wrap");s&&(O(e,s),K(e,s))}),document.addEventListener("mouseup",e=>{if(!(e.target instanceof HTMLTextAreaElement)||!e.target.classList.contains("textarea-contents"))return;let n=e.target,s=n.closest(".tab-panel"),o=s&&s.querySelector(".editor-wrap");o&&setTimeout(()=>{O(n,o),K(n,o)},0)}),document.addEventListener("paste",e=>{if(!(e.target instanceof HTMLTextAreaElement)||!e.target.classList.contains("textarea-contents"))return;let n=de();setTimeout(()=>{let s=e.target,o=s.value&&s.value.length>5e4;!o&&n&&(n.textContent=q());let r=s.closest(".tab-panel"),a=r&&r.querySelector(".line-gutter");a&&(o?(a._lnDebounce||(a._lnDebounce=ee(()=>L(s,a),120)),a._lnDebounce()):L(s,a))},50)}),document.addEventListener("keydown",e=>{let n=document.activeElement,s=n&&n.classList&&n.classList.contains("textarea-contents"),o=e.key||e.code;if(s&&o==="Tab"&&!e.ctrlKey&&!e.altKey&&!e.shiftKey&&!e.metaKey){e.preventDefault();let r=n.selectionStart,a=n.selectionEnd,i=n.value;n.value=i.substring(0,r)+"    "+i.substring(a),n.selectionStart=n.selectionEnd=r+4,p.updateIsTextModified(!0);return}}),g(l("#enterpassword"),"keypress",e=>{let n=e;if(n.which===13||n.key==="Enter"){n.preventDefault();let s=l("#dialog-password button[value='ok']");s&&!s.disabled&&s.click()}}),g(l("#newpassword2"),"keypress",e=>{let n=e;if(n.which===13||n.key==="Enter"){let s=l("#dialog-new-password button[value='ok']");s&&s.click(),n.preventDefault()}}),g(l("#button-save"),"click",()=>p.saveSite(p.getIsNew())),g(l("#button-savenew"),"click",()=>p.saveSite(!0)),g(l("#button-reload"),"click",()=>p.reloadSite()),g(l("#button-delete"),"click",()=>{S("#dialog-confirm-delete-site",async e=>{e?p.deleteSite():T()})}),g(l("#help-button"),"click",()=>{et()}),It(),!l("#button-export")){let e=document.createElement("button");e.id="button-export",e.textContent="Export Encrypted Backup",e.title="Download encrypted backup (before decrypt)",e.className="",l("#menubar-buttons")?.appendChild(e),g(e,"click",()=>{let n=p.remote.eContent;if(!n){y("Nothing to export yet","warning",1200);return}Mt(n)})}}function It(){document.addEventListener("keydown",t=>{let e=t.target;if(e.tagName==="INPUT"&&e.type!=="textarea")return;let n=t.ctrlKey||t.metaKey,s=t.key.toLowerCase();if(n&&s==="r"&&!t.shiftKey){t.preventDefault(),l("#button-reload").disabled||p.reloadSite();return}if(n&&s==="t"){t.preventDefault(),F(!1,"",null,()=>p.updateIsTextModified(!0));return}if(n&&s==="w"){if(b(".tab-header").length>1){t.preventDefault();let r=l(".tab-header.active");if(r){let a=r.querySelector(".close");a&&a.click()}}return}if(n&&t.shiftKey&&s==="s"){t.preventDefault(),l("#button-savenew").disabled||p.saveSite(!0);return}if(n&&s==="e"){t.preventDefault(),l("#button-export")?.click();return}if(n&&s>="1"&&s<="9"){t.preventDefault();let o=parseInt(s)-1,r=b(".tab-header");r[o]&&E(r[o]);return}if(s==="escape"){T();return}})}(async function(){p.onButtonEnablementChange=tt,p.onStatusChange=nt,p.onLastSavedUpdate=Ct,p.onFinishInitialization=D,p.onDecryptAndFinish=st,requestAnimationFrame(async()=>{let n=(window.location.pathname||"/").replace(/^\/+|\/+$/g,""),s=Te("site");(n&&n!=="api"||s)&&(await p.init(),_e(()=>p.updateIsTextModified(!0)),R(),kt(),Lt(),p.getIsNew()||!p.remote.eContent?(await _("",p),D()):(A(!0,{hide:!0}),St()))})})();document.addEventListener("DOMContentLoaded",()=>{ke(),Ie(),xt(),We(),Ye();let e=(window.location.pathname||"/").replace(/^\/+|\/+$/g,""),n=new URL(window.location.href).searchParams.get("site");Ae(!(e&&e!=="api"||n)),Ne(),Be();let o=l("#help-button");if(o&&!l("#search-button")){let a=document.createElement("button");a.id="search-button",a.title="Global Search (Ctrl+Shift+F)",a.style.cssText="padding: 6px 10px; border-radius: 6px; border: 1px solid var(--border); background: var(--panel); color: var(--text); cursor: pointer; font-size: 14px;",a.textContent="\u{1F50D}",a.addEventListener("click",ue),o.parentNode?.insertBefore(a,o)}let r=document.getElementById("tab-color-picker");r&&(r.addEventListener("input",a=>{try{let i=document.querySelector(".tab-header.active");if(i){let d=a.target.value;i.style.backgroundColor=d}}catch(i){console.error("Error updating tab color preview:",i)}}),r.addEventListener("change",a=>{try{let i=document.querySelector(".tab-header.active");if(i){let d=a.target.value;if(!/^#[0-9A-F]{6}$/i.test(d)){console.warn("Invalid color format:",d);return}i.dataset.tabColor=d,i.style.backgroundColor=d,p.updateIsTextModified(!0)}}catch(i){console.error("Error updating tab color persistence:",i)}}))});})();
