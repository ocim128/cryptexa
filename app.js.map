{
  "version": 3,
  "sources": ["src/utils/fetch.ts", "src/utils/dom.ts", "src/ui/toast.ts", "src/ui/dialogs.ts", "src/ui/themes.ts", "src/ui/kinetic.js", "src/utils/crypto-helpers.ts", "src/ui/tabs.ts", "src/ui/search.ts", "src/ui/password-strength.ts", "src/ui/tab-switcher.ts", "src/crypto/pbkdf2.ts", "src/crypto/aes-gcm.ts", "src/state/ClientState.ts", "src/app.ts"],
  "sourcesContent": ["/**\r\n * Network Utilities\r\n * Provides fetch with retry and debounce functionality\r\n */\r\n\r\n/**\r\n * Retry fetch with exponential backoff\r\n * @param url - URL to fetch\r\n * @param options - Fetch options\r\n * @param maxRetries - Maximum number of retries (default: 3)\r\n * @returns Promise resolving to Response\r\n */\r\nexport async function fetchWithRetry(\r\n    url: string,\r\n    options: RequestInit = {},\r\n    maxRetries: number = 3\r\n): Promise<Response> {\r\n    let lastError: Error | null = null;\r\n\r\n    for (let attempt = 0; attempt <= maxRetries; attempt++) {\r\n        try {\r\n            const controller = new AbortController();\r\n            const timeoutId = setTimeout(() => controller.abort(), 60000); // 60s timeout\r\n\r\n            const response = await fetch(url, {\r\n                ...options,\r\n                signal: controller.signal\r\n            });\r\n\r\n            clearTimeout(timeoutId);\r\n            return response;\r\n\r\n        } catch (error) {\r\n            lastError = error as Error;\r\n\r\n            // Don't retry on abort or non-network errors\r\n            if ((error as Error).name === 'AbortError' || attempt === maxRetries) {\r\n                throw error;\r\n            }\r\n\r\n            // Exponential backoff: 1s, 2s, 4s\r\n            const delay = Math.pow(2, attempt) * 1000;\r\n            await new Promise(resolve => setTimeout(resolve, delay));\r\n        }\r\n    }\r\n\r\n    throw lastError;\r\n}\r\n\r\n/**\r\n * Debounce function for performance\r\n * @param func - Function to debounce\r\n * @param wait - Wait time in milliseconds\r\n * @returns Debounced function\r\n */\r\nexport function debounce<T extends (...args: Parameters<T>) => void>(\r\n    func: T,\r\n    wait: number\r\n): (...args: Parameters<T>) => void {\r\n    let timeout: ReturnType<typeof setTimeout> | undefined;\r\n\r\n    return function executedFunction(...args: Parameters<T>): void {\r\n        const later = (): void => {\r\n            clearTimeout(timeout);\r\n            func(...args);\r\n        };\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(later, wait);\r\n    };\r\n}\r\n", "/**\r\n * DOM Utilities\r\n * Provides common DOM helper functions\r\n */\r\n\r\n/** Options for password mode */\r\nexport interface PasswordModeOptions {\r\n    hide?: boolean;\r\n}\r\n\r\n/** Event listener options type */\r\ntype EventListenerOptionsType = boolean | AddEventListenerOptions;\r\n\r\n/**\r\n * Query selector shorthand\r\n * @param sel - CSS selector\r\n * @param root - Root element (default: document)\r\n * @returns Element or null\r\n */\r\nexport function qs<T extends Element = Element>(\r\n    sel: string,\r\n    root: Document | Element = document\r\n): T | null {\r\n    return root.querySelector<T>(sel);\r\n}\r\n\r\n/**\r\n * Query selector all shorthand (returns array)\r\n * @param sel - CSS selector\r\n * @param root - Root element (default: document)\r\n * @returns Array of elements\r\n */\r\nexport function qsa<T extends Element = Element>(\r\n    sel: string,\r\n    root: Document | Element = document\r\n): T[] {\r\n    return Array.from(root.querySelectorAll<T>(sel));\r\n}\r\n\r\n/**\r\n * Add event listener shorthand\r\n * @param el - Element to attach listener to\r\n * @param ev - Event name\r\n * @param fn - Event handler\r\n * @param opts - Event listener options\r\n */\r\nexport function on<K extends keyof HTMLElementEventMap>(\r\n    el: HTMLElement | Document | Window,\r\n    ev: K | string,\r\n    fn: EventListenerOrEventListenerObject,\r\n    opts?: EventListenerOptionsType\r\n): void {\r\n    el.addEventListener(ev, fn, opts);\r\n}\r\n\r\n/**\r\n * Shows/hides loader element\r\n * @param onFlag - Whether to show the loader\r\n */\r\nexport function showLoader(onFlag: boolean): void {\r\n    const loader = qs<HTMLElement>(\"#loader\");\r\n    if (loader) {\r\n        loader.style.display = onFlag ? \"flex\" : \"none\";\r\n    }\r\n}\r\n\r\n/**\r\n * Ensures the obscure overlay exists in DOM\r\n * @returns The overlay element\r\n */\r\nexport function ensureObscureOverlay(): HTMLElement {\r\n    let ov = document.getElementById(\"app-obscure-overlay\");\r\n    if (!ov) {\r\n        ov = document.createElement(\"div\");\r\n        ov.id = \"app-obscure-overlay\";\r\n        ov.className = \"app-obscure-overlay hidden\";\r\n        document.body.appendChild(ov);\r\n    }\r\n    return ov;\r\n}\r\n\r\n/**\r\n * Sets password mode (obscures or reveals UI)\r\n * @param active - Whether password mode is active\r\n * @param opts - Options { hide: boolean }\r\n */\r\nexport function setPasswordMode(\r\n    active: boolean,\r\n    opts: PasswordModeOptions = { hide: false }\r\n): void {\r\n    const menubar = qs<HTMLElement>(\"#menubar\");\r\n    const main = qs<HTMLElement>(\"#main-content-outter\");\r\n    const html = document.documentElement;\r\n    const ov = ensureObscureOverlay();\r\n\r\n    if (active) {\r\n        html.classList.add(\"password-mode\");\r\n        ov.classList.remove(\"hidden\");\r\n        // Prefer masking with blur + opacity for privacy; optionally hide for stricter mode\r\n        if (opts.hide) {\r\n            menubar?.classList.add(\"app-hidden\");\r\n            main?.classList.add(\"app-hidden\");\r\n            menubar?.classList.remove(\"app-masked\");\r\n            main?.classList.remove(\"app-masked\");\r\n        } else {\r\n            menubar?.classList.add(\"app-masked\");\r\n            main?.classList.add(\"app-masked\");\r\n            menubar?.classList.remove(\"app-hidden\");\r\n            main?.classList.remove(\"app-hidden\");\r\n        }\r\n    } else {\r\n        html.classList.remove(\"password-mode\");\r\n        ov.classList.add(\"hidden\");\r\n        menubar?.classList.remove(\"app-masked\", \"app-hidden\");\r\n        main?.classList.remove(\"app-masked\", \"app-hidden\");\r\n    }\r\n}\r\n\r\n/**\r\n * Show hint element\r\n * @param sel - CSS selector\r\n */\r\nexport const showHint = (sel: string): void => {\r\n    qs<HTMLElement>(sel)?.style.setProperty('display', 'block');\r\n};\r\n\r\n/**\r\n * Hide hint element\r\n * @param sel - CSS selector\r\n */\r\nexport const hideHint = (sel: string): void => {\r\n    qs<HTMLElement>(sel)?.style.setProperty('display', 'none');\r\n};\r\n", "/**\r\n * Toast Notification System\r\n * Provides toast notifications and general notification utilities\r\n */\r\n\r\nimport { qs } from '../utils/dom.js';\r\n\r\n/** Toast notification type */\r\nexport type ToastType = 'info' | 'success' | 'error' | 'warning';\r\n\r\n/** Icon mapping for toast types */\r\nconst TOAST_ICONS: Record<ToastType, string> = {\r\n    success: '\u2713',\r\n    error: '\u2715',\r\n    warning: '\u26A0',\r\n    info: '\u2139'\r\n};\r\n\r\n/**\r\n * Enhanced toast notification system\r\n * @param message - Message to display\r\n * @param type - Type: 'info', 'success', 'error', 'warning'\r\n * @param duration - Duration in milliseconds (default: 4000)\r\n */\r\nexport function toast(\r\n    message: string,\r\n    type: ToastType = 'info',\r\n    duration: number = 4000\r\n): void {\r\n    const container = document.getElementById('toast-container');\r\n\r\n    if (!container) {\r\n        // Fallback to legacy toast\r\n        const outer = qs<HTMLElement>(\"#outer-toast\");\r\n        const el = qs<HTMLElement>(\"#toast\");\r\n        if (outer && el) {\r\n            el.innerHTML = message;\r\n            outer.style.display = \"block\";\r\n            outer.style.opacity = \"1\";\r\n            setTimeout(() => outer.style.display = \"none\", duration);\r\n        }\r\n        return;\r\n    }\r\n\r\n    const toastEl = document.createElement('div');\r\n    toastEl.className = `toast ${type}`;\r\n\r\n    const icon = TOAST_ICONS[type] || TOAST_ICONS.info;\r\n    toastEl.innerHTML = `<div class=\"toast-content\"><span class=\"toast-icon\">${icon}</span><span class=\"toast-message\">${message}</span><button class=\"toast-close\" onclick=\"this.parentElement.parentElement.remove()\">&times;</button></div>`;\r\n\r\n    container.appendChild(toastEl);\r\n    setTimeout(() => toastEl.parentElement && toastEl.remove(), duration);\r\n}\r\n\r\n/**\r\n * Shows a notification (production error handling style)\r\n * @param message - Message to display (supports HTML)\r\n * @param type - Type: 'info', 'success', 'error', 'warning'\r\n * @param duration - Duration in milliseconds (default: 5000)\r\n */\r\nexport function showNotification(\r\n    message: string,\r\n    type: ToastType = 'info',\r\n    duration: number = 5000\r\n): void {\r\n    const notification = document.createElement('div');\r\n    notification.className = `notification notification-${type}`;\r\n    notification.innerHTML = message;\r\n\r\n    // Add to DOM\r\n    document.body.appendChild(notification);\r\n\r\n    // Trigger animation\r\n    setTimeout(() => notification.classList.add('show'), 10);\r\n\r\n    // Auto remove\r\n    setTimeout(() => {\r\n        notification.classList.remove('show');\r\n        setTimeout(() => {\r\n            if (notification.parentNode) {\r\n                notification.parentNode.removeChild(notification);\r\n            }\r\n        }, 300);\r\n    }, duration);\r\n}\r\n", "/**\r\n * Dialog Management Module\r\n * Provides dialog helpers using native <dialog> element with async validation\r\n */\r\n\r\nimport { qs, setPasswordMode, hideHint } from '../utils/dom.js';\r\nimport { toast } from './toast.js';\r\n\r\n// ============================================================================\r\n// TYPES\r\n// ============================================================================\r\n\r\n/** Password dialog configuration */\r\nexport interface PasswordDialogConfig {\r\n    onOk: (password: string) => Promise<boolean>;\r\n    obscure?: boolean;\r\n    hideUI?: boolean;\r\n}\r\n\r\n/** Delete password dialog configuration */\r\nexport interface DeletePasswordDialogConfig {\r\n    onOk: (password: string) => Promise<boolean>;\r\n}\r\n\r\n/** New password dialog configuration */\r\nexport interface NewPasswordDialogConfig {\r\n    title?: string;\r\n    onSave: (pass1: string, pass2: string) => Promise<boolean>;\r\n}\r\n\r\n/** Confirm dialog callback */\r\nexport type ConfirmDialogCallback = (confirmed: boolean) => void | Promise<void>;\r\n\r\n// ============================================================================\r\n// DIALOG FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Opens password dialog for decryption\r\n * @param config - Configuration object\r\n */\r\nexport const openPasswordDialog = ({\r\n    onOk,\r\n    obscure = true,\r\n    hideUI = false\r\n}: PasswordDialogConfig): void => {\r\n    const dlg = qs<HTMLDialogElement>(\"#dialog-password\")!;\r\n    const input = qs<HTMLInputElement>(\"#enterpassword\")!;\r\n\r\n    dlg.returnValue = \"cancel\";\r\n    input.value = \"\";\r\n\r\n    if (obscure) setPasswordMode(true, { hide: hideUI });\r\n    dlg.showModal();\r\n    queueMicrotask(() => input.focus());\r\n\r\n    const btnOk = dlg.querySelector<HTMLButtonElement>(\"button[value='ok']\")!;\r\n\r\n    const handleOk = async (ev?: Event): Promise<void> => {\r\n        ev?.preventDefault?.();\r\n        btnOk.disabled = true;\r\n        try {\r\n            const success = await onOk(input.value);\r\n            if (success) {\r\n                dlg.close(\"ok\");\r\n                setPasswordMode(false);\r\n            } else {\r\n                toast(\"Wrong password\", \"error\");\r\n                input.select();\r\n                input.focus();\r\n                return; // keep dialog open\r\n            }\r\n        } finally {\r\n            btnOk.disabled = false;\r\n        }\r\n    };\r\n\r\n    btnOk.addEventListener(\"click\", handleOk, { once: false });\r\n\r\n    const cleanup = (): void => {\r\n        btnOk.removeEventListener(\"click\", handleOk);\r\n        dlg.removeEventListener(\"close\", cleanup);\r\n    };\r\n    dlg.addEventListener(\"close\", cleanup);\r\n};\r\n\r\n/**\r\n * Opens password dialog for delete confirmation\r\n * @param config - Configuration object\r\n */\r\nexport const openDeletePasswordDialog = ({ onOk }: DeletePasswordDialogConfig): void => {\r\n    const dlg = qs<HTMLDialogElement>(\"#dialog-delete-password\")!;\r\n    const input = qs<HTMLInputElement>(\"#deletepassword\")!;\r\n\r\n    dlg.returnValue = \"cancel\";\r\n    input.value = \"\";\r\n    dlg.showModal();\r\n    queueMicrotask(() => input.focus());\r\n\r\n    const btnOk = dlg.querySelector<HTMLButtonElement>(\"button[value='ok']\")!;\r\n\r\n    const handleOk = async (ev?: Event): Promise<void> => {\r\n        ev?.preventDefault?.();\r\n        btnOk.disabled = true;\r\n        try {\r\n            const success = await onOk(input.value);\r\n            if (success) {\r\n                dlg.close(\"ok\");\r\n            } else {\r\n                toast(\"Wrong password\", \"error\");\r\n                input.select();\r\n                input.focus();\r\n                return; // keep dialog open\r\n            }\r\n        } finally {\r\n            btnOk.disabled = false;\r\n        }\r\n    };\r\n\r\n    btnOk.addEventListener(\"click\", handleOk, { once: false });\r\n\r\n    const cleanup = (): void => {\r\n        btnOk.removeEventListener(\"click\", handleOk);\r\n        dlg.removeEventListener(\"close\", cleanup);\r\n    };\r\n    dlg.addEventListener(\"close\", cleanup);\r\n};\r\n\r\n/**\r\n * Opens new password creation/change dialog\r\n * @param config - Configuration object\r\n */\r\nexport const openNewPasswordDialog = ({ title, onSave }: NewPasswordDialogConfig): void => {\r\n    const dlg = qs<HTMLDialogElement>(\"#dialog-new-password\")!;\r\n    const titleEl = qs<HTMLElement>(\"#dialog-new-password-title\")!;\r\n    const p1 = qs<HTMLInputElement>(\"#newpassword1\")!;\r\n    const p2 = qs<HTMLInputElement>(\"#newpassword2\")!;\r\n\r\n    titleEl.textContent = title || \"Create password\";\r\n    hideHint(\"#passwords-empty\");\r\n    hideHint(\"#passwords-dont-match\");\r\n    dlg.returnValue = \"cancel\";\r\n    dlg.showModal();\r\n\r\n    setTimeout(() => {\r\n        p1.value = \"\";\r\n        p2.value = \"\";\r\n        p1.focus();\r\n    }, 0);\r\n\r\n    const handler = async (): Promise<void> => {\r\n        const ok = dlg.returnValue === \"ok\";\r\n        if (!ok) {\r\n            dlg.removeEventListener(\"close\", handler);\r\n            return;\r\n        }\r\n        const proceed = await onSave(p1.value, p2.value);\r\n        if (proceed) {\r\n            dlg.removeEventListener(\"close\", handler);\r\n        } else {\r\n            setTimeout(() => dlg.showModal(), 0);\r\n        }\r\n    };\r\n\r\n    dlg.addEventListener(\"close\", handler);\r\n};\r\n\r\n/**\r\n * Opens a confirmation dialog\r\n * @param selector - CSS selector for the dialog\r\n * @param cb - Callback with boolean result\r\n */\r\nexport const openConfirmDialog = (\r\n    selector: string,\r\n    cb: ConfirmDialogCallback\r\n): void => {\r\n    const dlg = qs<HTMLDialogElement>(selector)!;\r\n    dlg.returnValue = \"cancel\";\r\n    dlg.showModal();\r\n\r\n    const handler = (): void => {\r\n        dlg.removeEventListener(\"close\", handler);\r\n        cb(dlg.returnValue === \"ok\");\r\n    };\r\n\r\n    dlg.addEventListener(\"close\", handler);\r\n};\r\n", "/**\r\n * Theme Management Module\r\n * Provides theme toggling with persistence and accessibility\r\n */\r\n\r\n/** Theme preference type */\r\nexport type ThemePreference = 'light' | 'dark';\r\n\r\nconst STORAGE_KEY = 'theme-preference';\r\nconst root = document.documentElement;\r\n\r\n/**\r\n * Gets system color scheme preference\r\n * @returns System theme preference\r\n */\r\nexport function getSystemPref(): ThemePreference {\r\n    return window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches\r\n        ? 'light' : 'dark';\r\n}\r\n\r\n/**\r\n * Gets stored theme preference from localStorage\r\n * @returns Stored theme or null\r\n */\r\nexport function getStored(): string | null {\r\n    try {\r\n        return localStorage.getItem(STORAGE_KEY);\r\n    } catch {\r\n        return null;\r\n    }\r\n}\r\n\r\n/**\r\n * Stores theme preference to localStorage\r\n * @param theme - Theme to store\r\n */\r\nexport function store(theme: ThemePreference): void {\r\n    try {\r\n        localStorage.setItem(STORAGE_KEY, theme);\r\n    } catch {\r\n        void 0;\r\n    }\r\n}\r\n\r\n/**\r\n * Applies theme to document and updates toggle button\r\n * @param theme - Theme to apply\r\n */\r\nexport function applyTheme(theme: ThemePreference): void {\r\n    root.classList.remove('theme-dark', 'theme-light');\r\n    if (theme === 'light') {\r\n        root.classList.add('theme-light');\r\n    } else {\r\n        root.classList.add('theme-dark');\r\n    }\r\n    updateToggle(theme);\r\n}\r\n\r\n/**\r\n * Gets current active theme\r\n * @returns Current theme\r\n */\r\nexport function currentTheme(): ThemePreference {\r\n    const stored = getStored();\r\n    if (stored === 'dark' || stored === 'light') return stored;\r\n    if (root.classList.contains('theme-light')) return 'light';\r\n    if (root.classList.contains('theme-dark')) return 'dark';\r\n    const system = getSystemPref();\r\n    return system === 'light' ? 'light' : 'dark';\r\n}\r\n\r\n/**\r\n * Updates theme toggle button state\r\n * @param theme - Current theme\r\n */\r\nexport function updateToggle(theme: ThemePreference): void {\r\n    const btn = document.getElementById('theme-toggle');\r\n    if (!btn) return;\r\n\r\n    const label = btn.querySelector('.label');\r\n    const icon = btn.querySelector('.icon');\r\n    const isDark = theme === 'dark';\r\n\r\n    btn.setAttribute('aria-pressed', String(isDark));\r\n    if (label) label.textContent = isDark ? 'Dark' : 'Light';\r\n    if (icon) icon.textContent = isDark ? '\uD83C\uDF19' : '\uD83D\uDD06';\r\n}\r\n\r\n/**\r\n * Initializes theme on page load\r\n */\r\nexport function initTheme(): void {\r\n    const initial = (getStored() || 'light') as ThemePreference;\r\n    applyTheme(initial);\r\n}\r\n\r\n/**\r\n * Wires up theme toggle button and system preference listener\r\n */\r\nexport function wireThemeToggle(): void {\r\n    const btn = document.getElementById('theme-toggle');\r\n    if (!btn) return;\r\n\r\n    btn.addEventListener('click', () => {\r\n        const next: ThemePreference = currentTheme() === 'dark' ? 'light' : 'dark';\r\n        applyTheme(next);\r\n        store(next);\r\n    });\r\n\r\n    if (window.matchMedia) {\r\n        const mq = window.matchMedia('(prefers-color-scheme: light)');\r\n        const handleChange = (): void => {\r\n            if (getStored()) return; // user preference wins\r\n            applyTheme(getSystemPref());\r\n        };\r\n\r\n        if (mq.addEventListener) {\r\n            mq.addEventListener('change', handleChange);\r\n        } else if ('addListener' in mq) {\r\n            // Legacy support\r\n            (mq as MediaQueryList).addListener(handleChange);\r\n        }\r\n    }\r\n}\r\n", "/**\r\n * Kinetic Geometry Animation Engine\r\n * Creates mathematically satisfying motion patterns\r\n */\r\n\r\n// ============================================\r\n// LISSAJOUS CURVE RENDERER\r\n// ============================================\r\n\r\nclass LissajousRenderer {\r\n    constructor(canvas) {\r\n        this.canvas = canvas;\r\n        this.ctx = canvas.getContext('2d');\r\n        this.particles = [];\r\n        this.time = 0;\r\n        this.animationId = null;\r\n\r\n        // Lissajous parameters (a:b ratios create different patterns)\r\n        this.curves = [\r\n            { a: 3, b: 2, delta: Math.PI / 2, speed: 0.008, size: 0.35 },\r\n            { a: 5, b: 4, delta: Math.PI / 4, speed: 0.006, size: 0.25 },\r\n            { a: 3, b: 4, delta: Math.PI / 3, speed: 0.004, size: 0.45 }\r\n        ];\r\n\r\n        this.resize();\r\n        window.addEventListener('resize', () => this.resize());\r\n    }\r\n\r\n    resize() {\r\n        this.canvas.width = window.innerWidth;\r\n        this.canvas.height = window.innerHeight;\r\n        this.centerX = this.canvas.width / 2;\r\n        this.centerY = this.canvas.height / 2;\r\n    }\r\n\r\n    // Calculate point on Lissajous curve\r\n    getPoint(curve, t) {\r\n        const amplitude = Math.min(this.centerX, this.centerY) * curve.size;\r\n        const x = amplitude * Math.sin(curve.a * t + curve.delta);\r\n        const y = amplitude * Math.sin(curve.b * t);\r\n        return { x: this.centerX + x, y: this.centerY + y };\r\n    }\r\n\r\n    draw() {\r\n        // Fade effect for trail\r\n        this.ctx.fillStyle = 'rgba(15, 17, 21, 0.03)';\r\n        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n        // Draw each curve's current position\r\n        this.curves.forEach((curve, i) => {\r\n            const point = this.getPoint(curve, this.time * curve.speed);\r\n\r\n            // Draw glowing dot\r\n            const gradient = this.ctx.createRadialGradient(\r\n                point.x, point.y, 0,\r\n                point.x, point.y, 8\r\n            );\r\n            gradient.addColorStop(0, `rgba(122, 162, 255, ${0.4 - i * 0.1})`);\r\n            gradient.addColorStop(1, 'transparent');\r\n\r\n            this.ctx.beginPath();\r\n            this.ctx.arc(point.x, point.y, 8, 0, Math.PI * 2);\r\n            this.ctx.fillStyle = gradient;\r\n            this.ctx.fill();\r\n\r\n            // Small solid center\r\n            this.ctx.beginPath();\r\n            this.ctx.arc(point.x, point.y, 2, 0, Math.PI * 2);\r\n            this.ctx.fillStyle = `rgba(122, 162, 255, ${0.6 - i * 0.15})`;\r\n            this.ctx.fill();\r\n        });\r\n\r\n        this.time += 1;\r\n    }\r\n\r\n    start() {\r\n        const animate = () => {\r\n            this.draw();\r\n            this.animationId = requestAnimationFrame(animate);\r\n        };\r\n        animate();\r\n    }\r\n\r\n    stop() {\r\n        if (this.animationId) {\r\n            cancelAnimationFrame(this.animationId);\r\n            this.animationId = null;\r\n        }\r\n    }\r\n}\r\n\r\n// ============================================\r\n// ORBITAL SYSTEM GENERATOR\r\n// ============================================\r\n\r\nfunction createOrbitalSystem(container) {\r\n    const system = document.createElement('div');\r\n    system.className = 'orbital-system';\r\n\r\n    // Create orbital rings\r\n    for (let i = 1; i <= 4; i++) {\r\n        const ring = document.createElement('div');\r\n        ring.className = `orbital-ring orbital-ring--${i}`;\r\n        system.appendChild(ring);\r\n    }\r\n\r\n    // Create orbiting shapes\r\n    const shapes = ['circle', 'triangle', 'square', 'diamond'];\r\n    for (let i = 1; i <= 4; i++) {\r\n        const orbiter = document.createElement('div');\r\n        orbiter.className = `orbiter orbiter--${i}`;\r\n\r\n        const shape = document.createElement('div');\r\n        shape.className = `orbiter__shape orbiter__shape--${shapes[i - 1]}`;\r\n        orbiter.appendChild(shape);\r\n\r\n        system.appendChild(orbiter);\r\n    }\r\n\r\n    container.appendChild(system);\r\n    return system;\r\n}\r\n\r\n// ============================================\r\n// BREATHING GRID GENERATOR\r\n// ============================================\r\n\r\nfunction createBreathingGrid(container) {\r\n    const grid = document.createElement('div');\r\n    grid.className = 'breathing-grid';\r\n\r\n    // Create hexagonal layers\r\n    for (let i = 1; i <= 3; i++) {\r\n        const layer = document.createElement('div');\r\n        layer.className = `breathing-grid__layer breathing-grid__layer--${i}`;\r\n\r\n        const hexagon = document.createElement('div');\r\n        hexagon.className = 'breathing-grid__hexagon';\r\n        layer.appendChild(hexagon);\r\n\r\n        grid.appendChild(layer);\r\n    }\r\n\r\n    container.appendChild(grid);\r\n    return grid;\r\n}\r\n\r\n// ============================================\r\n// PENDULUM WAVE LOADER\r\n// ============================================\r\n\r\nfunction createPendulumLoader(container, pendulumCount = 9) {\r\n    const loader = document.createElement('div');\r\n    loader.className = 'pendulum-loader';\r\n\r\n    for (let i = 0; i < pendulumCount; i++) {\r\n        const pendulum = document.createElement('div');\r\n        pendulum.className = 'pendulum';\r\n        loader.appendChild(pendulum);\r\n    }\r\n\r\n    container.appendChild(loader);\r\n    return loader;\r\n}\r\n\r\n// ============================================\r\n// HARMONIC SPINNER\r\n// ============================================\r\n\r\nfunction createHarmonicSpinner(container, dotCount = 5) {\r\n    const spinner = document.createElement('div');\r\n    spinner.className = 'harmonic-spinner';\r\n\r\n    for (let i = 0; i < dotCount; i++) {\r\n        const dot = document.createElement('div');\r\n        dot.className = 'harmonic-dot';\r\n        spinner.appendChild(dot);\r\n    }\r\n\r\n    container.appendChild(spinner);\r\n    return spinner;\r\n}\r\n\r\n// ============================================\r\n// GEAR SYSTEM\r\n// ============================================\r\n\r\nfunction createGearSystem(container) {\r\n    const system = document.createElement('div');\r\n    system.className = 'gear-system';\r\n\r\n    for (let i = 1; i <= 3; i++) {\r\n        const gear = document.createElement('div');\r\n        gear.className = `gear gear--${i}`;\r\n        system.appendChild(gear);\r\n    }\r\n\r\n    container.appendChild(system);\r\n    return system;\r\n}\r\n\r\n// ============================================\r\n// FLOATING PARTICLES\r\n// ============================================\r\n\r\nfunction createFloatingParticles(container, count = 15) {\r\n    const particles = [];\r\n\r\n    for (let i = 0; i < count; i++) {\r\n        const particle = document.createElement('div');\r\n        particle.className = 'particle';\r\n\r\n        // Random position\r\n        particle.style.left = `${Math.random() * 100}%`;\r\n        particle.style.top = `${Math.random() * 100}%`;\r\n\r\n        // Random animation timing\r\n        particle.style.animationDelay = `${Math.random() * 20}s`;\r\n        particle.style.animationDuration = `${15 + Math.random() * 10}s`;\r\n\r\n        container.appendChild(particle);\r\n        particles.push(particle);\r\n    }\r\n\r\n    return particles;\r\n}\r\n\r\n// ============================================\r\n// KINETIC RIPPLE EFFECT\r\n// ============================================\r\n\r\nfunction addKineticRipple(element) {\r\n    element.addEventListener('click', (e) => {\r\n        const rect = element.getBoundingClientRect();\r\n        const ripple = document.createElement('span');\r\n        ripple.className = 'kinetic-ripple';\r\n\r\n        const size = Math.max(rect.width, rect.height);\r\n        ripple.style.width = ripple.style.height = `${size}px`;\r\n        ripple.style.left = `${e.clientX - rect.left - size / 2}px`;\r\n        ripple.style.top = `${e.clientY - rect.top - size / 2}px`;\r\n\r\n        element.style.position = 'relative';\r\n        element.style.overflow = 'hidden';\r\n        element.appendChild(ripple);\r\n\r\n        ripple.addEventListener('animationend', () => ripple.remove());\r\n    });\r\n}\r\n\r\n// ============================================\r\n// MAIN KINETIC INITIALIZATION\r\n// ============================================\r\n\r\nlet lissajousRenderer = null;\r\n\r\nfunction initKineticBackground(isLanding = false) {\r\n    // Check for reduced motion preference\r\n    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {\r\n        return null;\r\n    }\r\n\r\n    // Create or get container\r\n    let container = document.querySelector('.kinetic-bg');\r\n    if (!container) {\r\n        container = document.createElement('div');\r\n        container.className = 'kinetic-bg';\r\n        if (isLanding) container.classList.add('kinetic-bg--landing');\r\n        document.body.insertBefore(container, document.body.firstChild);\r\n    }\r\n\r\n    // Clear existing content\r\n    container.innerHTML = '';\r\n\r\n    if (isLanding) {\r\n        // Full kinetic experience for landing\r\n        createOrbitalSystem(container);\r\n        createBreathingGrid(container);\r\n        createFloatingParticles(container, 12);\r\n\r\n        // Add Lissajous canvas\r\n        const canvas = document.createElement('canvas');\r\n        canvas.className = 'lissajous-canvas';\r\n        container.appendChild(canvas);\r\n\r\n        lissajousRenderer = new LissajousRenderer(canvas);\r\n        lissajousRenderer.start();\r\n    } else {\r\n        // Subtle particles for main app\r\n        createFloatingParticles(container, 8);\r\n    }\r\n\r\n    return container;\r\n}\r\n\r\nfunction destroyKineticBackground() {\r\n    if (lissajousRenderer) {\r\n        lissajousRenderer.stop();\r\n        lissajousRenderer = null;\r\n    }\r\n\r\n    const container = document.querySelector('.kinetic-bg');\r\n    if (container) {\r\n        container.remove();\r\n    }\r\n}\r\n\r\n// ============================================\r\n// REPLACE DEFAULT LOADER WITH KINETIC LOADER\r\n// ============================================\r\n\r\nfunction replaceLoaderWithKinetic() {\r\n    const loader = document.querySelector('.loader');\r\n    if (!loader) return;\r\n\r\n    const spinner = loader.querySelector('.spinner');\r\n    if (spinner) {\r\n        spinner.remove();\r\n        createPendulumLoader(loader);\r\n    }\r\n}\r\n\r\n// ============================================\r\n// ADD RIPPLES TO BUTTONS\r\n// ============================================\r\n\r\nfunction initKineticButtons() {\r\n    const buttons = document.querySelectorAll('#menubar-buttons button, .landing button');\r\n    buttons.forEach(btn => addKineticRipple(btn));\r\n}\r\n\r\n// ============================================\r\n// EXPORTS\r\n// ============================================\r\n\r\nexport {\r\n    initKineticBackground,\r\n    destroyKineticBackground,\r\n    createPendulumLoader,\r\n    createHarmonicSpinner,\r\n    createGearSystem,\r\n    createOrbitalSystem,\r\n    createBreathingGrid,\r\n    replaceLoaderWithKinetic,\r\n    initKineticButtons,\r\n    addKineticRipple,\r\n    LissajousRenderer\r\n};\r\n", "/**\r\n * Crypto Helper Utilities\r\n * Provides common cryptographic utility functions\r\n */\r\n\r\nexport const textEncoder = new TextEncoder();\r\nexport const textDecoder = new TextDecoder();\r\n\r\n/**\r\n * Computes SHA-512 hash of input\r\n * @param input - Input to hash (string or Uint8Array)\r\n * @returns Hash in hex format\r\n */\r\nexport async function sha512Hex(input: string | Uint8Array): Promise<string> {\r\n    const data = typeof input === \"string\" ? textEncoder.encode(input) : input;\r\n    // TypeScript's strict mode has issues with Uint8Array -> BufferSource assignment\r\n    // but this is valid at runtime as Uint8Array implements BufferSource\r\n    const buf = await crypto.subtle.digest(\"SHA-512\", data as unknown as BufferSource);\r\n    return bufToHex(buf);\r\n}\r\n\r\n/**\r\n * Converts ArrayBuffer to hex string\r\n * @param buf - Buffer to convert\r\n * @returns Hex string\r\n */\r\nexport function bufToHex(buf: ArrayBuffer): string {\r\n    const arr = new Uint8Array(buf);\r\n    let s = \"\";\r\n    for (let i = 0; i < arr.length; i++) {\r\n        const byte = arr[i];\r\n        s += byte !== undefined ? byte.toString(16).padStart(2, \"0\") : \"\";\r\n    }\r\n    return s;\r\n}\r\n\r\n/**\r\n * Converts hex string to ArrayBuffer\r\n * @param hex - Hex string to convert\r\n * @returns ArrayBuffer\r\n */\r\nexport function hexToBuf(hex: string): ArrayBuffer {\r\n    const len = hex.length / 2;\r\n    const out = new Uint8Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n        out[i] = parseInt(hex.substr(i * 2, 2), 16);\r\n    }\r\n    return out.buffer;\r\n}\r\n\r\n/**\r\n * Generates random hex string\r\n * @param bytes - Number of bytes (default: 12)\r\n * @returns Random hex string\r\n */\r\nexport function randomHex(bytes: number = 12): string {\r\n    const b = new Uint8Array(bytes);\r\n    crypto.getRandomValues(b);\r\n    return bufToHex(b.buffer);\r\n}\r\n\r\n// ---------- Separator ----------\r\nlet separatorHexCache: string | null = null;\r\n\r\n/**\r\n * Gets the separator hex (cached)\r\n * @returns Separator hex string\r\n */\r\nexport async function getSeparatorHex(): Promise<string> {\r\n    if (!separatorHexCache) {\r\n        separatorHexCache = await sha512Hex(\"-- tab separator --\");\r\n    }\r\n    return separatorHexCache;\r\n}\r\n\r\n/**\r\n * Simple weak hash (non-crypto) only for concurrency token\r\n * @param str - String to hash\r\n * @returns Hash as hex string\r\n */\r\nexport function simpleWeakHash(str: string): string {\r\n    let h1 = 0x811c9dc5;\r\n    let h2 = 0x1000193;\r\n    for (let i = 0; i < str.length; i++) {\r\n        const c = str.charCodeAt(i);\r\n        h1 ^= c;\r\n        h1 = Math.imul(h1, 0x01000193);\r\n        h2 += c + (h2 << 1) + (h2 << 4) + (h2 << 7) + (h2 << 8) + (h2 << 24);\r\n    }\r\n    return (Math.abs(h1) + Math.abs(h2)).toString(16);\r\n}\r\n", "/**\r\n * Tab Management Module\r\n * Provides tab UI functionality including creation, activation, and drag-and-drop\r\n */\r\n\r\nimport { qs, qsa, on } from '../utils/dom.js';\r\nimport { openConfirmDialog } from './dialogs.js';\r\nimport { getSeparatorHex } from '../utils/crypto-helpers.js';\r\n\r\n// ============================================================================\r\n// TYPES\r\n// ============================================================================\r\n\r\n/** Callback when content is modified */\r\nexport type OnModifiedCallback = (modified: boolean) => void;\r\n\r\n/** State interface for content management */\r\nexport interface TabState {\r\n    getMobileAppMetadataTabContent(): string;\r\n    setMobileAppMetadataTabContent(content: string): void;\r\n    updateIsTextModified(modified: boolean): void;\r\n}\r\n\r\n/** Drag element result */\r\ninterface DragAfterResult {\r\n    offset: number;\r\n    element?: Element;\r\n}\r\n\r\n// ============================================================================\r\n// MODULE STATE\r\n// ============================================================================\r\n\r\nlet tabCounter = 1;\r\nlet currentTabTitle: Element | null = null;\r\nlet currentTextarea: HTMLTextAreaElement | null = null;\r\n\r\n// ============================================================================\r\n// GETTERS\r\n// ============================================================================\r\n\r\n/**\r\n * Gets current tab title element\r\n */\r\nexport function getCurrentTabTitle(): Element | null {\r\n    return currentTabTitle;\r\n}\r\n\r\n/**\r\n * Gets current textarea element\r\n */\r\nexport function getCurrentTextarea(): HTMLTextAreaElement | null {\r\n    return currentTextarea;\r\n}\r\n\r\n// ============================================================================\r\n// GUTTER & LINE HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Updates the gutter line numbers for a textarea\r\n */\r\nexport function updateGutterForTextarea(\r\n    ta: HTMLTextAreaElement | null,\r\n    gutter: HTMLElement | null\r\n): void {\r\n    if (!ta || !gutter) return;\r\n    const value = ta.value || \"\";\r\n    const base = value.split(\"\\n\").length;\r\n    const count = Math.max(1, base + (value.endsWith(\"\\n\") ? 1 : 0));\r\n    let out = \"1\";\r\n    for (let i = 2; i <= count; i++) out += \"\\n\" + i;\r\n    gutter.setAttribute(\"data-lines\", out);\r\n    const y = Math.round(ta.scrollTop || 0);\r\n    gutter.style.setProperty(\"--gutter-scroll-y\", String(-y));\r\n    gutter.style.setProperty(\"--gutter-before-transform\", `translateY(${-y}px)`);\r\n    gutter.style.removeProperty(\"top\");\r\n    gutter.style.transform = \"translateZ(0)\";\r\n}\r\n\r\n/**\r\n * Gets line number from character position\r\n */\r\nexport function getLineNumberFromPosition(text: string, position: number): number {\r\n    if (position < 0) return 1;\r\n    const textUpToPosition = text.substring(0, position);\r\n    return textUpToPosition.split('\\n').length;\r\n}\r\n\r\n/**\r\n * Gets line height from textarea\r\n */\r\nexport function getLineHeight(ta: HTMLTextAreaElement): number {\r\n    const computedStyle = window.getComputedStyle(ta);\r\n    return parseInt(computedStyle.lineHeight) || parseInt(computedStyle.fontSize) * 1.2;\r\n}\r\n\r\n/**\r\n * Updates active line highlight\r\n */\r\nexport function updateActiveLineHighlight(\r\n    ta: HTMLTextAreaElement,\r\n    editorWrap: Element\r\n): void {\r\n    // Remove existing active line highlights\r\n    const existingHighlights = editorWrap.querySelectorAll('.active-line');\r\n    existingHighlights.forEach(el => el.remove());\r\n\r\n    // Get cursor position\r\n    const cursorPos = ta.selectionStart;\r\n    const text = ta.value;\r\n\r\n    // Get line number\r\n    const lineNumber = getLineNumberFromPosition(text, cursorPos);\r\n\r\n    // Create highlight element\r\n    const highlight = document.createElement('div');\r\n    highlight.className = 'active-line';\r\n\r\n    // Calculate position\r\n    const lineHeight = getLineHeight(ta);\r\n    const top = (lineNumber - 1) * lineHeight + parseInt(window.getComputedStyle(ta).paddingTop);\r\n\r\n    // Set position and dimensions\r\n    highlight.style.top = `${top}px`;\r\n    highlight.style.height = `${lineHeight}px`;\r\n\r\n    // Add to editor wrap\r\n    editorWrap.appendChild(highlight);\r\n}\r\n\r\n/**\r\n * Updates selected lines highlight\r\n */\r\nexport function updateSelectedLinesHighlight(\r\n    ta: HTMLTextAreaElement,\r\n    editorWrap: Element\r\n): void {\r\n    // Remove existing selected line highlights\r\n    const existingHighlights = editorWrap.querySelectorAll('.selected-line');\r\n    existingHighlights.forEach(el => el.remove());\r\n\r\n    // Check if there's a selection\r\n    const selectionStart = ta.selectionStart;\r\n    const selectionEnd = ta.selectionEnd;\r\n\r\n    if (selectionStart === selectionEnd) return; // No selection\r\n\r\n    const text = ta.value;\r\n\r\n    // Get start and end line numbers\r\n    const startLine = getLineNumberFromPosition(text, selectionStart);\r\n    const endLine = getLineNumberFromPosition(text, selectionEnd);\r\n\r\n    // Get line height\r\n    const lineHeight = getLineHeight(ta);\r\n    const paddingTop = parseInt(window.getComputedStyle(ta).paddingTop);\r\n\r\n    // Create highlight elements for each selected line\r\n    for (let i = startLine; i <= endLine; i++) {\r\n        const highlight = document.createElement('div');\r\n        highlight.className = 'selected-line';\r\n\r\n        // Calculate position\r\n        const top = (i - 1) * lineHeight + paddingTop;\r\n\r\n        // Set position and dimensions\r\n        highlight.style.top = `${top}px`;\r\n        highlight.style.height = `${lineHeight}px`;\r\n\r\n        // Add to editor wrap\r\n        editorWrap.appendChild(highlight);\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// TAB MANAGEMENT\r\n// ============================================================================\r\n\r\n/**\r\n * Activates a tab by its header element\r\n */\r\nexport function activateTab(headerLi: Element): void {\r\n    const headers = qsa(\".tab-header\");\r\n    const panels = qsa(\".tab-panel\");\r\n    const id = (headerLi as HTMLElement).dataset.tabId;\r\n    const panel = id ? qs(`#${id}`) : null;\r\n\r\n    // Use a document fragment-like batching via requestAnimationFrame\r\n    requestAnimationFrame(() => {\r\n        headers.forEach(h => h.classList.remove(\"active\"));\r\n        panels.forEach(p => p.classList.remove(\"active\"));\r\n        headerLi.classList.add(\"active\");\r\n        if (panel) panel.classList.add(\"active\");\r\n\r\n        // Defer heavy work to idle time to keep tab switch snappy\r\n        setTimeout(() => {\r\n            focusActiveTextarea();\r\n            const ta = panel?.querySelector<HTMLTextAreaElement>(\"textarea.textarea-contents\");\r\n            const gutter = panel?.querySelector<HTMLElement>(\".line-gutter\");\r\n            if (ta && gutter) {\r\n                const y = Math.round(ta.scrollTop || 0);\r\n                gutter.style.setProperty(\"--gutter-scroll-y\", String(-y));\r\n                gutter.style.setProperty(\"--gutter-before-transform\", `translateY(${-y}px)`);\r\n                gutter.style.removeProperty(\"top\");\r\n                gutter.style.transform = \"translateZ(0)\";\r\n\r\n                // Lazy line number update for big docs\r\n                const needsHeavyUpdate = (ta.value && ta.value.length > 50000);\r\n                if (needsHeavyUpdate) {\r\n                    setTimeout(() => updateGutterForTextarea(ta, gutter), 0);\r\n                } else {\r\n                    updateGutterForTextarea(ta, gutter);\r\n                }\r\n            }\r\n        }, 0);\r\n    });\r\n}\r\n\r\n/**\r\n * Computes tab title from content\r\n */\r\nexport function getTitleFromContent(content?: string): string {\r\n    let effectiveContent: string;\r\n\r\n    if (content === undefined && currentTextarea) {\r\n        effectiveContent = currentTextarea.value.substring(0, 200);\r\n    } else {\r\n        effectiveContent = (content || \"\").substring(0, 200);\r\n    }\r\n\r\n    if (!effectiveContent) return \"Empty Tab\";\r\n\r\n    // Skip leading whitespace quickly\r\n    let start = 0;\r\n    while (start < effectiveContent.length) {\r\n        const ch = effectiveContent[start];\r\n        if (ch !== \" \" && ch !== \"\\n\" && ch !== \"\\t\" && ch !== \"\\r\" && ch !== \"\\v\" && ch !== \"\\f\") break;\r\n        start++;\r\n    }\r\n    if (start >= effectiveContent.length) return \"Empty Tab\";\r\n\r\n    // Find end of first line within the capped window\r\n    const nlRel = effectiveContent.indexOf(\"\\n\", start);\r\n    const end = nlRel === -1 ? effectiveContent.length : nlRel;\r\n    let title = effectiveContent.substring(start, end);\r\n\r\n    if (!title || title.length === 0) return \"Empty Tab\";\r\n    if (title.length > 20) title = title.substr(0, 18) + \"...\";\r\n    return title;\r\n}\r\n\r\n/**\r\n * Focuses the active textarea\r\n */\r\nexport function focusActiveTextarea(): void {\r\n    currentTabTitle = qs(\".tab-header.active .tab-title\");\r\n    const panel = qs(\".tab-panel.active\");\r\n    currentTextarea = panel ? panel.querySelector<HTMLTextAreaElement>(\"textarea.textarea-contents\") : null;\r\n    currentTextarea?.focus();\r\n}\r\n\r\n/**\r\n * Adds a new tab\r\n */\r\nexport function addTab(\r\n    isExistingTab: boolean,\r\n    contentIfAvailable: string = \"\",\r\n    insertAfter: Element | null = null,\r\n    onModified: OnModifiedCallback | null = null\r\n): Element {\r\n    const headersContainer = qs(\".tab-headers-container\")!;\r\n    const id = `tab-${tabCounter++}`;\r\n\r\n    // Parse content and color metadata\r\n    let actualContent = contentIfAvailable;\r\n    let tabColor: string | null = null;\r\n\r\n    // Check if content has color metadata\r\n    if (contentIfAvailable && contentIfAvailable.startsWith(\"__CRYPTEXA_COLOR__:\")) {\r\n        const colorEndIndex = contentIfAvailable.indexOf(\"\\n\");\r\n        if (colorEndIndex !== -1) {\r\n            const colorLine = contentIfAvailable.substring(0, colorEndIndex);\r\n            tabColor = colorLine.replace(\"__CRYPTEXA_COLOR__:\", \"\").trim();\r\n            actualContent = contentIfAvailable.substring(colorEndIndex + 1);\r\n        }\r\n    }\r\n\r\n    const li = document.createElement(\"li\");\r\n    li.className = \"tab-header\";\r\n    li.dataset.tabId = id;\r\n    li.draggable = true;\r\n\r\n    // Store color in dataset\r\n    if (tabColor) {\r\n        li.dataset.tabColor = tabColor;\r\n        li.style.backgroundColor = tabColor;\r\n    }\r\n\r\n    const a = document.createElement(\"a\");\r\n    a.href = `#${id}`;\r\n    a.className = \"tab-title\";\r\n    a.textContent = \"Empty Tab\";\r\n\r\n    const span = document.createElement(\"span\");\r\n    span.className = \"close\";\r\n    span.title = \"Remove Tab\";\r\n    span.textContent = \"\u00D7\";\r\n\r\n    li.appendChild(a);\r\n    li.appendChild(span);\r\n\r\n    if (insertAfter && insertAfter.nextSibling) {\r\n        headersContainer.insertBefore(li, insertAfter.nextSibling);\r\n    } else {\r\n        headersContainer.appendChild(li);\r\n    }\r\n\r\n    const panel = document.createElement(\"div\");\r\n    panel.id = id;\r\n    panel.className = \"tab-panel\";\r\n    panel.innerHTML = `\r\n    <div class=\"editor-wrap\">\r\n      <div class=\"line-gutter\" aria-hidden=\"true\"></div>\r\n      <textarea rows=\"1\" cols=\"1\" class=\"textarea-contents\" placeholder=\"your text goes here...\"></textarea>\r\n    </div>`;\r\n    qs(\"#tabs\")!.appendChild(panel);\r\n\r\n    const ta = panel.querySelector<HTMLTextAreaElement>(\"textarea.textarea-contents\")!;\r\n    const gutter = panel.querySelector<HTMLElement>(\".line-gutter\")!;\r\n\r\n    const updateGutter = (): void => {\r\n        updateGutterForTextarea(ta, gutter);\r\n    };\r\n\r\n    // Initial content\r\n    if (actualContent && actualContent.length > 0) {\r\n        ta.value = actualContent;\r\n        a.textContent = getTitleFromContent(actualContent.substring(0, 200));\r\n    } else {\r\n        a.textContent = getTitleFromContent(\"\");\r\n    }\r\n\r\n    // Wire updates\r\n    let rafId = 0;\r\n    ta.addEventListener(\"input\", () => {\r\n        if (rafId) cancelAnimationFrame(rafId);\r\n        rafId = requestAnimationFrame(() => {\r\n            rafId = 0;\r\n            updateGutter();\r\n        });\r\n    });\r\n\r\n    // Sync gutter vertical offset with textarea scroll\r\n    let lastScrollTs = 0;\r\n    ta.addEventListener(\"scroll\", () => {\r\n        const now = performance.now ? performance.now() : Date.now();\r\n        const isHuge = (ta.value && ta.value.length > 50000);\r\n        if (isHuge && now - lastScrollTs < 16) return;\r\n        lastScrollTs = now;\r\n        const y = Math.round(ta.scrollTop || 0);\r\n        gutter.style.setProperty(\"--gutter-scroll-y\", String(-y));\r\n        gutter.style.removeProperty(\"top\");\r\n        gutter.style.transform = \"translateZ(0)\";\r\n        gutter.style.setProperty(\"--gutter-before-transform\", `translateY(${-y}px)`);\r\n    });\r\n\r\n    // Ensure initial render\r\n    const isHuge = (ta.value && ta.value.length > 50000);\r\n    if (isHuge) {\r\n        setTimeout(updateGutter, 0);\r\n    } else {\r\n        requestAnimationFrame(updateGutter);\r\n    }\r\n\r\n    // Initialize line highlights\r\n    const editorWrap = panel.querySelector(\".editor-wrap\");\r\n    if (editorWrap) {\r\n        setTimeout(() => {\r\n            updateActiveLineHighlight(ta, editorWrap);\r\n            updateSelectedLinesHighlight(ta, editorWrap);\r\n        }, 0);\r\n    }\r\n\r\n    refreshTabs();\r\n    onWindowResize();\r\n    activateTab(li);\r\n    if (!isExistingTab && onModified) {\r\n        onModified(true);\r\n    }\r\n\r\n    return li;\r\n}\r\n\r\n/**\r\n * Refreshes tab display (shows/hides close buttons)\r\n */\r\nexport function refreshTabs(): void {\r\n    const headers = qsa(\".tab-header\");\r\n    headers.forEach(h => {\r\n        const closer = h.querySelector<HTMLElement>(\".close\");\r\n        if (closer) closer.style.display = headers.length > 1 ? \"\" : \"none\";\r\n    });\r\n    focusActiveTextarea();\r\n}\r\n\r\n// ============================================================================\r\n// DRAG AND DROP\r\n// ============================================================================\r\n\r\n/**\r\n * Gets the element to insert before during drag-and-drop\r\n */\r\nfunction getDragAfterElement(container: Element, x: number): Element | undefined {\r\n    const draggableElements = [...container.querySelectorAll(\".tab-header:not([style*='opacity'])\")];\r\n\r\n    return draggableElements.reduce<DragAfterResult>((closest, child) => {\r\n        const box = child.getBoundingClientRect();\r\n        const offset = x - box.left - box.width / 2;\r\n\r\n        if (offset < 0 && offset > closest.offset) {\r\n            return { offset: offset, element: child };\r\n        } else {\r\n            return closest;\r\n        }\r\n    }, { offset: Number.NEGATIVE_INFINITY }).element;\r\n}\r\n\r\n/**\r\n * Initializes tab drag-and-drop functionality\r\n */\r\nexport function initTabDragAndDrop(onModified: OnModifiedCallback | null = null): void {\r\n    let draggedTab: HTMLElement | null = null;\r\n    let draggedPanel: Element | null = null;\r\n\r\n    const container = qs(\".tab-headers-container\")!;\r\n\r\n    container.addEventListener(\"dragstart\", (e) => {\r\n        const event = e as DragEvent;\r\n        const tabHeader = (event.target as Element).closest<HTMLElement>(\".tab-header\");\r\n        if (!tabHeader) return;\r\n\r\n        draggedTab = tabHeader;\r\n        draggedPanel = qs(`#${tabHeader.dataset.tabId}`);\r\n        if (event.dataTransfer) {\r\n            event.dataTransfer.effectAllowed = \"move\";\r\n            event.dataTransfer.setData(\"text/html\", tabHeader.outerHTML);\r\n        }\r\n\r\n        setTimeout(() => {\r\n            tabHeader.style.opacity = \"0.5\";\r\n        }, 0);\r\n    });\r\n\r\n    container.addEventListener(\"dragend\", (e) => {\r\n        const tabHeader = (e.target as Element).closest<HTMLElement>(\".tab-header\");\r\n        if (tabHeader) {\r\n            tabHeader.style.opacity = \"\";\r\n        }\r\n        draggedTab = null;\r\n        draggedPanel = null;\r\n    });\r\n\r\n    container.addEventListener(\"dragover\", (e) => {\r\n        e.preventDefault();\r\n        const event = e as DragEvent;\r\n        if (event.dataTransfer) {\r\n            event.dataTransfer.dropEffect = \"move\";\r\n        }\r\n\r\n        const afterElement = getDragAfterElement(container, event.clientX);\r\n        const dragging = qs(\".tab-header[style*='opacity']\");\r\n\r\n        if (!dragging) return;\r\n\r\n        if (afterElement == null) {\r\n            container.appendChild(dragging);\r\n        } else {\r\n            container.insertBefore(dragging, afterElement);\r\n        }\r\n    });\r\n\r\n    container.addEventListener(\"drop\", (e) => {\r\n        e.preventDefault();\r\n\r\n        if (!draggedTab || !draggedPanel) return;\r\n\r\n        const tabsContainer = qs(\"#tabs\")!;\r\n        const afterElement = getDragAfterElement(container, (e as DragEvent).clientX);\r\n\r\n        if (afterElement == null) {\r\n            tabsContainer.appendChild(draggedPanel);\r\n        } else {\r\n            const afterPanelId = (afterElement as HTMLElement).dataset.tabId;\r\n            const afterPanel = afterPanelId ? qs(`#${afterPanelId}`) : null;\r\n            if (afterPanel) {\r\n                tabsContainer.insertBefore(draggedPanel, afterPanel);\r\n            }\r\n        }\r\n\r\n        if (onModified) onModified(true);\r\n    });\r\n}\r\n\r\n// ============================================================================\r\n// INITIALIZATION\r\n// ============================================================================\r\n\r\n/**\r\n * Initializes tabs layout with event listeners\r\n */\r\nexport function initTabsLayout(onModified: OnModifiedCallback | null = null): void {\r\n    const headersContainer = qs(\".tab-headers-container\");\r\n    if (!headersContainer) return;\r\n\r\n    // Single click for tab switching only\r\n    on(headersContainer as HTMLElement, \"click\", (e) => {\r\n        const event = e as MouseEvent;\r\n        const li = (event.target as Element).closest(\".tab-header\");\r\n        const close = (event.target as Element).closest(\".close\");\r\n\r\n        if (close && li) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            activateTab(li);\r\n            return;\r\n        }\r\n\r\n        if (li) activateTab(li);\r\n    });\r\n\r\n    // Double click for close button and color picker\r\n    on(headersContainer as HTMLElement, \"dblclick\", (e) => {\r\n        const event = e as MouseEvent;\r\n        const li = (event.target as Element).closest<HTMLElement>(\".tab-header\");\r\n        const close = (event.target as Element).closest(\".close\");\r\n\r\n        if (close && li) {\r\n            const headers = qsa(\".tab-header\");\r\n            if (headers.length <= 1) return;\r\n            const idx = headers.indexOf(li);\r\n            openConfirmDialog(\"#dialog-confirm-delete-tab\", (ok) => {\r\n                if (!ok) {\r\n                    focusActiveTextarea();\r\n                    return;\r\n                }\r\n                const tabId = li.dataset.tabId;\r\n                li.remove();\r\n                const panel = tabId ? qs(`#${tabId}`) : null;\r\n                panel?.remove();\r\n                const newHeaders = qsa(\".tab-header\");\r\n                const toActivate = newHeaders[Math.max(0, idx - 1)];\r\n                if (toActivate) activateTab(toActivate);\r\n                if (onModified) onModified(true);\r\n                refreshTabs();\r\n            });\r\n            return;\r\n        }\r\n    });\r\n\r\n    const addTabBtn = qs(\"#add_tab\");\r\n    if (addTabBtn) {\r\n        on(addTabBtn as HTMLElement, \"click\", () => {\r\n            const activeTab = qs(\".tab-header.active\");\r\n            addTab(false, \"\", activeTab, onModified);\r\n        });\r\n    }\r\n\r\n    initTabDragAndDrop(onModified);\r\n    refreshTabs();\r\n    onWindowResize();\r\n    window.addEventListener(\"resize\", onWindowResize);\r\n}\r\n\r\n/**\r\n * Handles window resize\r\n */\r\nexport function onWindowResize(): void {\r\n    const menubar = qs<HTMLElement>(\"#menubar\");\r\n    const outter = qs<HTMLElement>(\"#main-content-outter\");\r\n    const headers = qs<HTMLElement>(\".tab-headers\");\r\n\r\n    if (!menubar || !outter || !headers) return;\r\n\r\n    const top = menubar.getBoundingClientRect().height;\r\n    outter.style.top = `${top}px`;\r\n    const h = window.innerHeight - top;\r\n    outter.style.height = `${h}px`;\r\n    const panels = qsa<HTMLElement>(\".tab-panel\");\r\n    const headerH = headers.getBoundingClientRect().height;\r\n    panels.forEach(p => {\r\n        p.style.height = `${Math.max(0, h - headerH)}px`;\r\n    });\r\n\r\n    // Keep gutter scroll offset aligned after resizes\r\n    qsa(\".tab-panel\").forEach(panel => {\r\n        const ta = panel.querySelector<HTMLTextAreaElement>(\"textarea.textarea-contents\");\r\n        const gutter = panel.querySelector<HTMLElement>(\".line-gutter\");\r\n        if (ta && gutter) {\r\n            const y = Math.round(ta.scrollTop || 0);\r\n            gutter.style.setProperty(\"--gutter-scroll-y\", String(-y));\r\n            gutter.style.setProperty(\"--gutter-before-transform\", `translateY(${-y}px)`);\r\n            gutter.style.removeProperty(\"top\");\r\n            gutter.style.transform = \"translateZ(0)\";\r\n        }\r\n    });\r\n}\r\n\r\n// ============================================================================\r\n// CONTENT MANAGEMENT\r\n// ============================================================================\r\n\r\n/**\r\n * Sets content for all tabs from a combined string\r\n */\r\nexport async function setContentOfTabs(content: string, state: TabState): Promise<void> {\r\n    const sep = await getSeparatorHex();\r\n    const parts = content ? content.split(sep) : [\"\"];\r\n    qsa(\".tab-header\").forEach(h => h.remove());\r\n    qsa(\".tab-panel\").forEach(p => p.remove());\r\n\r\n    tabCounter = 0;\r\n    for (let i = 0; i < parts.length; i++) {\r\n        const part = parts[i] ?? \"\";\r\n        if (part.startsWith(\"\u267B Reload this website to hide mobile app metadata! \u267B\")) {\r\n            state.setMobileAppMetadataTabContent(part);\r\n        } else {\r\n            addTab(true, part, null, () => state.updateIsTextModified(true));\r\n        }\r\n    }\r\n    if (qsa(\".tab-header\").length === 0) {\r\n        addTab(true, \"\", null, () => state.updateIsTextModified(true));\r\n    }\r\n    const first = qs(\".tab-header\");\r\n    if (first) activateTab(first);\r\n}\r\n\r\n/**\r\n * Gets combined content from all tabs\r\n */\r\nexport async function getContentFromTabs(state: TabState): Promise<string> {\r\n    const sep = await getSeparatorHex();\r\n    let all = \"\";\r\n    const headers = qsa<HTMLElement>(\".tab-header\");\r\n\r\n    for (let i = 0; i < headers.length; i++) {\r\n        const header = headers[i];\r\n        if (!header) continue;\r\n        const id = header.dataset.tabId;\r\n        const ta = id ? qs<HTMLTextAreaElement>(`#${id} textarea.textarea-contents`) : null;\r\n        const tabColor = header.dataset.tabColor;\r\n\r\n        if (i > 0) all += sep;\r\n\r\n        // Add color metadata if tab has a color\r\n        if (tabColor && tabColor !== \"#ffffff\") {\r\n            all += `__CRYPTEXA_COLOR__:${tabColor}\\n`;\r\n        }\r\n\r\n        all += ta?.value || \"\";\r\n    }\r\n\r\n    const meta = state.getMobileAppMetadataTabContent();\r\n    if (typeof meta === \"string\" && meta.length > 0) {\r\n        all += sep + meta;\r\n    }\r\n    return all;\r\n}\r\n\r\n/**\r\n * Resets tab counter (for reinitialization)\r\n */\r\nexport function resetTabCounter(): void {\r\n    tabCounter = 0;\r\n}\r\n", "/**\r\n * Global Search Module\r\n * Provides global search functionality across all tabs\r\n */\r\n\r\nimport { qs, qsa, on } from '../utils/dom.js';\r\nimport { activateTab } from './tabs.js';\r\n\r\n// ============================================================================\r\n// TYPES\r\n// ============================================================================\r\n\r\n/** Search result item */\r\nexport interface SearchResult {\r\n    tabId: string;\r\n    tabTitle: string;\r\n    lineNumber: number;\r\n    lineContent: string;\r\n    matchStart: number;\r\n    matchEnd: number;\r\n}\r\n\r\n/** Search state */\r\ninterface SearchState {\r\n    isOpen: boolean;\r\n    query: string;\r\n    results: SearchResult[];\r\n    selectedIndex: number;\r\n}\r\n\r\n// ============================================================================\r\n// MODULE STATE\r\n// ============================================================================\r\n\r\nlet searchState: SearchState = {\r\n    isOpen: false,\r\n    query: '',\r\n    results: [],\r\n    selectedIndex: -1\r\n};\r\n\r\nlet searchDialog: HTMLDialogElement | null = null;\r\nlet searchInput: HTMLInputElement | null = null;\r\nlet resultsContainer: HTMLElement | null = null;\r\n\r\n// ============================================================================\r\n// SEARCH FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Searches all tabs for matching content\r\n */\r\nexport function searchAllTabs(query: string): SearchResult[] {\r\n    if (!query || query.length < 2) return [];\r\n\r\n    const results: SearchResult[] = [];\r\n    const headers = qsa<HTMLElement>('.tab-header');\r\n    const lowerQuery = query.toLowerCase();\r\n\r\n    for (const header of headers) {\r\n        const tabId = header.dataset.tabId;\r\n        if (!tabId) continue;\r\n\r\n        const tabTitle = header.querySelector('.tab-title')?.textContent || 'Untitled';\r\n        const textarea = qs<HTMLTextAreaElement>(`#${tabId} .textarea-contents`);\r\n        if (!textarea) continue;\r\n\r\n        const content = textarea.value;\r\n        const lines = content.split('\\n');\r\n\r\n        for (let lineNum = 0; lineNum < lines.length; lineNum++) {\r\n            const line = lines[lineNum];\r\n            if (!line) continue;\r\n            const lowerLine = line.toLowerCase();\r\n            let matchIndex = lowerLine.indexOf(lowerQuery);\r\n\r\n            while (matchIndex !== -1) {\r\n                results.push({\r\n                    tabId,\r\n                    tabTitle,\r\n                    lineNumber: lineNum + 1,\r\n                    lineContent: line,\r\n                    matchStart: matchIndex,\r\n                    matchEnd: matchIndex + query.length\r\n                });\r\n\r\n                // Find next match in same line\r\n                matchIndex = lowerLine.indexOf(lowerQuery, matchIndex + 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    return results;\r\n}\r\n\r\n/**\r\n * Highlights matched text in result\r\n */\r\nfunction highlightMatch(result: SearchResult): string {\r\n    const before = escapeHtml(result.lineContent.substring(0, result.matchStart));\r\n    const match = escapeHtml(result.lineContent.substring(result.matchStart, result.matchEnd));\r\n    const after = escapeHtml(result.lineContent.substring(result.matchEnd));\r\n\r\n    // Truncate long lines\r\n    const maxLen = 60;\r\n    let displayBefore = before;\r\n    let displayAfter = after;\r\n\r\n    if (before.length > maxLen / 2) {\r\n        displayBefore = '...' + before.substring(before.length - maxLen / 2);\r\n    }\r\n    if (after.length > maxLen / 2) {\r\n        displayAfter = after.substring(0, maxLen / 2) + '...';\r\n    }\r\n\r\n    return `${displayBefore}<mark>${match}</mark>${displayAfter}`;\r\n}\r\n\r\n/**\r\n * Escapes HTML special characters\r\n */\r\nfunction escapeHtml(text: string): string {\r\n    return text\r\n        .replace(/&/g, '&amp;')\r\n        .replace(/</g, '&lt;')\r\n        .replace(/>/g, '&gt;')\r\n        .replace(/\"/g, '&quot;');\r\n}\r\n\r\n/**\r\n * Renders search results\r\n */\r\nfunction renderResults(): void {\r\n    if (!resultsContainer) return;\r\n\r\n    if (searchState.results.length === 0) {\r\n        if (searchState.query.length >= 2) {\r\n            resultsContainer.innerHTML = `\r\n                <div class=\"search-no-results\">\r\n                    <span class=\"search-no-results-icon\">\uD83D\uDD0D</span>\r\n                    <span>No matches found for \"<strong>${escapeHtml(searchState.query)}</strong>\"</span>\r\n                </div>\r\n            `;\r\n        } else if (searchState.query.length > 0) {\r\n            resultsContainer.innerHTML = `\r\n                <div class=\"search-hint\">Type at least 2 characters to search</div>\r\n            `;\r\n        } else {\r\n            resultsContainer.innerHTML = `\r\n                <div class=\"search-hint\">Start typing to search across all tabs</div>\r\n            `;\r\n        }\r\n        return;\r\n    }\r\n\r\n    const html = searchState.results.map((result, index) => `\r\n        <div class=\"search-result${index === searchState.selectedIndex ? ' selected' : ''}\" \r\n             data-index=\"${index}\"\r\n             data-tab-id=\"${result.tabId}\"\r\n             data-line=\"${result.lineNumber}\">\r\n            <div class=\"search-result-header\">\r\n                <span class=\"search-result-tab\">\uD83D\uDCC4 ${escapeHtml(result.tabTitle)}</span>\r\n                <span class=\"search-result-line\">Line ${result.lineNumber}</span>\r\n            </div>\r\n            <div class=\"search-result-content\">${highlightMatch(result)}</div>\r\n        </div>\r\n    `).join('');\r\n\r\n    resultsContainer.innerHTML = `\r\n        <div class=\"search-results-header\">\r\n            Found ${searchState.results.length} match${searchState.results.length === 1 ? '' : 'es'}\r\n        </div>\r\n        ${html}\r\n    `;\r\n}\r\n\r\n/**\r\n * Navigates to a search result\r\n */\r\nexport function goToResult(result: SearchResult): void {\r\n    // Find and activate the tab\r\n    const tabHeader = qs<HTMLElement>(`.tab-header[data-tab-id=\"${result.tabId}\"]`);\r\n    if (tabHeader) {\r\n        activateTab(tabHeader);\r\n\r\n        // After tab activation, scroll to and select the line\r\n        setTimeout(() => {\r\n            const textarea = qs<HTMLTextAreaElement>(`#${result.tabId} .textarea-contents`);\r\n            if (!textarea) return;\r\n\r\n            const lines = textarea.value.split('\\n');\r\n            let charPosition = 0;\r\n\r\n            // Calculate character position of the line start\r\n            for (let i = 0; i < result.lineNumber - 1; i++) {\r\n                const lineLength = lines[i]?.length ?? 0;\r\n                charPosition += lineLength + 1; // +1 for newline\r\n            }\r\n\r\n            // Add match start offset\r\n            charPosition += result.matchStart;\r\n\r\n            // Select the matched text\r\n            textarea.focus();\r\n            textarea.setSelectionRange(charPosition, charPosition + (result.matchEnd - result.matchStart));\r\n\r\n            // Scroll the textarea to show the selection\r\n            const lineHeight = parseInt(getComputedStyle(textarea).lineHeight) || 24;\r\n            const scrollTop = (result.lineNumber - 5) * lineHeight; // Show some context\r\n            textarea.scrollTop = Math.max(0, scrollTop);\r\n        }, 100);\r\n    }\r\n\r\n    closeSearch();\r\n}\r\n\r\n/**\r\n * Handles keyboard navigation in search results\r\n */\r\nfunction handleSearchKeydown(e: KeyboardEvent): void {\r\n    if (e.key === 'ArrowDown') {\r\n        e.preventDefault();\r\n        if (searchState.results.length > 0) {\r\n            searchState.selectedIndex = Math.min(\r\n                searchState.selectedIndex + 1,\r\n                searchState.results.length - 1\r\n            );\r\n            renderResults();\r\n            scrollSelectedIntoView();\r\n        }\r\n    } else if (e.key === 'ArrowUp') {\r\n        e.preventDefault();\r\n        if (searchState.results.length > 0) {\r\n            searchState.selectedIndex = Math.max(searchState.selectedIndex - 1, 0);\r\n            renderResults();\r\n            scrollSelectedIntoView();\r\n        }\r\n    } else if (e.key === 'Enter') {\r\n        e.preventDefault();\r\n        const selectedResult = searchState.results[searchState.selectedIndex];\r\n        if (searchState.selectedIndex >= 0 && selectedResult) {\r\n            goToResult(selectedResult);\r\n        }\r\n    } else if (e.key === 'Escape') {\r\n        e.preventDefault();\r\n        closeSearch();\r\n    }\r\n}\r\n\r\n/**\r\n * Scrolls selected result into view\r\n */\r\nfunction scrollSelectedIntoView(): void {\r\n    const selected = resultsContainer?.querySelector('.search-result.selected');\r\n    if (selected) {\r\n        selected.scrollIntoView({ block: 'nearest', behavior: 'smooth' });\r\n    }\r\n}\r\n\r\n/**\r\n * Handles search input changes\r\n */\r\nfunction handleSearchInput(): void {\r\n    if (!searchInput) return;\r\n\r\n    searchState.query = searchInput.value;\r\n    searchState.results = searchAllTabs(searchState.query);\r\n    searchState.selectedIndex = searchState.results.length > 0 ? 0 : -1;\r\n    renderResults();\r\n}\r\n\r\n/**\r\n * Handles clicking on a search result\r\n */\r\nfunction handleResultClick(e: Event): void {\r\n    const resultEl = (e.target as HTMLElement).closest('.search-result');\r\n    if (!resultEl) return;\r\n\r\n    const index = parseInt(resultEl.getAttribute('data-index') || '-1', 10);\r\n    const result = searchState.results[index];\r\n    if (index >= 0 && result) {\r\n        goToResult(result);\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// PUBLIC API\r\n// ============================================================================\r\n\r\n/**\r\n * Opens the search dialog\r\n */\r\nexport function openSearch(): void {\r\n    if (!searchDialog) {\r\n        initSearchDialog();\r\n    }\r\n\r\n    searchState = {\r\n        isOpen: true,\r\n        query: '',\r\n        results: [],\r\n        selectedIndex: -1\r\n    };\r\n\r\n    if (searchInput) {\r\n        searchInput.value = '';\r\n    }\r\n\r\n    renderResults();\r\n    searchDialog?.showModal();\r\n\r\n    setTimeout(() => {\r\n        searchInput?.focus();\r\n    }, 50);\r\n}\r\n\r\n/**\r\n * Closes the search dialog\r\n */\r\nexport function closeSearch(): void {\r\n    searchState.isOpen = false;\r\n    searchDialog?.close();\r\n}\r\n\r\n/**\r\n * Toggles the search dialog\r\n */\r\nexport function toggleSearch(): void {\r\n    if (searchState.isOpen) {\r\n        closeSearch();\r\n    } else {\r\n        openSearch();\r\n    }\r\n}\r\n\r\n/**\r\n * Initializes the search dialog\r\n */\r\nexport function initSearchDialog(): void {\r\n    // Check if dialog already exists\r\n    searchDialog = qs<HTMLDialogElement>('#search-dialog');\r\n    if (searchDialog) {\r\n        searchInput = qs<HTMLInputElement>('#search-input');\r\n        resultsContainer = qs<HTMLElement>('#search-results');\r\n        return;\r\n    }\r\n\r\n    // Create the dialog\r\n    const dialog = document.createElement('dialog');\r\n    dialog.id = 'search-dialog';\r\n    dialog.className = 'app-dialog search-dialog';\r\n    dialog.innerHTML = `\r\n        <form method=\"dialog\">\r\n            <div class=\"search-header\">\r\n                <div class=\"search-input-wrapper\">\r\n                    <span class=\"search-icon\">\uD83D\uDD0D</span>\r\n                    <input type=\"text\" \r\n                           id=\"search-input\" \r\n                           class=\"search-input\" \r\n                           placeholder=\"Search across all tabs...\"\r\n                           autocomplete=\"off\"\r\n                           spellcheck=\"false\" />\r\n                    <kbd class=\"search-kbd\">Esc</kbd>\r\n                </div>\r\n            </div>\r\n            <div id=\"search-results\" class=\"search-results\"></div>\r\n            <div class=\"search-footer\">\r\n                <span>\u2191\u2193 Navigate</span>\r\n                <span>\u21B5 Go to</span>\r\n                <span>Esc Close</span>\r\n            </div>\r\n        </form>\r\n    `;\r\n\r\n    document.body.appendChild(dialog);\r\n\r\n    searchDialog = dialog;\r\n    searchInput = qs<HTMLInputElement>('#search-input');\r\n    resultsContainer = qs<HTMLElement>('#search-results');\r\n\r\n    // Wire up events\r\n    if (searchInput) {\r\n        on(searchInput as HTMLElement, 'input', handleSearchInput);\r\n        on(searchInput as HTMLElement, 'keydown', handleSearchKeydown as EventListener);\r\n    }\r\n\r\n    if (resultsContainer) {\r\n        on(resultsContainer, 'click', handleResultClick);\r\n    }\r\n\r\n    // Close on backdrop click\r\n    on(dialog, 'click', (e) => {\r\n        if (e.target === dialog) {\r\n            closeSearch();\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Initializes global search keyboard shortcut\r\n */\r\nexport function initGlobalSearch(): void {\r\n    initSearchDialog();\r\n\r\n    // Add keyboard shortcut Ctrl+F / Cmd+F\r\n    on(document, 'keydown', ((e: KeyboardEvent) => {\r\n        // Ctrl+Shift+F or Cmd+Shift+F for global search\r\n        if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key.toLowerCase() === 'f') {\r\n            e.preventDefault();\r\n            openSearch();\r\n        }\r\n    }) as EventListener);\r\n}\r\n", "/**\r\n * Password Strength Indicator Module\r\n * Provides visual feedback on password strength\r\n */\r\n\r\nimport { qs } from '../utils/dom.js';\r\n\r\n// ============================================================================\r\n// TYPES\r\n// ============================================================================\r\n\r\n/** Password strength level */\r\nexport type StrengthLevel = 'weak' | 'fair' | 'good' | 'strong' | 'very-strong';\r\n\r\n/** Password strength analysis result */\r\nexport interface PasswordStrength {\r\n    level: StrengthLevel;\r\n    score: number; // 0-100\r\n    label: string;\r\n    color: string;\r\n    feedback: string[];\r\n}\r\n\r\n// ============================================================================\r\n// STRENGTH ANALYSIS\r\n// ============================================================================\r\n\r\n/**\r\n * Analyzes password strength and returns detailed feedback\r\n */\r\nexport function analyzePasswordStrength(password: string): PasswordStrength {\r\n    if (!password || password.length === 0) {\r\n        return {\r\n            level: 'weak',\r\n            score: 0,\r\n            label: 'Enter password',\r\n            color: 'var(--muted)',\r\n            feedback: []\r\n        };\r\n    }\r\n\r\n    let score = 0;\r\n    const feedback: string[] = [];\r\n\r\n    // Length scoring (up to 30 points)\r\n    if (password.length >= 16) {\r\n        score += 30;\r\n    } else if (password.length >= 12) {\r\n        score += 25;\r\n    } else if (password.length >= 8) {\r\n        score += 15;\r\n    } else if (password.length >= 6) {\r\n        score += 10;\r\n    } else {\r\n        feedback.push('Use at least 8 characters');\r\n    }\r\n\r\n    // Character variety scoring\r\n    const hasLowercase = /[a-z]/.test(password);\r\n    const hasUppercase = /[A-Z]/.test(password);\r\n    const hasNumbers = /\\d/.test(password);\r\n    const hasSymbols = /[!@#$%^&*()_+\\-=[\\]{}|;':\",.<>?/`~\\\\]/.test(password);\r\n    const hasSpaces = /\\s/.test(password);\r\n\r\n    // Lowercase (10 points)\r\n    if (hasLowercase) {\r\n        score += 10;\r\n    } else {\r\n        feedback.push('Add lowercase letters');\r\n    }\r\n\r\n    // Uppercase (10 points)\r\n    if (hasUppercase) {\r\n        score += 10;\r\n    } else {\r\n        feedback.push('Add uppercase letters');\r\n    }\r\n\r\n    // Numbers (15 points)\r\n    if (hasNumbers) {\r\n        score += 15;\r\n    } else {\r\n        feedback.push('Add numbers');\r\n    }\r\n\r\n    // Symbols (20 points)\r\n    if (hasSymbols) {\r\n        score += 20;\r\n    } else {\r\n        feedback.push('Add special characters (!@#$%...)');\r\n    }\r\n\r\n    // Spaces (passphrase bonus - 5 points)\r\n    if (hasSpaces && password.split(' ').length >= 3) {\r\n        score += 5;\r\n    }\r\n\r\n    // Penalize common patterns\r\n    const commonPatterns = [\r\n        /^12345/,\r\n        /^password/i,\r\n        /^qwerty/i,\r\n        /^abc123/i,\r\n        /(.)\\1{3,}/, // Repeated characters (4+)\r\n        /^[a-z]+$/i, // All letters only\r\n        /^\\d+$/, // All numbers only\r\n    ];\r\n\r\n    for (const pattern of commonPatterns) {\r\n        if (pattern.test(password)) {\r\n            score = Math.max(0, score - 20);\r\n            if (!feedback.includes('Avoid common patterns')) {\r\n                feedback.push('Avoid common patterns');\r\n            }\r\n        }\r\n    }\r\n\r\n    // Bonus for long passphrases\r\n    if (password.length >= 20 && hasSpaces) {\r\n        score = Math.min(100, score + 10);\r\n    }\r\n\r\n    // Determine level\r\n    let level: StrengthLevel;\r\n    let label: string;\r\n    let color: string;\r\n\r\n    if (score >= 85) {\r\n        level = 'very-strong';\r\n        label = 'Very Strong';\r\n        color = 'var(--accent)';\r\n    } else if (score >= 70) {\r\n        level = 'strong';\r\n        label = 'Strong';\r\n        color = '#22c55e';\r\n    } else if (score >= 50) {\r\n        level = 'good';\r\n        label = 'Good';\r\n        color = '#eab308';\r\n    } else if (score >= 30) {\r\n        level = 'fair';\r\n        label = 'Fair';\r\n        color = 'var(--warning)';\r\n    } else {\r\n        level = 'weak';\r\n        label = 'Weak';\r\n        color = 'var(--danger)';\r\n    }\r\n\r\n    return {\r\n        level,\r\n        score: Math.min(100, Math.max(0, score)),\r\n        label,\r\n        color,\r\n        feedback: feedback.slice(0, 3) // Max 3 feedback items\r\n    };\r\n}\r\n\r\n// ============================================================================\r\n// UI COMPONENTS\r\n// ============================================================================\r\n\r\n/**\r\n * Creates a password strength indicator element\r\n */\r\nexport function createStrengthIndicator(): HTMLElement {\r\n    const container = document.createElement('div');\r\n    container.className = 'password-strength';\r\n    container.innerHTML = `\r\n        <div class=\"password-strength-bar\">\r\n            <div class=\"password-strength-fill\"></div>\r\n        </div>\r\n        <div class=\"password-strength-info\">\r\n            <span class=\"password-strength-label\"></span>\r\n            <span class=\"password-strength-feedback\"></span>\r\n        </div>\r\n    `;\r\n    return container;\r\n}\r\n\r\n/**\r\n * Updates the strength indicator with current password strength\r\n */\r\nexport function updateStrengthIndicator(container: HTMLElement, strength: PasswordStrength): void {\r\n    const fill = container.querySelector<HTMLElement>('.password-strength-fill');\r\n    const label = container.querySelector<HTMLElement>('.password-strength-label');\r\n    const feedback = container.querySelector<HTMLElement>('.password-strength-feedback');\r\n\r\n    if (fill) {\r\n        fill.style.width = `${strength.score}%`;\r\n        fill.style.backgroundColor = strength.color;\r\n        fill.setAttribute('data-level', strength.level);\r\n    }\r\n\r\n    if (label) {\r\n        label.textContent = strength.label;\r\n        label.style.color = strength.color;\r\n    }\r\n\r\n    if (feedback) {\r\n        feedback.textContent = strength.feedback.join(' \u2022 ');\r\n    }\r\n}\r\n\r\n/**\r\n * Attaches strength indicator to a password input\r\n */\r\nexport function attachStrengthIndicator(inputSelector: string): HTMLElement | null {\r\n    const input = qs<HTMLInputElement>(inputSelector);\r\n    if (!input) return null;\r\n\r\n    // Check if indicator already exists\r\n    const existingIndicator = input.parentElement?.querySelector('.password-strength');\r\n    if (existingIndicator) {\r\n        return existingIndicator as HTMLElement;\r\n    }\r\n\r\n    const indicator = createStrengthIndicator();\r\n\r\n    // Insert after the input\r\n    input.parentNode?.insertBefore(indicator, input.nextSibling);\r\n\r\n    // Wire up input event\r\n    input.addEventListener('input', () => {\r\n        const strength = analyzePasswordStrength(input.value);\r\n        updateStrengthIndicator(indicator, strength);\r\n    });\r\n\r\n    // Initial update\r\n    updateStrengthIndicator(indicator, analyzePasswordStrength(input.value));\r\n\r\n    return indicator;\r\n}\r\n\r\n/**\r\n * Initializes password strength indicators for new password dialogs\r\n */\r\nexport function initPasswordStrengthIndicators(): void {\r\n    // Attach to new password input in the new password dialog\r\n    const newPasswordInput = qs<HTMLInputElement>('#newpassword1');\r\n    if (newPasswordInput) {\r\n        attachStrengthIndicator('#newpassword1');\r\n    }\r\n\r\n    // Watch for dialog open to ensure indicator is attached\r\n    const observer = new MutationObserver((mutations) => {\r\n        for (const mutation of mutations) {\r\n            if (mutation.type === 'attributes' && mutation.attributeName === 'open') {\r\n                const dialog = mutation.target as HTMLDialogElement;\r\n                if (dialog.id === 'dialog-new-password' && dialog.open) {\r\n                    // Re-attach or reinitialize the indicator\r\n                    const input = qs<HTMLInputElement>('#newpassword1');\r\n                    if (input) {\r\n                        const existing = dialog.querySelector('.password-strength');\r\n                        if (!existing) {\r\n                            attachStrengthIndicator('#newpassword1');\r\n                        }\r\n                        // Reset the indicator\r\n                        const indicator = dialog.querySelector('.password-strength');\r\n                        if (indicator) {\r\n                            updateStrengthIndicator(\r\n                                indicator as HTMLElement,\r\n                                analyzePasswordStrength('')\r\n                            );\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    const newPasswordDialog = qs<HTMLDialogElement>('#dialog-new-password');\r\n    if (newPasswordDialog) {\r\n        observer.observe(newPasswordDialog, { attributes: true });\r\n    }\r\n}\r\n", "/**\r\n * Tab Switcher (Quick Tab Navigation)\r\n * Provides Ctrl+P style fuzzy search for tabs\r\n */\r\n\r\nimport { qs, qsa } from '../utils/dom.js';\r\nimport { activateTab } from './tabs.js';\r\n\r\n// ============================================================================\r\n// TYPES\r\n// ============================================================================\r\n\r\ninterface TabInfo {\r\n    header: HTMLElement;\r\n    id: string;\r\n    title: string;\r\n    content: string;\r\n    isPinned: boolean;\r\n    isModified: boolean;\r\n    index: number;\r\n}\r\n\r\n// ============================================================================\r\n// MODULE STATE\r\n// ============================================================================\r\n\r\nlet switcherDialog: HTMLDialogElement | null = null;\r\nlet isInitialized = false;\r\n\r\n// ============================================================================\r\n// FUZZY SEARCH\r\n// ============================================================================\r\n\r\n/**\r\n * Simple fuzzy match scoring\r\n * Returns score (higher is better), -1 if no match\r\n */\r\nfunction fuzzyMatch(query: string, text: string): number {\r\n    const queryLower = query.toLowerCase();\r\n    const textLower = text.toLowerCase();\r\n\r\n    // Exact match gets highest score\r\n    if (textLower === queryLower) return 1000;\r\n\r\n    // Starts with gets high score\r\n    if (textLower.startsWith(queryLower)) return 500 + (100 - text.length);\r\n\r\n    // Contains gets medium score\r\n    if (textLower.includes(queryLower)) return 200 + (100 - textLower.indexOf(queryLower));\r\n\r\n    // Fuzzy character matching\r\n    let queryIndex = 0;\r\n    let score = 0;\r\n    let lastMatchIndex = -1;\r\n\r\n    for (let i = 0; i < textLower.length && queryIndex < queryLower.length; i++) {\r\n        if (textLower[i] === queryLower[queryIndex]) {\r\n            // Consecutive matches get bonus\r\n            if (lastMatchIndex === i - 1) {\r\n                score += 5;\r\n            } else {\r\n                score += 1;\r\n            }\r\n            lastMatchIndex = i;\r\n            queryIndex++;\r\n        }\r\n    }\r\n\r\n    // All query characters must be found\r\n    if (queryIndex !== queryLower.length) return -1;\r\n\r\n    return score;\r\n}\r\n\r\n/**\r\n * Highlights matching characters in text\r\n */\r\nfunction highlightMatch(query: string, text: string): string {\r\n    if (!query) return escapeHtml(text);\r\n\r\n    const queryLower = query.toLowerCase();\r\n    const textLower = text.toLowerCase();\r\n    let result = '';\r\n    let queryIndex = 0;\r\n\r\n    for (let i = 0; i < text.length; i++) {\r\n        const char = text[i] || '';\r\n        const charLower = textLower[i] || '';\r\n        const queryChar = queryLower[queryIndex] || '';\r\n        if (queryIndex < queryLower.length && charLower === queryChar) {\r\n            result += `<mark>${escapeHtml(char)}</mark>`;\r\n            queryIndex++;\r\n        } else {\r\n            result += escapeHtml(char);\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n    return text\r\n        .replace(/&/g, '&amp;')\r\n        .replace(/</g, '&lt;')\r\n        .replace(/>/g, '&gt;')\r\n        .replace(/\"/g, '&quot;');\r\n}\r\n\r\n// ============================================================================\r\n// TAB INFO GATHERING\r\n// ============================================================================\r\n\r\n/**\r\n * Gets all tabs with their metadata\r\n */\r\nfunction getAllTabs(): TabInfo[] {\r\n    const headers = qsa<HTMLElement>('.tab-header');\r\n    const tabs: TabInfo[] = [];\r\n\r\n    headers.forEach((header, index) => {\r\n        const id = header.dataset.tabId || '';\r\n        const titleEl = header.querySelector('.tab-title');\r\n        const title = titleEl?.textContent || 'Empty Tab';\r\n        const isPinned = header.classList.contains('pinned');\r\n        const isModified = header.classList.contains('modified');\r\n\r\n        // Get content preview from the tab panel\r\n        const panel = id ? qs<HTMLElement>(`#${id}`) : null;\r\n        const textarea = panel?.querySelector<HTMLTextAreaElement>('.textarea-contents');\r\n        const content = textarea?.value?.substring(0, 200) || '';\r\n\r\n        tabs.push({\r\n            header,\r\n            id,\r\n            title,\r\n            content,\r\n            isPinned,\r\n            isModified,\r\n            index\r\n        });\r\n    });\r\n\r\n    return tabs;\r\n}\r\n\r\n// ============================================================================\r\n// SWITCHER UI\r\n// ============================================================================\r\n\r\n/**\r\n * Creates the switcher dialog if it doesn't exist\r\n */\r\nfunction ensureSwitcherDialog(): HTMLDialogElement {\r\n    if (switcherDialog) return switcherDialog;\r\n\r\n    const dialog = document.createElement('dialog');\r\n    dialog.id = 'tab-switcher-dialog';\r\n    dialog.className = 'tab-switcher-dialog';\r\n    dialog.innerHTML = `\r\n        <div class=\"tab-switcher-container\">\r\n            <div class=\"tab-switcher-header\">\r\n                <input type=\"text\" \r\n                       id=\"tab-switcher-input\" \r\n                       class=\"tab-switcher-input\" \r\n                       placeholder=\"Search tabs... (\u2191\u2193 to navigate, Enter to select)\"\r\n                       autocomplete=\"off\" />\r\n                <kbd class=\"tab-switcher-hint\">Esc to close</kbd>\r\n            </div>\r\n            <div class=\"tab-switcher-list\" id=\"tab-switcher-list\">\r\n                <!-- Tab items rendered here -->\r\n            </div>\r\n            <div class=\"tab-switcher-footer\">\r\n                <span class=\"tab-switcher-stat\" id=\"tab-switcher-stat\">0 tabs</span>\r\n                <div class=\"tab-switcher-shortcuts\">\r\n                    <span><kbd>\u2191</kbd><kbd>\u2193</kbd> Navigate</span>\r\n                    <span><kbd>Enter</kbd> Select</span>\r\n                    <span><kbd>Ctrl+P</kbd> Pin/Unpin</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n\r\n    document.body.appendChild(dialog);\r\n    switcherDialog = dialog;\r\n\r\n    // Wire up event handlers\r\n    const input = dialog.querySelector<HTMLInputElement>('#tab-switcher-input')!;\r\n    const list = dialog.querySelector<HTMLElement>('#tab-switcher-list')!;\r\n\r\n    // Search on input\r\n    input.addEventListener('input', () => {\r\n        renderTabList(input.value);\r\n    });\r\n\r\n    // Keyboard navigation\r\n    input.addEventListener('keydown', (e) => {\r\n        const items = list.querySelectorAll<HTMLElement>('.tab-switcher-item');\r\n        const activeItem = list.querySelector<HTMLElement>('.tab-switcher-item.active');\r\n        const activeIndex = activeItem ? Array.from(items).indexOf(activeItem) : -1;\r\n\r\n        switch (e.key) {\r\n            case 'ArrowDown':\r\n                e.preventDefault();\r\n                if (items.length > 0) {\r\n                    const nextIndex = (activeIndex + 1) % items.length;\r\n                    items.forEach((item, i) => item.classList.toggle('active', i === nextIndex));\r\n                    items[nextIndex]?.scrollIntoView({ block: 'nearest' });\r\n                }\r\n                break;\r\n\r\n            case 'ArrowUp':\r\n                e.preventDefault();\r\n                if (items.length > 0) {\r\n                    const prevIndex = activeIndex <= 0 ? items.length - 1 : activeIndex - 1;\r\n                    items.forEach((item, i) => item.classList.toggle('active', i === prevIndex));\r\n                    items[prevIndex]?.scrollIntoView({ block: 'nearest' });\r\n                }\r\n                break;\r\n\r\n            case 'Enter':\r\n                e.preventDefault();\r\n                if (activeItem) {\r\n                    const tabId = activeItem.dataset.tabId;\r\n                    const header = tabId ? qs<HTMLElement>(`.tab-header[data-tab-id=\"${tabId}\"]`) : null;\r\n                    if (header) {\r\n                        activateTab(header);\r\n                        closeSwitcher();\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case 'Escape':\r\n                e.preventDefault();\r\n                closeSwitcher();\r\n                break;\r\n\r\n            case 'p':\r\n            case 'P':\r\n                if (e.ctrlKey || e.metaKey) {\r\n                    e.preventDefault();\r\n                    if (activeItem) {\r\n                        const tabId = activeItem.dataset.tabId;\r\n                        const header = tabId ? qs<HTMLElement>(`.tab-header[data-tab-id=\"${tabId}\"]`) : null;\r\n                        if (header) {\r\n                            togglePinTab(header);\r\n                            renderTabList(input.value);\r\n                        }\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n    });\r\n\r\n    // Click to select\r\n    list.addEventListener('click', (e) => {\r\n        const item = (e.target as Element).closest<HTMLElement>('.tab-switcher-item');\r\n        if (item) {\r\n            const tabId = item.dataset.tabId;\r\n            const header = tabId ? qs<HTMLElement>(`.tab-header[data-tab-id=\"${tabId}\"]`) : null;\r\n            if (header) {\r\n                activateTab(header);\r\n                closeSwitcher();\r\n            }\r\n        }\r\n    });\r\n\r\n    // Close on backdrop click\r\n    dialog.addEventListener('click', (e) => {\r\n        if (e.target === dialog) {\r\n            closeSwitcher();\r\n        }\r\n    });\r\n\r\n    return dialog;\r\n}\r\n\r\n/**\r\n * Renders the filtered tab list\r\n */\r\nfunction renderTabList(query: string = ''): void {\r\n    const list = qs<HTMLElement>('#tab-switcher-list');\r\n    const stat = qs<HTMLElement>('#tab-switcher-stat');\r\n    if (!list) return;\r\n\r\n    let tabs = getAllTabs();\r\n\r\n    // Filter and score by query\r\n    if (query.trim()) {\r\n        tabs = tabs\r\n            .map(tab => ({\r\n                ...tab,\r\n                score: Math.max(\r\n                    fuzzyMatch(query, tab.title),\r\n                    fuzzyMatch(query, tab.content) * 0.5 // Content matches worth less\r\n                )\r\n            }))\r\n            .filter(tab => tab.score > 0)\r\n            .sort((a, b) => (b as any).score - (a as any).score);\r\n    }\r\n\r\n    // Sort: pinned first, then by index\r\n    tabs.sort((a, b) => {\r\n        if (a.isPinned !== b.isPinned) return a.isPinned ? -1 : 1;\r\n        return a.index - b.index;\r\n    });\r\n\r\n    // Render items\r\n    list.innerHTML = tabs.map((tab, i) => `\r\n        <div class=\"tab-switcher-item ${i === 0 ? 'active' : ''} ${tab.isPinned ? 'pinned' : ''} ${tab.isModified ? 'modified' : ''}\" \r\n             data-tab-id=\"${tab.id}\">\r\n            <div class=\"tab-switcher-item-icon\">\r\n                ${tab.isPinned ? '\uD83D\uDCCC' : '\uD83D\uDCC4'}\r\n            </div>\r\n            <div class=\"tab-switcher-item-content\">\r\n                <div class=\"tab-switcher-item-title\">\r\n                    ${highlightMatch(query, tab.title)}\r\n                    ${tab.isModified ? '<span class=\"modified-dot\">\u25CF</span>' : ''}\r\n                </div>\r\n                <div class=\"tab-switcher-item-preview\">\r\n                    ${tab.content ? escapeHtml(tab.content.substring(0, 80)) + (tab.content.length > 80 ? '...' : '') : '<em>Empty</em>'}\r\n                </div>\r\n            </div>\r\n            <div class=\"tab-switcher-item-index\">#${tab.index + 1}</div>\r\n        </div>\r\n    `).join('');\r\n\r\n    // Update stat\r\n    if (stat) {\r\n        const totalTabs = getAllTabs().length;\r\n        const pinnedCount = tabs.filter(t => t.isPinned).length;\r\n        stat.textContent = `${tabs.length}/${totalTabs} tabs${pinnedCount ? ` \u2022 ${pinnedCount} pinned` : ''}`;\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// PUBLIC API\r\n// ============================================================================\r\n\r\n/**\r\n * Opens the tab switcher dialog\r\n */\r\nexport function openTabSwitcher(): void {\r\n    const dialog = ensureSwitcherDialog();\r\n    const input = dialog.querySelector<HTMLInputElement>('#tab-switcher-input');\r\n\r\n    // Reset and show\r\n    if (input) {\r\n        input.value = '';\r\n    }\r\n    renderTabList();\r\n\r\n    dialog.showModal();\r\n    input?.focus();\r\n}\r\n\r\n/**\r\n * Closes the tab switcher dialog\r\n */\r\nexport function closeSwitcher(): void {\r\n    switcherDialog?.close();\r\n}\r\n\r\n/**\r\n * Toggles pin state on a tab\r\n */\r\nexport function togglePinTab(header: HTMLElement): void {\r\n    header.classList.toggle('pinned');\r\n\r\n    // Add pin indicator if not present\r\n    let pinIndicator = header.querySelector('.pin-indicator');\r\n    if (header.classList.contains('pinned')) {\r\n        if (!pinIndicator) {\r\n            const newIndicator = document.createElement('span');\r\n            newIndicator.className = 'pin-indicator';\r\n            newIndicator.textContent = '\uD83D\uDCCC';\r\n            newIndicator.title = 'Pinned - double-click to unpin';\r\n            header.insertBefore(newIndicator, header.firstChild);\r\n            pinIndicator = newIndicator;\r\n        }\r\n        // Move pinned tabs to the front\r\n        const container = qs('.tab-headers-container');\r\n        const firstUnpinned = container?.querySelector('.tab-header:not(.pinned)');\r\n        if (container && firstUnpinned && firstUnpinned !== header) {\r\n            container.insertBefore(header, firstUnpinned);\r\n        } else if (container) {\r\n            container.insertBefore(header, container.firstChild);\r\n        }\r\n    } else {\r\n        pinIndicator?.remove();\r\n    }\r\n\r\n    // Update close button visibility\r\n    const closeBtn = header.querySelector<HTMLElement>('.close');\r\n    if (closeBtn) {\r\n        closeBtn.style.display = header.classList.contains('pinned') ? 'none' : '';\r\n    }\r\n}\r\n\r\n/**\r\n * Marks a tab as modified (has unsaved changes)\r\n */\r\nexport function setTabModified(header: HTMLElement, modified: boolean): void {\r\n    header.classList.toggle('modified', modified);\r\n}\r\n\r\n/**\r\n * Marks all tabs as saved (removes modified indicator)\r\n */\r\nexport function clearAllModified(): void {\r\n    qsa('.tab-header.modified').forEach(header => {\r\n        header.classList.remove('modified');\r\n    });\r\n}\r\n\r\n/**\r\n * Gets list of pinned tab IDs\r\n */\r\nexport function getPinnedTabs(): string[] {\r\n    return qsa<HTMLElement>('.tab-header.pinned')\r\n        .map(h => h.dataset.tabId || '')\r\n        .filter(id => id);\r\n}\r\n\r\n/**\r\n * Restores pinned state from stored IDs\r\n */\r\nexport function restorePinnedTabs(pinnedIds: string[]): void {\r\n    pinnedIds.forEach(id => {\r\n        const header = qs<HTMLElement>(`.tab-header[data-tab-id=\"${id}\"]`);\r\n        if (header && !header.classList.contains('pinned')) {\r\n            togglePinTab(header);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Initializes the tab switcher keyboard shortcut\r\n */\r\nexport function initTabSwitcher(): void {\r\n    if (isInitialized) return;\r\n    isInitialized = true;\r\n\r\n    // Ctrl+P / Cmd+P to open switcher\r\n    document.addEventListener('keydown', (e) => {\r\n        if ((e.ctrlKey || e.metaKey) && e.key === 'p' && !e.shiftKey && !e.altKey) {\r\n            // Don't interfere if a dialog is open\r\n            const openDialogs = document.querySelectorAll<HTMLDialogElement>('dialog[open]');\r\n            const firstDialog = openDialogs[0];\r\n            if (openDialogs.length === 0 || (openDialogs.length === 1 && firstDialog?.id === 'tab-switcher-dialog')) {\r\n                e.preventDefault();\r\n                openTabSwitcher();\r\n            }\r\n        }\r\n    });\r\n\r\n    // Double-click on pin indicator to unpin\r\n    document.addEventListener('dblclick', (e) => {\r\n        const pinIndicator = (e.target as Element).closest('.pin-indicator');\r\n        if (pinIndicator) {\r\n            const header = pinIndicator.closest<HTMLElement>('.tab-header');\r\n            if (header) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                togglePinTab(header);\r\n            }\r\n        }\r\n    });\r\n}\r\n", "/**\r\n * PBKDF2 Key Derivation Module\r\n * Provides secure key derivation using Web Crypto API\r\n */\r\n\r\nimport { hexToBuf, textEncoder } from '../utils/crypto-helpers.js';\r\n\r\n/** Default PBKDF2 iterations for security */\r\nconst DEFAULT_ITERATIONS = 150000;\r\n\r\n/**\r\n * Derives an AES-GCM key from a password using PBKDF2\r\n * @param password - User password\r\n * @param saltHex - Salt in hex format\r\n * @param iterations - Number of iterations (default: 150000)\r\n * @returns CryptoKey for AES-GCM encryption/decryption\r\n */\r\nexport async function pbkdf2KeyFromPassword(\r\n    password: string,\r\n    saltHex: string,\r\n    iterations: number = DEFAULT_ITERATIONS\r\n): Promise<CryptoKey> {\r\n    const salt = hexToBuf(saltHex);\r\n\r\n    const baseKey = await crypto.subtle.importKey(\r\n        \"raw\",\r\n        textEncoder.encode(password),\r\n        { name: \"PBKDF2\" },\r\n        false,\r\n        [\"deriveKey\"]\r\n    );\r\n\r\n    return await crypto.subtle.deriveKey(\r\n        {\r\n            name: \"PBKDF2\",\r\n            salt,\r\n            iterations,\r\n            hash: \"SHA-256\"\r\n        },\r\n        baseKey,\r\n        { name: \"AES-GCM\", length: 256 },\r\n        false,\r\n        [\"encrypt\", \"decrypt\"]\r\n    );\r\n}\r\n", "/**\r\n * AES-GCM Encryption/Decryption Module\r\n * Provides secure encryption using Web Crypto API with AES-GCM 256-bit\r\n */\r\n\r\nimport { pbkdf2KeyFromPassword } from './pbkdf2.js';\r\nimport { hexToBuf, bufToHex, randomHex, textEncoder, textDecoder } from '../utils/crypto-helpers.js';\r\nimport type { EncryptionResult } from '../types/global.js';\r\n\r\n/**\r\n * Encrypts plaintext using AES-GCM\r\n * @param plainText - The text to encrypt\r\n * @param password - User password\r\n * @param saltHex - Salt in hex format\r\n * @returns Object containing IV and ciphertext in hex format\r\n */\r\nexport async function aesGcmEncryptHex(\r\n    plainText: string,\r\n    password: string,\r\n    saltHex: string\r\n): Promise<EncryptionResult> {\r\n    const ivHex = randomHex(12);\r\n    const key = await pbkdf2KeyFromPassword(password, saltHex);\r\n\r\n    const cipherBuf = await crypto.subtle.encrypt(\r\n        { name: \"AES-GCM\", iv: hexToBuf(ivHex) },\r\n        key,\r\n        textEncoder.encode(plainText)\r\n    );\r\n\r\n    return { ivHex, cipherHex: bufToHex(cipherBuf) };\r\n}\r\n\r\n/**\r\n * Decrypts ciphertext using AES-GCM\r\n * @param ivHex - Initialization vector in hex format\r\n * @param cipherHex - Ciphertext in hex format\r\n * @param password - User password\r\n * @param saltHex - Salt in hex format\r\n * @returns Decrypted plaintext or empty string on failure\r\n */\r\nexport async function aesGcmDecryptHex(\r\n    ivHex: string,\r\n    cipherHex: string,\r\n    password: string,\r\n    saltHex: string\r\n): Promise<string> {\r\n    const key = await pbkdf2KeyFromPassword(password, saltHex);\r\n\r\n    try {\r\n        const plainBuf = await crypto.subtle.decrypt(\r\n            { name: \"AES-GCM\", iv: hexToBuf(ivHex) },\r\n            key,\r\n            hexToBuf(cipherHex)\r\n        );\r\n        return textDecoder.decode(plainBuf);\r\n    } catch {\r\n        // Normalize occasional WebCrypto errors without throwing to callers\r\n        return \"\";\r\n    }\r\n}\r\n", "/**\r\n * Client State Management Module\r\n * Manages application state including authentication, content, and server communication\r\n * \r\n * Note: To avoid circular dependencies, UI functions like focusActiveTextarea,\r\n * getContentFromTabs, and setContentOfTabs should be injected via setTabFunctions().\r\n */\r\n\r\nimport { sha512Hex, simpleWeakHash, randomHex } from '../utils/crypto-helpers.js';\r\nimport { aesGcmEncryptHex, aesGcmDecryptHex } from '../crypto/aes-gcm.js';\r\nimport { fetchWithRetry } from '../utils/fetch.js';\r\nimport { showLoader, showHint, hideHint } from '../utils/dom.js';\r\nimport { toast } from '../ui/toast.js';\r\nimport { openNewPasswordDialog, openConfirmDialog, openDeletePasswordDialog } from '../ui/dialogs.js';\r\n\r\n// ============================================================================\r\n// TYPES\r\n// ============================================================================\r\n\r\n/** Remote state from server */\r\ninterface RemoteState {\r\n    isNew: boolean;\r\n    eContent: string | null;\r\n    currentHashContent: string | null;\r\n}\r\n\r\n/** Callbacks for UI updates */\r\nexport interface ClientStateCallbacks {\r\n    onButtonEnablementChange?: (isTextModified: boolean, isNew: boolean) => void;\r\n    onStatusChange?: (status: string, text: string) => void;\r\n    onLastSavedUpdate?: () => void;\r\n    onFinishInitialization?: (shouldSkipSettingContent?: boolean) => void;\r\n    onDecryptAndFinish?: (isOld: boolean) => void;\r\n}\r\n\r\n/** Tab functions interface for dependency injection */\r\nexport interface TabFunctions {\r\n    focusActiveTextarea?: () => void;\r\n    getContentFromTabs?: (state: ClientState) => Promise<string>;\r\n    setContentOfTabs?: (content: string, state: ClientState) => Promise<void>;\r\n}\r\n\r\n// Injected tab functions (set via setTabFunctions to avoid circular deps)\r\nlet _focusActiveTextarea: () => void = () => { };\r\nlet _getContentFromTabs: (state: ClientState) => Promise<string> = async () => \"\";\r\nlet _setContentOfTabs: (content: string, state: ClientState) => Promise<void> = async () => { };\r\n\r\n/**\r\n * Injects tab-related functions to avoid circular dependencies\r\n * @param funcs - Object containing focusActiveTextarea, getContentFromTabs, setContentOfTabs\r\n */\r\nexport function setTabFunctions(funcs: TabFunctions): void {\r\n    if (funcs.focusActiveTextarea) _focusActiveTextarea = funcs.focusActiveTextarea;\r\n    if (funcs.getContentFromTabs) _getContentFromTabs = funcs.getContentFromTabs;\r\n    if (funcs.setContentOfTabs) _setContentOfTabs = funcs.setContentOfTabs;\r\n}\r\n\r\n/**\r\n * Client State Class\r\n * Manages the entire application state\r\n */\r\nexport class ClientState {\r\n    readonly site: string;\r\n    readonly urlPassword: string | null;\r\n    currentDBVersion: number;\r\n    expectedDBVersion: number;\r\n\r\n    siteHash: string | null;\r\n    isTextModified: boolean;\r\n    initHashContent: string | null;\r\n    content: string;\r\n    password: string;\r\n    initialIsNew: boolean;\r\n    mobileAppMetadataTabContent: string;\r\n\r\n    remote: RemoteState;\r\n\r\n    // Callbacks for UI updates\r\n    onButtonEnablementChange: ClientStateCallbacks['onButtonEnablementChange'];\r\n    onStatusChange: ClientStateCallbacks['onStatusChange'];\r\n    onLastSavedUpdate: ClientStateCallbacks['onLastSavedUpdate'];\r\n    onFinishInitialization: ClientStateCallbacks['onFinishInitialization'];\r\n    onDecryptAndFinish: ClientStateCallbacks['onDecryptAndFinish'];\r\n\r\n    constructor(siteId: string, urlPassword: string | null = null) {\r\n        this.site = siteId;\r\n        this.urlPassword = urlPassword;\r\n        this.currentDBVersion = 2;\r\n        this.expectedDBVersion = 2;\r\n\r\n        this.siteHash = null;\r\n        this.isTextModified = false;\r\n        this.initHashContent = null;\r\n        this.content = \"\";\r\n        this.password = \"\";\r\n        this.initialIsNew = true;\r\n        this.mobileAppMetadataTabContent = \"\";\r\n\r\n        this.remote = {\r\n            isNew: true,\r\n            eContent: null,\r\n            currentHashContent: null\r\n        };\r\n\r\n        // Callbacks\r\n        this.onButtonEnablementChange = undefined;\r\n        this.onStatusChange = undefined;\r\n        this.onLastSavedUpdate = undefined;\r\n        this.onFinishInitialization = undefined;\r\n        this.onDecryptAndFinish = undefined;\r\n    }\r\n\r\n    getIsNew(): boolean {\r\n        return !!this.remote.isNew;\r\n    }\r\n\r\n    getInitialIsNew(): boolean {\r\n        return this.initialIsNew;\r\n    }\r\n\r\n    getIsTextModified(): boolean {\r\n        return this.isTextModified;\r\n    }\r\n\r\n    getContent(): string {\r\n        return this.content;\r\n    }\r\n\r\n    getPassword(): string {\r\n        return this.password;\r\n    }\r\n\r\n    getMobileAppMetadataTabContent(): string {\r\n        return this.mobileAppMetadataTabContent;\r\n    }\r\n\r\n    setMobileAppMetadataTabContent(m: string): void {\r\n        this.mobileAppMetadataTabContent = m || \"\";\r\n    }\r\n\r\n    updateIsTextModified(mod: boolean): void {\r\n        if (this.isTextModified === mod) return;\r\n        this.isTextModified = mod;\r\n        if (this.onButtonEnablementChange) {\r\n            this.onButtonEnablementChange(this.isTextModified, this.getIsNew());\r\n        }\r\n    }\r\n\r\n    async init(): Promise<void> {\r\n        this.siteHash = await sha512Hex(this.site);\r\n        await this.reloadFromServer();\r\n        this.initialIsNew = this.getIsNew();\r\n    }\r\n\r\n    /**\r\n     * Concurrency token (non-crypto) for overwrite detection. \r\n     * AES-GCM ensures confidentiality/integrity.\r\n     */\r\n    computeHashContentForDBVersion(\r\n        contentForHash: string,\r\n        passwordForHash: string,\r\n        dbVersion: number\r\n    ): string {\r\n        const weak = simpleWeakHash(`${contentForHash}::${passwordForHash}`);\r\n        return weak + String(dbVersion);\r\n    }\r\n\r\n    setInitHashContent(): void {\r\n        if (this.remote.currentHashContent) {\r\n            this.initHashContent = this.remote.currentHashContent;\r\n        } else {\r\n            this.initHashContent = this.computeHashContentForDBVersion(\r\n                this.content,\r\n                this.password || \"\",\r\n                this.currentDBVersion\r\n            );\r\n        }\r\n    }\r\n\r\n    private async _getDecryptedContent(pass: string): Promise<string | null> {\r\n        if (!this.remote.eContent) return null;\r\n        try {\r\n            const parts = this.remote.eContent.split(\":\");\r\n            if (parts.length !== 3) return null;\r\n            const saltHex = parts[0];\r\n            const ivHex = parts[1];\r\n            const cipherHex = parts[2];\r\n            if (!saltHex || !ivHex || !cipherHex) return null;\r\n            const plain = await aesGcmDecryptHex(ivHex, cipherHex, pass, saltHex);\r\n            if (plain && this.siteHash && plain.endsWith(this.siteHash)) {\r\n                return plain;\r\n            }\r\n            return null;\r\n        } catch {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Try to decrypt using provided pass; returns true/false\r\n     */\r\n    async setLoginPasswordAndContentIfCorrect(pass: string): Promise<boolean> {\r\n        const plain = await this._getDecryptedContent(pass);\r\n        if (plain !== null && this.siteHash) {\r\n            this.content = plain.slice(0, plain.length - this.siteHash.length);\r\n            this.password = pass;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    async saveSite(newPass: boolean | string): Promise<void> {\r\n        const executeSaveSite = async (passwordToUse: string): Promise<void> => {\r\n            this.content = await _getContentFromTabs(this);\r\n\r\n            const newHashContent = this.computeHashContentForDBVersion(\r\n                this.content,\r\n                passwordToUse,\r\n                this.expectedDBVersion\r\n            );\r\n\r\n            // Create new salt every save for portability; embed in ciphertext\r\n            const saltHex = randomHex(16);\r\n            const { ivHex, cipherHex } = await aesGcmEncryptHex(\r\n                String(this.content + this.siteHash),\r\n                passwordToUse,\r\n                saltHex\r\n            );\r\n            const eContentPayload = `${saltHex}:${ivHex}:${cipherHex}`;\r\n\r\n            showLoader(true);\r\n            try {\r\n                const res = await fetchWithRetry(\"/api/save\", {\r\n                    method: \"POST\",\r\n                    headers: { \"Content-Type\": \"application/json\" },\r\n                    body: JSON.stringify({\r\n                        site: this.site,\r\n                        initHashContent: this.initHashContent || \"\",\r\n                        currentHashContent: newHashContent,\r\n                        encryptedContent: eContentPayload\r\n                    })\r\n                });\r\n\r\n                if (!res.ok) {\r\n                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);\r\n                }\r\n\r\n                const data = await res.json() as {\r\n                    status: string;\r\n                    message?: string;\r\n                    currentHashContent?: string\r\n                };\r\n\r\n                if (data.status === \"success\") {\r\n                    toast(\"Saved!\", \"success\", 1500);\r\n                    this.remote.isNew = false;\r\n                    this.remote.eContent = eContentPayload;\r\n                    this.remote.currentHashContent = data.currentHashContent || newHashContent;\r\n                    this.initHashContent = this.remote.currentHashContent;\r\n                    this.password = passwordToUse;\r\n                    this.currentDBVersion = this.expectedDBVersion;\r\n                    this.isTextModified = false;\r\n                    if (this.onStatusChange) this.onStatusChange(\"ready\", \"Ready\");\r\n                    if (this.onLastSavedUpdate) this.onLastSavedUpdate();\r\n                    if (this.onFinishInitialization) this.onFinishInitialization(true);\r\n                } else if (data.message) {\r\n                    if (data.message.includes(\"modified in the meantime\")) {\r\n                        toast(\"Failed! Content was modified by another session. Use Ctrl+R to reload and see changes, then try saving again.\", \"error\", 5000);\r\n                    } else {\r\n                        toast(\"Failed! \" + data.message, \"error\", 2500);\r\n                    }\r\n                    _focusActiveTextarea();\r\n                } else {\r\n                    toast(\"Save failed!\", \"error\", 2500);\r\n                    _focusActiveTextarea();\r\n                }\r\n            } catch (error) {\r\n                console.error('Save operation failed:', error);\r\n                let errorMessage = \"Save failed!\";\r\n                const err = error as Error;\r\n\r\n                if (err.name === 'AbortError') {\r\n                    errorMessage += \" <br/> <span style='font-size: 0.9em; font-weight: normal'>(request timeout)</span>\";\r\n                } else if (err.message.includes('HTTP')) {\r\n                    errorMessage += ` <br/> <span style='font-size: 0.9em; font-weight: normal'>(${err.message})</span>`;\r\n                } else {\r\n                    errorMessage += \" <br/> <span style='font-size: 0.9em; font-weight: normal'>(connection issue)</span>\";\r\n                }\r\n\r\n                toast(errorMessage, \"error\", 2500);\r\n                _focusActiveTextarea();\r\n            } finally {\r\n                showLoader(false);\r\n            }\r\n        };\r\n\r\n        if (newPass === true) {\r\n            openNewPasswordDialog({\r\n                title: this.getIsNew() ? \"Create password\" : \"Change password\",\r\n                onSave: async (pass1: string, pass2: string): Promise<boolean> => {\r\n                    if (pass1.length === 0) {\r\n                        showHint(\"#passwords-empty\");\r\n                        hideHint(\"#passwords-dont-match\");\r\n                        return false;\r\n                    }\r\n                    if (pass1 !== pass2) {\r\n                        showHint(\"#passwords-dont-match\");\r\n                        hideHint(\"#passwords-empty\");\r\n                        return false;\r\n                    }\r\n                    await executeSaveSite(pass1);\r\n                    return true;\r\n                }\r\n            });\r\n        } else {\r\n            await executeSaveSite(this.password);\r\n        }\r\n    }\r\n\r\n    async deleteSite(): Promise<void> {\r\n        const runDelete = async (): Promise<void> => {\r\n            showLoader(true);\r\n            try {\r\n                const res = await fetchWithRetry(\"/api/delete\", {\r\n                    method: \"POST\",\r\n                    headers: { \"Content-Type\": \"application/json\" },\r\n                    body: JSON.stringify({\r\n                        site: this.site,\r\n                        initHashContent: this.initHashContent || \"\"\r\n                    })\r\n                });\r\n\r\n                if (!res.ok) {\r\n                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);\r\n                }\r\n\r\n                const data = await res.json() as { status: string };\r\n                if (data.status === \"success\") {\r\n                    toast(\"Site was deleted!\", \"success\", 2000);\r\n                    setTimeout(async () => {\r\n                        this.password = \"\";\r\n                        this.content = \"\";\r\n                        this.remote = { isNew: true, eContent: null, currentHashContent: null };\r\n                        await _setContentOfTabs(\"\", this);\r\n                        this.initialIsNew = true;\r\n                        if (this.onFinishInitialization) this.onFinishInitialization();\r\n                    }, 2200);\r\n                } else {\r\n                    toast(\"Failed! Site was modified in the meantime. Reload first.\", \"error\", 5000);\r\n                }\r\n            } catch (error) {\r\n                console.error('Delete operation failed:', error);\r\n                let errorMessage = \"Deleting failed!\";\r\n                const err = error as Error;\r\n\r\n                if (err.name === 'AbortError') {\r\n                    errorMessage += \" <br/> <span style='font-size: 0.9em; font-weight: normal'>(request timeout)</span>\";\r\n                } else if (err.message.includes('HTTP')) {\r\n                    errorMessage += ` <br/> <span style='font-size: 0.9em; font-weight: normal'>(${err.message})</span>`;\r\n                } else {\r\n                    errorMessage += \" <br/> <span style='font-size: 0.9em; font-weight: normal'>(connection issue)</span>\";\r\n                }\r\n\r\n                toast(errorMessage, \"error\", 2500);\r\n                _focusActiveTextarea();\r\n            } finally {\r\n                showLoader(false);\r\n            }\r\n        };\r\n\r\n        // First show confirmation dialog\r\n        openConfirmDialog(\"#dialog-confirm-delete-site\", async (ok: boolean) => {\r\n            if (ok) {\r\n                // Then require password confirmation\r\n                openDeletePasswordDialog({\r\n                    onOk: async (enteredPassword: string): Promise<boolean> => {\r\n                        // For a new, unsaved site, there's no remote content.\r\n                        if (!this.remote.eContent) {\r\n                            if (enteredPassword === this.password) {\r\n                                await runDelete();\r\n                                return true;\r\n                            }\r\n                            return false;\r\n                        }\r\n\r\n                        const isCorrect = (await this._getDecryptedContent(enteredPassword)) !== null;\r\n                        if (isCorrect) {\r\n                            await runDelete();\r\n                            return true;\r\n                        }\r\n                        return false;\r\n                    }\r\n                });\r\n            } else {\r\n                _focusActiveTextarea();\r\n            }\r\n        });\r\n    }\r\n\r\n    async reloadFromServer(): Promise<void> {\r\n        const url = `/api/json?site=${encodeURIComponent(this.site)}`;\r\n        const res = await fetch(url);\r\n        const data = await res.json() as {\r\n            status: string;\r\n            isNew?: boolean;\r\n            eContent?: string;\r\n            currentDBVersion?: number;\r\n            expectedDBVersion?: number;\r\n            currentHashContent?: string;\r\n        };\r\n\r\n        if (data.status !== \"success\") throw new Error(\"Server error\");\r\n\r\n        this.remote.isNew = !!data.isNew;\r\n        this.remote.eContent = data.isNew ? null : data.eContent || null;\r\n        this.currentDBVersion = data.currentDBVersion || 2;\r\n        this.expectedDBVersion = data.expectedDBVersion || 2;\r\n        this.remote.currentHashContent = data.currentHashContent || null;\r\n        this.initHashContent = this.remote.currentHashContent || null;\r\n    }\r\n\r\n    async reloadSite(): Promise<void> {\r\n        const executeReload = async (): Promise<void> => {\r\n            showLoader(true);\r\n            try {\r\n                await this.reloadFromServer();\r\n                toast(\"Reloaded!\", \"success\", 500);\r\n                this.isTextModified = false;\r\n                if (this.onStatusChange) this.onStatusChange(\"ready\", \"Ready\");\r\n\r\n                if (this.remote.isNew || !this.remote.eContent) {\r\n                    this.content = \"\";\r\n                    const pathSeg = (window.location.pathname || \"/\").replace(/^\\/+|\\/+$/g, \"\");\r\n                    const hasSiteFromPath = !!(pathSeg && pathSeg !== \"api\");\r\n                    const hasSiteFromQuery = !!(new URL(window.location.href).searchParams.get(\"site\"));\r\n\r\n                    if (!hasSiteFromPath && !hasSiteFromQuery) {\r\n                        await _setContentOfTabs(\"\", this);\r\n                        if (this.onFinishInitialization) this.onFinishInitialization();\r\n                        return;\r\n                    }\r\n                    if (this.onFinishInitialization) this.onFinishInitialization();\r\n                } else {\r\n                    // If URL contains password, try it first\r\n                    if (this.urlPassword) {\r\n                        const ok = await this.setLoginPasswordAndContentIfCorrect(this.urlPassword);\r\n                        if (ok) {\r\n                            if (this.onFinishInitialization) this.onFinishInitialization();\r\n                            return;\r\n                        }\r\n                    }\r\n                    const ok = await this.setLoginPasswordAndContentIfCorrect(this.password);\r\n                    if (!ok) {\r\n                        if (this.onDecryptAndFinish) this.onDecryptAndFinish(false);\r\n                        return;\r\n                    }\r\n                    if (this.onDecryptAndFinish) this.onDecryptAndFinish(true);\r\n                }\r\n            } catch {\r\n                toast(\"Reloading failed! <br/> <span style='font-size: 0.9em; font-weight: normal'>(connection issue)</span>\", \"error\", 2500);\r\n                _focusActiveTextarea();\r\n            } finally {\r\n                showLoader(false);\r\n            }\r\n        };\r\n\r\n        if (this.isTextModified) {\r\n            openConfirmDialog(\"#dialog-confirm-reload\", async (ok: boolean) => {\r\n                if (ok) await executeReload();\r\n                else _focusActiveTextarea();\r\n            });\r\n        } else {\r\n            await executeReload();\r\n        }\r\n    }\r\n}\r\n", "/*\r\n  Cryptexa - Client-side encrypted notes with server persistence\r\n  \r\n  Modular Architecture:\r\n    - crypto/       - Encryption/decryption (AES-GCM, PBKDF2)\r\n    - state/        - ClientState management\r\n    - ui/           - UI components (dialogs, tabs, toast, themes)\r\n    - utils/        - Utilities (fetch, dom, crypto-helpers)\r\n  \r\n  API:\r\n    GET  /api/json?site=SITE\r\n      -> { status:\"success\", isNew, eContent, currentDBVersion, expectedDBVersion, currentHashContent }\r\n    POST /api/save\r\n      body: { site, initHashContent, currentHashContent, encryptedContent }\r\n      -> { status:\"success\", currentHashContent } | { status:\"error\", message }\r\n    POST /api/delete\r\n      body: { site, initHashContent }\r\n      -> { status:\"success\" } | { status:\"error\", message }\r\n*/\r\n\r\n// ============================================================================\r\n// IMPORTS (ES Modules)\r\n// ============================================================================\r\n\r\nimport { debounce } from './utils/fetch.js';\r\nimport { qs, qsa, on, setPasswordMode } from './utils/dom.js';\r\nimport { toast, showNotification } from './ui/toast.js';\r\nimport { openPasswordDialog, openConfirmDialog } from './ui/dialogs.js';\r\nimport { initTheme, wireThemeToggle } from './ui/themes.js';\r\nimport { initKineticBackground, initKineticButtons, replaceLoaderWithKinetic } from './ui/kinetic.js';\r\nimport { initGlobalSearch, openSearch } from './ui/search.js';\r\nimport { initPasswordStrengthIndicators } from './ui/password-strength.js';\r\nimport { initTabSwitcher, setTabModified, clearAllModified } from './ui/tab-switcher.js';\r\nimport {\r\n    initTabsLayout,\r\n    activateTab,\r\n    addTab,\r\n    focusActiveTextarea,\r\n    getTitleFromContent,\r\n    updateGutterForTextarea,\r\n    updateActiveLineHighlight,\r\n    updateSelectedLinesHighlight,\r\n    setContentOfTabs,\r\n    getContentFromTabs,\r\n    onWindowResize,\r\n    getCurrentTabTitle\r\n} from './ui/tabs.js';\r\nimport { ClientState, setTabFunctions } from './state/ClientState.js';\r\n\r\n// Inject tab functions to avoid circular dependencies\r\nsetTabFunctions({\r\n    focusActiveTextarea,\r\n    getContentFromTabs,\r\n    setContentOfTabs\r\n});\r\n\r\n// ============================================================================\r\n// TYPE AUGMENTATION\r\n// ============================================================================\r\n\r\ndeclare global {\r\n    interface Window {\r\n        state: ClientState;\r\n    }\r\n\r\n    interface HTMLElement {\r\n        _lnDebounce?: () => void;\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// CONFIG\r\n// ============================================================================\r\n\r\nfunction getQueryParam(name: string): string | null {\r\n    const url = new URL(window.location.href);\r\n    const v = url.searchParams.get(name);\r\n    return v && v.trim().length ? v.trim() : null;\r\n}\r\n\r\n// Prefer path segment /:site; fallback to ?site=; else default\r\nfunction getSiteFromURL(): string {\r\n    const path = window.location.pathname || \"/\";\r\n    // Normalize: remove leading/trailing slashes\r\n    const seg = path.replace(new RegExp(\"^/+|/+$\", \"g\"), \"\");\r\n    if (seg && seg !== \"api\") return seg;\r\n    const qp = getQueryParam(\"site\");\r\n    return qp || \"local-notes\";\r\n}\r\n\r\nconst SITE_ID = getSiteFromURL();\r\n\r\n// Accept either ?password=... or raw ?YourPass (whole querystring as password)\r\nconst URL_PASSWORD = (function (): string | null {\r\n    const named = getQueryParam(\"password\");\r\n    if (named) return named;\r\n    const qs = window.location.search || \"\";\r\n    if (qs.startsWith(\"?\") && qs.length > 1 && !qs.includes(\"=\")) {\r\n        return decodeURIComponent(qs.substring(1));\r\n    }\r\n    return null;\r\n})();\r\n\r\n// ============================================================================\r\n// GLOBAL STATE\r\n// ============================================================================\r\n\r\nlet state = new ClientState(SITE_ID, URL_PASSWORD);\r\nwindow.state = state; // valid for debugging\r\nlet ignoreInputEvent = true;\r\nlet healthCheckInterval: ReturnType<typeof setInterval> | null = null;\r\n\r\n// ============================================================================\r\n// KEYBOARD SHORTCUTS\r\n// ============================================================================\r\n\r\nfunction initKeyboardShortcuts(): void {\r\n    document.addEventListener('keydown', (e) => {\r\n        // Skip if user is typing in input fields\r\n        const target = e.target as HTMLElement;\r\n        if (target.tagName === 'INPUT' && (target as HTMLInputElement).type !== 'color') return;\r\n\r\n        const isCtrl = e.ctrlKey || e.metaKey;\r\n        const isShift = e.shiftKey;\r\n        const isAlt = e.altKey;\r\n\r\n        // Ctrl+S: Save\r\n        if (isCtrl && e.key === 's') {\r\n            e.preventDefault();\r\n            document.getElementById('button-save')?.click();\r\n            return;\r\n        }\r\n\r\n        // Ctrl+Alt+T: New Tab\r\n        if (isCtrl && isAlt && (e.key === 't' || e.key === 'T')) {\r\n            e.preventDefault();\r\n            document.getElementById('add_tab')?.click();\r\n            return;\r\n        }\r\n\r\n        // Ctrl+R: Reload\r\n        if (isCtrl && e.key === 'r') {\r\n            e.preventDefault();\r\n            document.getElementById('button-reload')?.click();\r\n            return;\r\n        }\r\n\r\n        // Ctrl+Shift+P: Change Password\r\n        if (isCtrl && isShift && e.key === 'P') {\r\n            e.preventDefault();\r\n            document.getElementById('button-savenew')?.click();\r\n            return;\r\n        }\r\n\r\n        // Ctrl+Shift+G: Toggle Theme\r\n        if (isCtrl && isShift && (e.key === 'g' || e.key === 'G')) {\r\n            e.preventDefault();\r\n            document.getElementById('theme-toggle')?.click();\r\n            return;\r\n        }\r\n\r\n        // Ctrl+1-9: Switch to tab by number\r\n        if (isCtrl && e.key >= '1' && e.key <= '9') {\r\n            e.preventDefault();\r\n            const tabIndex = parseInt(e.key) - 1;\r\n            const tabs = document.querySelectorAll('.tab-header');\r\n            if (tabs[tabIndex]) {\r\n                (tabs[tabIndex].querySelector('.tab-title') as HTMLElement)?.click();\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Ctrl+Tab: Next tab\r\n        if (isCtrl && e.key === 'Tab' && !isShift) {\r\n            e.preventDefault();\r\n            const tabs = document.querySelectorAll('.tab-header');\r\n            const activeIndex = Array.from(tabs).findIndex(tab => tab.classList.contains('active'));\r\n            const nextIndex = (activeIndex + 1) % tabs.length;\r\n            (tabs[nextIndex]?.querySelector('.tab-title') as HTMLElement)?.click();\r\n            return;\r\n        }\r\n\r\n        // Ctrl+Shift+Tab: Previous tab\r\n        if (isCtrl && e.key === 'Tab' && isShift) {\r\n            e.preventDefault();\r\n            const tabs = document.querySelectorAll('.tab-header');\r\n            const activeIndex = Array.from(tabs).findIndex(tab => tab.classList.contains('active'));\r\n            const prevIndex = activeIndex === 0 ? tabs.length - 1 : activeIndex - 1;\r\n            (tabs[prevIndex]?.querySelector('.tab-title') as HTMLElement)?.click();\r\n            return;\r\n        }\r\n\r\n        // F1: Show keyboard shortcuts help\r\n        if (e.key === 'F1') {\r\n            e.preventDefault();\r\n            showKeyboardShortcutsHelp();\r\n            return;\r\n        }\r\n\r\n        // Escape: Close dialogs or focus textarea\r\n        if (e.key === 'Escape') {\r\n            const openDialog = document.querySelector('dialog[open]') as HTMLDialogElement;\r\n            if (openDialog) {\r\n                openDialog.close();\r\n            } else {\r\n                focusActiveTextarea();\r\n            }\r\n            return;\r\n        }\r\n    });\r\n}\r\n\r\nfunction showKeyboardShortcutsHelp(): void {\r\n    const shortcuts = [\r\n        { keys: 'Ctrl+S', desc: 'Save notes' },\r\n        { keys: 'Ctrl+Alt+T', desc: 'New tab' },\r\n        { keys: 'Ctrl+P', desc: 'Quick tab switcher' },\r\n        { keys: 'Ctrl+R', desc: 'Reload from server' },\r\n        { keys: 'Ctrl+Shift+F', desc: 'Global search' },\r\n        { keys: 'Ctrl+1-9', desc: 'Switch to tab by number' },\r\n        { keys: 'Ctrl+Tab', desc: 'Next tab' },\r\n        { keys: 'Ctrl+Shift+Tab', desc: 'Previous tab' },\r\n        { keys: 'Ctrl+Shift+P', desc: 'Change password' },\r\n        { keys: 'Ctrl+Shift+G', desc: 'Toggle theme' },\r\n        { keys: 'F1', desc: 'Show this help' },\r\n        { keys: 'Escape', desc: 'Close dialogs or focus editor' }\r\n    ];\r\n\r\n    const helpText = shortcuts.map(s => `<strong>${s.keys}</strong>: ${s.desc}`).join('<br>');\r\n    showNotification(`<div style=\"text-align: left; line-height: 1.6;\"><strong>\uD83D\uDE80 Keyboard Shortcuts</strong><br><br>${helpText}</div>`, 'info', 8000);\r\n}\r\n\r\n// ============================================================================\r\n// ERROR HANDLING & HEALTH MONITORING\r\n// ============================================================================\r\n\r\nwindow.addEventListener('error', (event) => {\r\n    console.error('Global error:', event.error);\r\n    showNotification('An unexpected error occurred. Please refresh the page.', 'error');\r\n});\r\n\r\nwindow.addEventListener('unhandledrejection', (event) => {\r\n    console.error('Unhandled promise rejection:', event.reason);\r\n    showNotification('A network or processing error occurred. Please try again.', 'error');\r\n    event.preventDefault();\r\n});\r\n\r\n// Performance monitoring\r\nif ('performance' in window) {\r\n    window.addEventListener('load', () => {\r\n        setTimeout(() => {\r\n            const perfData = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming;\r\n            if (perfData) {\r\n                console.log('Page load time:', Math.round(perfData.loadEventEnd - perfData.fetchStart), 'ms');\r\n            }\r\n        }, 0);\r\n    });\r\n}\r\n\r\n// Health check function\r\nasync function checkServerHealth(): Promise<boolean> {\r\n    try {\r\n        const response = await fetch('/health', { method: 'GET' });\r\n        return response.ok;\r\n    } catch {\r\n        return false;\r\n    }\r\n}\r\n\r\n// Periodic health check (every 5 minutes)\r\nfunction startHealthMonitoring(): void {\r\n    healthCheckInterval = setInterval(async () => {\r\n        const isHealthy = await checkServerHealth();\r\n        if (!isHealthy) {\r\n            showNotification('Connection to server lost. Please check your internet connection.', 'warning');\r\n        }\r\n    }, 5 * 60 * 1000); // 5 minutes\r\n}\r\n\r\n// Stop health monitoring\r\n// eslint-disable-next-line no-unused-vars\r\nexport function stopHealthMonitoring(): void {\r\n    if (healthCheckInterval) {\r\n        clearInterval(healthCheckInterval);\r\n        healthCheckInterval = null;\r\n    }\r\n}\r\n// Expose for manual debugging\r\n(window as any).stopHealthMonitoring = stopHealthMonitoring;\r\n\r\n// ============================================================================\r\n// BUTTON ENABLEMENT\r\n// ============================================================================\r\n\r\nfunction updateButtonEnablement(isTextModified: boolean, isSiteNew: boolean): void {\r\n    const bSave = qs<HTMLButtonElement>(\"#button-save\");\r\n    const bSaveNew = qs<HTMLButtonElement>(\"#button-savenew\");\r\n    const bReload = qs<HTMLButtonElement>(\"#button-reload\");\r\n    const bDelete = qs<HTMLButtonElement>(\"#button-delete\");\r\n\r\n    if (!bSave || !bSaveNew || !bReload || !bDelete) return;\r\n\r\n    bSave.disabled = !isTextModified;\r\n    if (state.getInitialIsNew() === false && isTextModified) {\r\n        window.onbeforeunload = () => \"If you don't 'Save', you'll lose your changes.\";\r\n    } else {\r\n        window.onbeforeunload = null;\r\n    }\r\n\r\n    bSaveNew.disabled = !!isSiteNew === true;\r\n    bReload.disabled = false;\r\n    bDelete.disabled = !!isSiteNew === true;\r\n}\r\n\r\n// ============================================================================\r\n// STATUS INDICATOR\r\n// ============================================================================\r\n\r\nconst updateStatusIndicator = (status: string, text: string): void => {\r\n    const indicator = qs(\"#status-indicator\");\r\n    const statusText = qs(\".status-text\");\r\n    if (!indicator || !statusText) return;\r\n    indicator.classList.remove(\"saving\", \"error\", \"modified\");\r\n    if (status && status !== \"ready\") indicator.classList.add(status);\r\n    statusText.textContent = text || \"Ready\";\r\n};\r\n\r\nconst updateLastSaved = (): void => {\r\n    const lastSavedElement = qs<HTMLElement>(\"#last-saved\");\r\n    if (!lastSavedElement) return;\r\n\r\n    const now = new Date();\r\n    const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n    lastSavedElement.textContent = `Last saved: ${timeString}`;\r\n    lastSavedElement.style.display = 'inline';\r\n};\r\n\r\nconst hideLastSaved = (): void => {\r\n    const lastSavedElement = qs<HTMLElement>(\"#last-saved\");\r\n    if (lastSavedElement) {\r\n        lastSavedElement.style.display = 'none';\r\n    }\r\n};\r\n\r\n// Listen for text changes to update status and per-tab modification\r\ndocument.addEventListener(\"input\", e => {\r\n    if (e.target instanceof HTMLTextAreaElement && e.target.classList.contains(\"textarea-contents\")) {\r\n        updateStatusIndicator(\"modified\", \"Modified\");\r\n        hideLastSaved();\r\n\r\n        // Mark the current tab as modified\r\n        const panel = e.target.closest('.tab-panel');\r\n        if (panel) {\r\n            const tabId = panel.id;\r\n            const header = document.querySelector<HTMLElement>(`.tab-header[data-tab-id=\"${tabId}\"]`);\r\n            if (header) {\r\n                setTabModified(header, true);\r\n            }\r\n        }\r\n    }\r\n});\r\n\r\n// ============================================================================\r\n// INITIALIZATION\r\n// ============================================================================\r\n\r\nasync function initSite(): Promise<void> {\r\n    // Optional auto-decrypt via ?password=...\r\n    if (!state.getIsNew() && URL_PASSWORD) {\r\n        const ok = await state.setLoginPasswordAndContentIfCorrect(URL_PASSWORD);\r\n        if (ok) {\r\n            finishInitialization();\r\n            return;\r\n        }\r\n    }\r\n\r\n    if (state.getIsNew()) {\r\n        await setContentOfTabs(\"\", state);\r\n        finishInitialization();\r\n    } else {\r\n        decryptContentAndFinishInitialization(false);\r\n    }\r\n}\r\n\r\nasync function finishInitialization(shouldSkipSettingContent?: boolean): Promise<void> {\r\n    state.setInitHashContent();\r\n    updateButtonEnablement(state.getIsTextModified(), state.getIsNew());\r\n    focusActiveTextarea();\r\n    ignoreInputEvent = true;\r\n    if (shouldSkipSettingContent !== true) {\r\n        setContentOfTabs(state.getContent(), state);\r\n    } else {\r\n        // This is called after a successful save - clear per-tab modification indicators\r\n        clearAllModified();\r\n    }\r\n    setTimeout(() => { ignoreInputEvent = false; }, 50);\r\n\r\n    // Hint: mark huge tabs to avoid costly styles or scripts if needed\r\n    try {\r\n        const panel = qs<HTMLElement>(\".tab-panel.active\");\r\n        const ta = panel && panel.querySelector<HTMLTextAreaElement>(\"textarea.textarea-contents\");\r\n        if (ta) {\r\n            const isHuge = (ta.value && ta.value.length > 50000);\r\n            if (panel) panel.dataset.huge = isHuge ? \"1\" : \"\";\r\n        }\r\n    } catch {\r\n        void 0;\r\n    }\r\n}\r\n\r\nfunction decryptContentAndFinishInitialization(isOld: boolean): void {\r\n    const openPrompt = () => {\r\n        // Hide UI until authenticated to avoid exposing content\r\n        openPasswordDialog({\r\n            obscure: true,\r\n            hideUI: true,\r\n            onOk: async (pass: string): Promise<boolean> => {\r\n                if (pass == null) { focusActiveTextarea(); return false; }\r\n                const ok = await state.setLoginPasswordAndContentIfCorrect(pass);\r\n                if (ok) {\r\n                    finishInitialization();\r\n                    return true; // close dialog (setPasswordMode(false) handled in openPasswordDialog)\r\n                }\r\n                // wrong password: keep dialog open\r\n                return false;\r\n            }\r\n        });\r\n    };\r\n\r\n    if (isOld === true) {\r\n        state.setLoginPasswordAndContentIfCorrect(state.getPassword()).then(ok => {\r\n            if (!ok) openPrompt();\r\n            else finishInitialization();\r\n        });\r\n    } else {\r\n        openPrompt();\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// EXPORT ENCRYPTED BACKUP\r\n// ============================================================================\r\n\r\nfunction exportEncryptedBackup(eContent: string): void {\r\n    // Produce a minimal HTML that only contains a small decryptor for saltHex:ivHex:cipherHex\r\n    const title = `Cryptexa Encrypted Backup (${SITE_ID})`;\r\n    const html = `<!DOCTYPE html><html><head><meta charset=\"utf-8\"><title>${title}</title></head>\r\n<body>\r\n<h3>${title}</h3>\r\n<p>Enter password to decrypt this backup locally (no network):</p>\r\n<input type=\"password\" id=\"pw\" placeholder=\"Password\"/>\r\n<button id=\"dec\">Decrypt</button>\r\n<pre id=\"out\" style=\"white-space:pre-wrap;margin-top:12px;\"></pre>\r\n<script>\r\nconst textEncoder = new TextEncoder(); const textDecoder = new TextDecoder();\r\nfunction hexToBuf(hex){const len=hex.length/2;const out=new Uint8Array(len);for(let i=0;i<len;i++)out[i]=parseInt(hex.substr(i*2,2),16);return out.buffer;}\r\nfunction bufToHex(buf){const arr=new Uint8Array(buf);let s=\"\";for(let i=0;i<arr.length;i++)s+=arr[i].toString(16).padStart(2,\"0\");return s;}\r\nasync function pbkdf2KeyFromPassword(password, saltHex, iterations=150000){\r\n  const salt=hexToBuf(saltHex);\r\n  const baseKey=await crypto.subtle.importKey(\"raw\", textEncoder.encode(password), {name:\"PBKDF2\"}, false, [\"deriveKey\"]);\r\n  return await crypto.subtle.deriveKey({name:\"PBKDF2\",salt,iterations,hash:\"SHA-256\"}, baseKey, {name:\"AES-GCM\",length:256}, false, [\"decrypt\"]);\r\n}\r\nasync function aesGcmDecryptHex(ivHex, cipherHex, password, saltHex){\r\n  const key=await pbkdf2KeyFromPassword(password, saltHex);\r\n  const plainBuf=await crypto.subtle.decrypt({name:\"AES-GCM\", iv:hexToBuf(ivHex)}, key, hexToBuf(cipherHex));\r\n  return textDecoder.decode(plainBuf);\r\n}\r\ndocument.getElementById(\"dec\").onclick=async()=>{\r\n  const pw=document.getElementById(\"pw\").value||\"\";\r\n  const payload=${JSON.stringify(eContent)};\r\n  const parts=payload.split(\":\");\r\n  if(parts.length!==3){document.getElementById(\"out\").textContent=\"Invalid payload\";return;}\r\n  const [saltHex,ivHex,cipherHex]=parts;\r\n  try{\r\n    const plain=await aesGcmDecryptHex(ivHex,cipherHex,pw,saltHex);\r\n    document.getElementById(\"out\").textContent=plain;\r\n  }catch(e){\r\n    document.getElementById(\"out\").textContent=\"Decryption failed (wrong password?)\";\r\n  }\r\n};\r\n<${'/'}script>\r\n</body></html>`;\r\n    const blob = new Blob([html], { type: \"text/html\" });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = `cryptexa-backup-${SITE_ID}.html`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n    a.remove();\r\n}\r\n\r\n// ============================================================================\r\n// EVENT WIRING\r\n// ============================================================================\r\n\r\nfunction wireEvents(): void {\r\n    // Coalesce textarea input updates with rAF to reduce layout thrash\r\n    let pendingRaf = 0;\r\n    document.addEventListener(\"input\", (e) => {\r\n        if (!(e.target instanceof HTMLTextAreaElement)) return;\r\n        if (!e.target.classList.contains(\"textarea-contents\")) return;\r\n        if (ignoreInputEvent) { e.preventDefault(); return; }\r\n        state.updateIsTextModified(true);\r\n\r\n        const ta = e.target;\r\n        const currentTabTitle = getCurrentTabTitle();\r\n\r\n        if (pendingRaf) cancelAnimationFrame(pendingRaf);\r\n        pendingRaf = requestAnimationFrame(() => {\r\n            pendingRaf = 0;\r\n\r\n            // Title update guard: only compute when caret near start and content not too large\r\n            try {\r\n                const start = ta.selectionStart;\r\n                const isHuge = (ta.value && ta.value.length > 50000);\r\n                if (!isHuge && start <= 201 && currentTabTitle) {\r\n                    currentTabTitle.textContent = getTitleFromContent(ta.value.substring(0, 200));\r\n                }\r\n            } catch {\r\n                void 0;\r\n            }\r\n\r\n            // Gutter update throttling for large notes: avoid per-keystroke full regen\r\n            const panel = ta.closest(\".tab-panel\") as HTMLElement;\r\n            const gutter = panel && panel.querySelector<HTMLElement>(\".line-gutter\");\r\n            const editorWrap = panel && panel.querySelector(\".editor-wrap\");\r\n            if (gutter) {\r\n                const isHuge = (ta.value && ta.value.length > 50000);\r\n                if (isHuge) {\r\n                    // Only adjust scroll transform now; regenerate line numbers debounced\r\n                    const y = Math.round(ta.scrollTop || 0);\r\n                    gutter.style.setProperty(\"--gutter-scroll-y\", String(-y));\r\n                    gutter.style.setProperty(\"--gutter-before-transform\", `translateY(${-y}px)`);\r\n                    gutter.style.removeProperty(\"top\");\r\n                    gutter.style.transform = \"translateZ(0)\";\r\n\r\n                    if (!gutter._lnDebounce) {\r\n                        gutter._lnDebounce = debounce(() => updateGutterForTextarea(ta, gutter), 120);\r\n                    }\r\n                    gutter._lnDebounce();\r\n                } else {\r\n                    updateGutterForTextarea(ta, gutter);\r\n                }\r\n            }\r\n\r\n            // Update line highlights\r\n            if (editorWrap) {\r\n                updateActiveLineHighlight(ta, editorWrap);\r\n                updateSelectedLinesHighlight(ta, editorWrap);\r\n            }\r\n        });\r\n    });\r\n\r\n    // Handle cursor movement and selection changes\r\n    document.addEventListener(\"selectionchange\", () => {\r\n        const ta = document.activeElement;\r\n        if (!(ta instanceof HTMLTextAreaElement)) return;\r\n        if (!ta.classList.contains(\"textarea-contents\")) return;\r\n\r\n        const panel = ta.closest(\".tab-panel\");\r\n        const editorWrap = panel && panel.querySelector(\".editor-wrap\");\r\n        if (editorWrap) {\r\n            updateActiveLineHighlight(ta, editorWrap);\r\n            updateSelectedLinesHighlight(ta, editorWrap);\r\n        }\r\n    });\r\n\r\n    // Handle mouseup events (for when user selects text with mouse)\r\n    document.addEventListener(\"mouseup\", (e) => {\r\n        if (!(e.target instanceof HTMLTextAreaElement)) return;\r\n        if (!e.target.classList.contains(\"textarea-contents\")) return;\r\n\r\n        const ta = e.target;\r\n        const panel = ta.closest(\".tab-panel\");\r\n        const editorWrap = panel && panel.querySelector(\".editor-wrap\");\r\n        if (editorWrap) {\r\n            // Small delay to ensure selection is updated\r\n            setTimeout(() => {\r\n                updateActiveLineHighlight(ta, editorWrap);\r\n                updateSelectedLinesHighlight(ta, editorWrap);\r\n            }, 0);\r\n        }\r\n    });\r\n\r\n    document.addEventListener(\"paste\", (e) => {\r\n        if (!(e.target instanceof HTMLTextAreaElement)) return;\r\n        if (!e.target.classList.contains(\"textarea-contents\")) return;\r\n        const currentTabTitle = getCurrentTabTitle();\r\n        setTimeout(() => {\r\n            const ta = e.target as HTMLTextAreaElement;\r\n            const isHuge = (ta.value && ta.value.length > 50000);\r\n            if (!isHuge && currentTabTitle) {\r\n                currentTabTitle.textContent = getTitleFromContent();\r\n            }\r\n            // Deferred gutter update after paste\r\n            const panel = ta.closest(\".tab-panel\");\r\n            const gutter = panel && panel.querySelector<HTMLElement>(\".line-gutter\");\r\n            if (gutter) {\r\n                if (isHuge) {\r\n                    if (!gutter._lnDebounce) {\r\n                        gutter._lnDebounce = debounce(() => updateGutterForTextarea(ta, gutter), 120);\r\n                    }\r\n                    gutter._lnDebounce();\r\n                } else {\r\n                    updateGutterForTextarea(ta, gutter);\r\n                }\r\n            }\r\n        }, 50);\r\n    });\r\n\r\n    // Tab inserts 4 spaces\r\n    document.addEventListener(\"keydown\", (e) => {\r\n        const ta = document.activeElement as HTMLTextAreaElement;\r\n        const isTextarea = ta && ta.classList && ta.classList.contains(\"textarea-contents\");\r\n        const key = e.key || e.code;\r\n        if (isTextarea && key === \"Tab\" && !e.ctrlKey && !e.altKey && !e.shiftKey && !e.metaKey) {\r\n            e.preventDefault();\r\n            const start = ta.selectionStart;\r\n            const end = ta.selectionEnd;\r\n            const val = ta.value;\r\n            ta.value = val.substring(0, start) + \"    \" + val.substring(end);\r\n            ta.selectionStart = ta.selectionEnd = start + 4;\r\n            state.updateIsTextModified(true);\r\n            return;\r\n        }\r\n    });\r\n\r\n    // Password input Enter key handling\r\n    on(qs(\"#enterpassword\") as HTMLElement, \"keypress\", (e) => {\r\n        const event = e as KeyboardEvent;\r\n        if (event.which === 13 || event.key === \"Enter\") {\r\n            event.preventDefault();\r\n            const decryptButton = qs(\"#dialog-password button[value='ok']\") as HTMLButtonElement;\r\n            if (decryptButton && !decryptButton.disabled) {\r\n                decryptButton.click();\r\n            }\r\n        }\r\n    });\r\n\r\n    // New password confirmation Enter key handling\r\n    on(qs(\"#newpassword2\") as HTMLElement, \"keypress\", (e) => {\r\n        const event = e as KeyboardEvent;\r\n        if (event.which === 13 || event.key === \"Enter\") {\r\n            const saveButton = qs(\"#dialog-new-password button[value='ok']\") as HTMLButtonElement;\r\n            if (saveButton) {\r\n                saveButton.click();\r\n            }\r\n            event.preventDefault();\r\n        }\r\n    });\r\n\r\n    // Buttons\r\n    on(qs(\"#button-save\") as HTMLElement, \"click\", () => state.saveSite(state.getIsNew()));\r\n    on(qs(\"#button-savenew\") as HTMLElement, \"click\", () => state.saveSite(true));\r\n    on(qs(\"#button-reload\") as HTMLElement, \"click\", () => state.reloadSite());\r\n    on(qs(\"#button-delete\") as HTMLElement, \"click\", () => {\r\n        openConfirmDialog(\"#dialog-confirm-delete-site\", async (ok) => {\r\n            if (ok) state.deleteSite();\r\n            else focusActiveTextarea();\r\n        });\r\n    });\r\n\r\n    // Help button\r\n    on(qs(\"#help-button\") as HTMLElement, \"click\", () => {\r\n        showKeyboardShortcutsHelp();\r\n    });\r\n\r\n    // Keyboard shortcuts\r\n    setupKeyboardShortcuts();\r\n\r\n    // Backup export button (visible before decrypt) - avoid duplicate creation\r\n    if (!qs(\"#button-export\")) {\r\n        const backupBtn = document.createElement(\"button\");\r\n        backupBtn.id = \"button-export\";\r\n        backupBtn.textContent = \"Export Encrypted Backup\";\r\n        backupBtn.title = \"Download encrypted backup (before decrypt)\";\r\n        backupBtn.className = \"\";\r\n        qs(\"#menubar-buttons\")?.appendChild(backupBtn);\r\n        on(backupBtn, \"click\", () => {\r\n            const eContent = state.remote.eContent;\r\n            if (!eContent) {\r\n                toast(\"Nothing to export yet\", \"warning\", 1200);\r\n                return;\r\n            }\r\n            exportEncryptedBackup(eContent);\r\n        });\r\n    }\r\n}\r\n\r\n// Additional keyboard shortcuts setup\r\nfunction setupKeyboardShortcuts(): void {\r\n    document.addEventListener(\"keydown\", (e) => {\r\n        // Skip if user is typing in an input field (except textarea)\r\n        const target = e.target as HTMLElement;\r\n        if (target.tagName === \"INPUT\" && (target as HTMLInputElement).type !== \"textarea\") return;\r\n\r\n        const isCtrlOrCmd = e.ctrlKey || e.metaKey;\r\n        const key = e.key.toLowerCase();\r\n\r\n        // Ctrl/Cmd + R: Reload\r\n        if (isCtrlOrCmd && key === \"r\" && !e.shiftKey) {\r\n            e.preventDefault();\r\n            if (!(qs(\"#button-reload\") as HTMLButtonElement).disabled) {\r\n                state.reloadSite();\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Ctrl/Cmd + T: New Tab (but not Ctrl+Alt+T which is handled separately)\r\n        if (isCtrlOrCmd && key === \"t\" && !e.altKey) {\r\n            e.preventDefault();\r\n            addTab(false, \"\", null, () => state.updateIsTextModified(true));\r\n            return;\r\n        }\r\n\r\n        // Ctrl/Cmd + W: Close Tab (if more than one tab)\r\n        if (isCtrlOrCmd && key === \"w\") {\r\n            const headers = qsa(\".tab-header\");\r\n            if (headers.length > 1) {\r\n                e.preventDefault();\r\n                const activeHeader = qs(\".tab-header.active\");\r\n                if (activeHeader) {\r\n                    const closeBtn = activeHeader.querySelector(\".close\") as HTMLElement;\r\n                    if (closeBtn) closeBtn.click();\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Ctrl/Cmd + Shift + S: Save with new password\r\n        if (isCtrlOrCmd && e.shiftKey && key === \"s\") {\r\n            e.preventDefault();\r\n            if (!(qs(\"#button-savenew\") as HTMLButtonElement).disabled) {\r\n                state.saveSite(true);\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Ctrl/Cmd + E: Export encrypted backup\r\n        if (isCtrlOrCmd && key === \"e\") {\r\n            e.preventDefault();\r\n            (qs(\"#button-export\") as HTMLButtonElement)?.click();\r\n            return;\r\n        }\r\n\r\n        // Ctrl/Cmd + 1-9: Switch to tab by number\r\n        if (isCtrlOrCmd && key >= \"1\" && key <= \"9\") {\r\n            e.preventDefault();\r\n            const tabIndex = parseInt(key) - 1;\r\n            const headers = qsa(\".tab-header\");\r\n            if (headers[tabIndex]) {\r\n                activateTab(headers[tabIndex]);\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Escape: Focus active textarea\r\n        if (key === \"escape\") {\r\n            focusActiveTextarea();\r\n            return;\r\n        }\r\n    });\r\n}\r\n\r\n// ============================================================================\r\n// BOOTSTRAP\r\n// ============================================================================\r\n\r\n(async function bootstrap() {\r\n    // Set up state callbacks\r\n    state.onButtonEnablementChange = updateButtonEnablement;\r\n    state.onStatusChange = updateStatusIndicator;\r\n    state.onLastSavedUpdate = updateLastSaved;\r\n    state.onFinishInitialization = finishInitialization;\r\n    state.onDecryptAndFinish = decryptContentAndFinishInitialization;\r\n\r\n    // Defer heavy initialization to next frame to improve FCP\r\n    requestAnimationFrame(async () => {\r\n        const path = window.location.pathname || \"/\";\r\n        const seg = path.replace(new RegExp(\"^/+|/+$\", \"g\"), \"\");\r\n        const qp = getQueryParam(\"site\");\r\n        const hasSiteId = (seg && seg !== \"api\") || qp;\r\n\r\n        if (!hasSiteId) return;\r\n\r\n        await state.init();\r\n        initTabsLayout(() => state.updateIsTextModified(true));\r\n        onWindowResize();\r\n        wireEvents();\r\n        startHealthMonitoring();\r\n\r\n        if (state.getIsNew() || !state.remote.eContent) {\r\n            await setContentOfTabs(\"\", state);\r\n            finishInitialization();\r\n        } else {\r\n            setPasswordMode(true, { hide: true });\r\n            initSite();\r\n        }\r\n    });\r\n})();\r\n\r\n// ============================================================================\r\n// THEME & COLOR PICKER INITIALIZATION (DOMContentLoaded)\r\n// ============================================================================\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    initTheme();\r\n    wireThemeToggle();\r\n    initKeyboardShortcuts();\r\n\r\n    // Initialize new features\r\n    initGlobalSearch();\r\n    initPasswordStrengthIndicators();\r\n    initTabSwitcher();\r\n\r\n    // Initialize kinetic geometry animations\r\n    const path = window.location.pathname || \"/\";\r\n    const seg = path.replace(new RegExp(\"^/+|/+$\", \"g\"), \"\");\r\n    const qp = new URL(window.location.href).searchParams.get(\"site\");\r\n    const isLanding = !((seg && seg !== \"api\") || qp);\r\n\r\n    initKineticBackground(isLanding);\r\n    initKineticButtons();\r\n    replaceLoaderWithKinetic();\r\n\r\n    // Add search button to menubar (before help button)\r\n    const helpButton = qs('#help-button');\r\n    if (helpButton && !qs('#search-button')) {\r\n        const searchButton = document.createElement('button');\r\n        searchButton.id = 'search-button';\r\n        searchButton.title = 'Global Search (Ctrl+Shift+F)';\r\n        searchButton.style.cssText = 'padding: 6px 10px; border-radius: 6px; border: 1px solid var(--border); background: var(--panel); color: var(--text); cursor: pointer; font-size: 14px;';\r\n        searchButton.textContent = '\uD83D\uDD0D';\r\n        searchButton.addEventListener('click', openSearch);\r\n        helpButton.parentNode?.insertBefore(searchButton, helpButton);\r\n    }\r\n\r\n    // Global color picker functionality\r\n    const globalColorPicker = document.getElementById('tab-color-picker') as HTMLInputElement;\r\n    if (globalColorPicker) {\r\n        globalColorPicker.addEventListener('input', (e) => {\r\n            try {\r\n                const activeTab = document.querySelector('.tab-header.active') as HTMLElement;\r\n                if (activeTab) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newColor = target.value;\r\n                    // Immediate visual feedback\r\n                    activeTab.style.backgroundColor = newColor;\r\n                }\r\n            } catch (error) {\r\n                console.error('Error updating tab color preview:', error);\r\n            }\r\n        });\r\n\r\n        globalColorPicker.addEventListener('change', (e) => {\r\n            try {\r\n                const activeTab = document.querySelector('.tab-header.active') as HTMLElement;\r\n                if (activeTab) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newColor = target.value;\r\n                    // Validate color format\r\n                    if (!/^#[0-9A-F]{6}$/i.test(newColor)) {\r\n                        console.warn('Invalid color format:', newColor);\r\n                        return;\r\n                    }\r\n\r\n                    activeTab.dataset.tabColor = newColor;\r\n                    activeTab.style.backgroundColor = newColor;\r\n\r\n                    // Trigger state update\r\n                    state.updateIsTextModified(true);\r\n                }\r\n            } catch (error) {\r\n                console.error('Error updating tab color persistence:', error);\r\n            }\r\n        });\r\n    }\r\n});\r\n"],
  "mappings": "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",
  "names": ["root", "isHuge", "state", "highlightMatch", "escapeHtml", "ok", "qs", "currentTabTitle"]
}
